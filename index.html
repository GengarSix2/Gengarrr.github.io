<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
    
  <meta name="description" content="一个兴趣使然的小站" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
     Ayer
  </title>
  <meta name="generator" content="hexo-theme-yilia-plus">
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  
<link rel="stylesheet" href="/css/style.css">

  
<script src="/js/pace.min.js"></script>


  

  

</head>

</html>

<body>
  <div id="app">
    <main class="content">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover1.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">Ayer</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>

<div id="main">
  <section class="outer">
  <article class="articles">
    
    
    
    
    <article id="post-Horses or Humans" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/09/17/Horses%20or%20Humans/"
    >Course2-Part2-Humans or Horses</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/09/17/Horses%20or%20Humans/" class="article-date">
  <time datetime="2020-09-17T14:44:36.000Z" itemprop="datePublished">2020-09-17</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="Horses-or-Humans"><a href="#Horses-or-Humans" class="headerlink" title="Horses or Humans"></a>Horses or Humans</h2><p>本次课程主要研究马与人的二分类问题。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># training sets</span></span><br><span class="line">train_horse_dir = os.path.join(<span class="string">"./horse-or-human/horses"</span>)</span><br><span class="line">train_human_dir = os.path.join(<span class="string">"./horse-or-human/humans"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># validation sets</span></span><br><span class="line">validation_horse_dir = os.path.join(<span class="string">"./validation-horse-or-human/horses"</span>)</span><br><span class="line">validation_human_dir = os.path.join(<span class="string">"./validation-horse-or-human/humans"</span>)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br></pre></td></tr></table></figure>

<p>模型结构与之前的<code>猫狗数据集</code>类似，先进行五层卷积，由于是二分类问题，最终结果是<code>0-1</code>之间的一个数，所以<code>flatten</code>最终结果并传入全连接层。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">model = tf.keras.models.Sequential([</span><br><span class="line">    <span class="comment"># first convolution</span></span><br><span class="line">    tf.keras.layers.Conv2D(<span class="number">16</span>, (<span class="number">3</span>,<span class="number">3</span>), activation=<span class="string">'relu'</span>, input_shape=(<span class="number">300</span>,<span class="number">300</span>,<span class="number">3</span>)),</span><br><span class="line">    tf.keras.layers.MaxPooling2D(<span class="number">2</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="comment"># second convolution</span></span><br><span class="line">    tf.keras.layers.Conv2D(<span class="number">32</span>, (<span class="number">3</span>,<span class="number">3</span>), activation=<span class="string">'relu'</span>),</span><br><span class="line">    tf.keras.layers.MaxPooling2D(<span class="number">2</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="comment"># third convolution</span></span><br><span class="line">    tf.keras.layers.Conv2D(<span class="number">64</span>, (<span class="number">3</span>,<span class="number">3</span>), activation=<span class="string">'relu'</span>),</span><br><span class="line">    tf.keras.layers.MaxPooling2D(<span class="number">2</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="comment"># fourth convolution</span></span><br><span class="line">    tf.keras.layers.Conv2D(<span class="number">64</span>, (<span class="number">3</span>,<span class="number">3</span>), activation=<span class="string">'relu'</span>),</span><br><span class="line">    tf.keras.layers.MaxPooling2D(<span class="number">2</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="comment"># fifth convolution</span></span><br><span class="line">    tf.keras.layers.Conv2D(<span class="number">64</span>, (<span class="number">3</span>,<span class="number">3</span>), activation=<span class="string">'relu'</span>),</span><br><span class="line">    tf.keras.layers.MaxPooling2D(<span class="number">2</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="comment"># Flatten the results to feed into a DNN</span></span><br><span class="line">    tf.keras.layers.Flatten(),</span><br><span class="line">    <span class="comment"># 512 neuron hidden layer</span></span><br><span class="line">    tf.keras.layers.Dense(<span class="number">512</span>, activation=<span class="string">'relu'</span>),</span><br><span class="line">    <span class="comment"># output only 1 neuron contain a value from 0-1 where 0 for 1 class ('horses') and 1 for the other ('humans')</span></span><br><span class="line">    tf.keras.layers.Dense(<span class="number">1</span>, activation=<span class="string">'sigmoid'</span>)</span><br><span class="line">])</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.optimizers <span class="keyword">import</span> RMSprop</span><br><span class="line"></span><br><span class="line">model.compile(loss = <span class="string">'binary_crossentropy'</span>,</span><br><span class="line">             optimizer = RMSprop(lr=<span class="number">1e-4</span>),</span><br><span class="line">             metrics = [<span class="string">'accuracy'</span>])</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.preprocessing.image <span class="keyword">import</span> ImageDataGenerator</span><br><span class="line"></span><br><span class="line"><span class="comment"># All images will be rescaled by 1.0/255</span></span><br><span class="line">train_datagen = ImageDataGenerator(</span><br><span class="line">    rescale = <span class="number">1.</span>/<span class="number">255</span>,</span><br><span class="line">    rotation_range = <span class="number">40</span>,</span><br><span class="line">    width_shift_range = <span class="number">0.2</span>,</span><br><span class="line">    height_shift_range = <span class="number">0.2</span>,</span><br><span class="line">    shear_range = <span class="number">0.2</span>,</span><br><span class="line">    zoom_range = <span class="number">0.2</span>,</span><br><span class="line">    horizontal_flip = <span class="literal">True</span>,</span><br><span class="line">    fill_mode = <span class="string">'nearest'</span>)</span><br><span class="line"></span><br><span class="line">validation_datagen = ImageDataGenerator(rescale = <span class="number">1</span>/<span class="number">255</span>)</span><br><span class="line"></span><br><span class="line">train_generator = train_datagen.flow_from_directory(</span><br><span class="line">    <span class="string">"./horse-or-human/"</span>,</span><br><span class="line">    target_size = (<span class="number">300</span>, <span class="number">300</span>),</span><br><span class="line">    batch_size = <span class="number">128</span>,</span><br><span class="line">    class_mode = <span class="string">"binary"</span>)</span><br><span class="line"></span><br><span class="line">validation_generator = validation_datagen.flow_from_directory(</span><br><span class="line">    <span class="string">"./validation-horse-or-human/"</span>,</span><br><span class="line">    target_size = (<span class="number">300</span>, <span class="number">300</span>),</span><br><span class="line">    batch_size = <span class="number">32</span>,</span><br><span class="line">    class_mode = <span class="string">"binary"</span>)</span><br></pre></td></tr></table></figure>

<pre><code>Found 1027 images belonging to 2 classes.
Found 256 images belonging to 2 classes.</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">history = model.fit(</span><br><span class="line">    train_generator,</span><br><span class="line">    steps_per_epoch = <span class="number">8</span>,</span><br><span class="line">    epochs = <span class="number">100</span>,</span><br><span class="line">    verbose = <span class="number">1</span>,</span><br><span class="line">    validation_data = validation_generator,</span><br><span class="line">    validation_steps = <span class="number">8</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">acc = history.history[<span class="string">'accuracy'</span>]</span><br><span class="line">val_acc = history.history[<span class="string">'val_accuracy'</span>]</span><br><span class="line">loss = history.history[<span class="string">'loss'</span>]</span><br><span class="line">val_loss = history.history[<span class="string">'val_loss'</span>]</span><br><span class="line"></span><br><span class="line">epochs = range(len(acc))</span><br><span class="line"></span><br><span class="line">plt.plot(epochs, acc, <span class="string">'r'</span>, label=<span class="string">'Training accuracy'</span>)</span><br><span class="line">plt.plot(epochs, val_acc, <span class="string">'b'</span>, label=<span class="string">'Validation accuracy'</span>)</span><br><span class="line">plt.title(<span class="string">'Training and validation accuracy'</span>)</span><br><span class="line"></span><br><span class="line">plt.figure()</span><br><span class="line"></span><br><span class="line">plt.plot(epochs, loss, <span class="string">'r'</span>, label=<span class="string">'Training Loss'</span>)</span><br><span class="line">plt.plot(epochs, val_loss, <span class="string">'b'</span>, label=<span class="string">'Validation Loss'</span>)</span><br><span class="line">plt.title(<span class="string">'Training and validation loss'</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>


      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tensorflow-2-0/" rel="tag">Tensorflow 2.0</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Tensorflow2.0-Cats vs Dogs" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/09/08/Tensorflow2.0-Cats%20vs%20Dogs/"
    >Course2-Part2-Cats vs Dogs</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/09/08/Tensorflow2.0-Cats%20vs%20Dogs/" class="article-date">
  <time datetime="2020-09-08T12:20:06.000Z" itemprop="datePublished">2020-09-08</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>学习目标：  </p>
<ol>
<li>学习处理<code>猫狗数据集</code></li>
<li>搭建神经网络学习两者之间的区别</li>
<li>计算训练集和验证集的正确率</li>
</ol>
<h2 id="Explore-the-Example-Data"><a href="#Explore-the-Example-Data" class="headerlink" title="Explore the Example Data"></a>Explore the Example Data</h2><p><code>cats_and_dogs_filtered</code>文件夹结构：   </p>
<p>train<br>——cats<br>——dogs<br>validation<br>——cats<br>——dogs    </p>
<p>初始化训练集和验证集。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">base_dir = <span class="string">'./cats_and_dogs_filtered'</span></span><br><span class="line"></span><br><span class="line">train_dir = os.path.join(base_dir, <span class="string">'train'</span>)</span><br><span class="line">validation_dir = os.path.join(base_dir, <span class="string">'validation'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Directory of training cat/dog pictures</span></span><br><span class="line">train_cats_dir = os.path.join(train_dir, <span class="string">'cats'</span>)</span><br><span class="line">train_dogs_dir = os.path.join(train_dir, <span class="string">'dogs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Directory of validation cat/dog pictures</span></span><br><span class="line">validation_cats_dir = os.path.join(validation_dir, <span class="string">'cats'</span>)</span><br><span class="line">validation_cats_dir = os.path.join(validation_dir, <span class="string">'dogs'</span>)</span><br></pre></td></tr></table></figure>

<p>我们有1000张训练集猫/狗图片和500验证集猫/狗图片，接下来通过配置<code>matplot</code>参数来更好地观察数据集。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> matplotlib.image <span class="keyword">as</span> mpimg</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置输出图片的大小</span></span><br><span class="line">nrows = <span class="number">4</span></span><br><span class="line">ncols = <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历图片的下标</span></span><br><span class="line">pic_index = <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>现在以8张cat，8张dog为一轮，展示图片。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">fig = plt.gcf()</span><br><span class="line">fig.set_size_inches(ncols*<span class="number">4</span>, nrows*<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">pic_index += <span class="number">8</span></span><br><span class="line"></span><br><span class="line">next_cat_pix = [os.path.join(train_cats_dir, fname)</span><br><span class="line">                <span class="keyword">for</span> fname <span class="keyword">in</span> train_cat_fnames[pic_index<span class="number">-8</span>:pic_index]</span><br><span class="line">               ]</span><br><span class="line"></span><br><span class="line">next_dog_pix = [os.path.join(train_dogs_dir, fname)</span><br><span class="line">                <span class="keyword">for</span> fname <span class="keyword">in</span> train_dog_fnames[pic_index<span class="number">-8</span>:pic_index]</span><br><span class="line">               ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, img_path <span class="keyword">in</span> enumerate(next_cat_pix+next_dog_pix):</span><br><span class="line">    <span class="comment"># 设置子图 参数分别为：行数、列数、索引值</span></span><br><span class="line">    sp = plt.subplot(nrows, ncols, i+<span class="number">1</span>)</span><br><span class="line">    sp.axis(<span class="string">'off'</span>) <span class="comment"># 不显示图片坐标</span></span><br><span class="line">    img = mpimg.imread(img_path)</span><br><span class="line">    plt.imshow(img)</span><br><span class="line">    plt.imshow(img)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>


<p><img src="output_6_0.png" alt="png"></p>
<h2 id="Building-Model"><a href="#Building-Model" class="headerlink" title="Building Model"></a>Building Model</h2><p>由于我们的原始图片具有不同的尺寸，在训练前需要将他们resize成统一的尺寸，我们选择150x150，接下来开始定义model。</p>
<p>我们首先定义了一个<code>Sequential</code>顺序层，加入一些卷积层，注意图片的尺寸。<br>接着再增加一些卷积层，并且<code>flatten</code>最终结果，以便进入<code>dense</code>全连接层。<br>最后加入全连接层，由于我们处理的是二分类问题，因而使用<code>sigmoid</code>激活函数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">model = tf.keras.models.Sequential([</span><br><span class="line">    <span class="comment"># 注意输入图片格式 </span></span><br><span class="line">    tf.keras.layers.Conv2D(<span class="number">16</span>, (<span class="number">3</span>,<span class="number">3</span>), activation=<span class="string">'relu'</span>, input_shape=(<span class="number">150</span>,<span class="number">150</span>,<span class="number">3</span>)),</span><br><span class="line">    tf.keras.layers.MaxPooling2D(<span class="number">2</span>,<span class="number">2</span>),</span><br><span class="line">    tf.keras.layers.Conv2D(<span class="number">32</span>, (<span class="number">3</span>,<span class="number">3</span>), activation=<span class="string">'relu'</span>),</span><br><span class="line">    tf.keras.layers.MaxPooling2D(<span class="number">2</span>,<span class="number">2</span>),</span><br><span class="line">    tf.keras.layers.Conv2D(<span class="number">64</span>, (<span class="number">3</span>,<span class="number">3</span>), activation=<span class="string">'relu'</span>),</span><br><span class="line">    tf.keras.layers.MaxPooling2D(<span class="number">2</span>,<span class="number">2</span>),</span><br><span class="line">    tf.keras.layers.Flatten(),</span><br><span class="line">    tf.keras.layers.Dense(<span class="number">512</span>, activation=<span class="string">'relu'</span>),</span><br><span class="line">    <span class="comment"># 最终输出只有一个值</span></span><br><span class="line">    tf.keras.layers.Dense(<span class="number">1</span>, activation=<span class="string">'sigmoid'</span>)</span><br><span class="line">])</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看模型结构参数</span></span><br><span class="line">model.summary()</span><br></pre></td></tr></table></figure>

<pre><code>Model: &quot;sequential&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
conv2d (Conv2D)              (None, 148, 148, 16)      448       
_________________________________________________________________
max_pooling2d (MaxPooling2D) (None, 74, 74, 16)        0         
_________________________________________________________________
conv2d_1 (Conv2D)            (None, 72, 72, 32)        4640      
_________________________________________________________________
max_pooling2d_1 (MaxPooling2 (None, 36, 36, 32)        0         
_________________________________________________________________
conv2d_2 (Conv2D)            (None, 34, 34, 64)        18496     
_________________________________________________________________
max_pooling2d_2 (MaxPooling2 (None, 17, 17, 64)        0         
_________________________________________________________________
flatten (Flatten)            (None, 18496)             0         
_________________________________________________________________
dense (Dense)                (None, 512)               9470464   
_________________________________________________________________
dense_1 (Dense)              (None, 1)                 513       
=================================================================
Total params: 9,494,561
Trainable params: 9,494,561
Non-trainable params: 0
_________________________________________________________________</code></pre><p>因为是二分类问题，所以我们用<code>binary_crossentropy</code>来训练模型，并且使用<code>rmsprop</code>优化函数和<code>0.001</code>的训练率。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.optimizers <span class="keyword">import</span> RMSprop</span><br><span class="line"></span><br><span class="line">model.compile(optimizer = RMSprop(lr=<span class="number">0.001</span>),</span><br><span class="line">              loss = <span class="string">'binary_crossentropy'</span>,</span><br><span class="line">              metrics = [<span class="string">'accuracy'</span>]</span><br><span class="line">             )</span><br></pre></td></tr></table></figure>

<h2 id="Data-Preprocessing"><a href="#Data-Preprocessing" class="headerlink" title="Data Preprocessing"></a>Data Preprocessing</h2><p>图片在进入神经网络训练前需要进行预处理，将像素值归一化，设置成<code>[0, 1]</code>之间的值。  </p>
<p>使用说明：<br>In Keras this can be done via the <code>keras.preprocessing.image.ImageDataGenerator</code>class using the <code>rescale</code>parameter. This <code>ImageDataGenerator</code> class allows you to instantiate generators of augmented image batches (and their labels) via <code>.flow(data, labels)</code> or <code>.flow_from_directory(directory)</code>. These generators can then be used with the Keras model methods that accept data generators as inputs: <code>fit</code>, <code>evaluate_generator</code>, and <code>predict_generator</code>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.preprocessing.image <span class="keyword">import</span> ImageDataGenerator</span><br><span class="line"></span><br><span class="line"><span class="comment"># All images will be rescaled by 1./255</span></span><br><span class="line">train_datagen = ImageDataGenerator(rescale = <span class="number">1.0</span>/<span class="number">255.</span>)</span><br><span class="line">test_datagen = ImageDataGenerator(rescale = <span class="number">1.0</span>/<span class="number">255.</span>)</span><br><span class="line"></span><br><span class="line">train_generator = train_datagen.flow_from_directory(train_dir,</span><br><span class="line">                                                   batch_size = <span class="number">20</span>,</span><br><span class="line">                                                   class_mode = <span class="string">'binary'</span>,</span><br><span class="line">                                                   target_size = (<span class="number">150</span>, <span class="number">150</span>))</span><br><span class="line"></span><br><span class="line">validation_generator = test_datagen.flow_from_directory(validation_dir,</span><br><span class="line">                                                      batch_size = <span class="number">20</span>,</span><br><span class="line">                                                      class_mode = <span class="string">'binary'</span>,</span><br><span class="line">                                                      target_size = (<span class="number">150</span>, <span class="number">150</span>))</span><br></pre></td></tr></table></figure>

<pre><code>Found 2000 images belonging to 2 classes.
Found 1000 images belonging to 2 classes.</code></pre><h2 id="Training"><a href="#Training" class="headerlink" title="Training"></a>Training</h2><p>训练2000张图片，15轮，并用1000张图片进行验证。<br>主要关注四个参数： Loss, Accuracy, Validation Loss and Validation Accuracy。<br>之所以验证集上的正确率低一些，是因为发生了<code>过拟合</code>现象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">history = model.fit(train_generator,</span><br><span class="line">                   validation_data = validation_generator,</span><br><span class="line">                   steps_per_epoch = <span class="number">100</span>,</span><br><span class="line">                   epochs = <span class="number">15</span>,</span><br><span class="line">                   validation_steps = <span class="number">50</span>,</span><br><span class="line">                   verbose = <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<pre><code>Train for 100 steps, validate for 50 steps
Epoch 1/15
100/100 - 31s - loss: 0.7254 - accuracy: 0.5840 - val_loss: 0.6983 - val_accuracy: 0.5330
Epoch 2/15
100/100 - 6s - loss: 0.6174 - accuracy: 0.6715 - val_loss: 0.6289 - val_accuracy: 0.6620
Epoch 3/15
100/100 - 6s - loss: 0.5303 - accuracy: 0.7365 - val_loss: 0.5830 - val_accuracy: 0.7130
Epoch 4/15
100/100 - 7s - loss: 0.4546 - accuracy: 0.7885 - val_loss: 0.6252 - val_accuracy: 0.6840
Epoch 5/15
100/100 - 6s - loss: 0.3735 - accuracy: 0.8315 - val_loss: 0.7358 - val_accuracy: 0.6750
Epoch 6/15
100/100 - 6s - loss: 0.2905 - accuracy: 0.8655 - val_loss: 0.6466 - val_accuracy: 0.6810
Epoch 7/15
100/100 - 6s - loss: 0.2130 - accuracy: 0.9230 - val_loss: 0.8432 - val_accuracy: 0.7120
Epoch 8/15
100/100 - 6s - loss: 0.1432 - accuracy: 0.9455 - val_loss: 0.8759 - val_accuracy: 0.6890
Epoch 9/15
100/100 - 6s - loss: 0.1003 - accuracy: 0.9665 - val_loss: 1.0862 - val_accuracy: 0.7040
Epoch 10/15
100/100 - 7s - loss: 0.0769 - accuracy: 0.9760 - val_loss: 1.3929 - val_accuracy: 0.7180
Epoch 11/15
100/100 - 7s - loss: 0.0566 - accuracy: 0.9835 - val_loss: 1.5369 - val_accuracy: 0.7070
Epoch 12/15
100/100 - 7s - loss: 0.0353 - accuracy: 0.9870 - val_loss: 1.7776 - val_accuracy: 0.6920
Epoch 13/15
100/100 - 6s - loss: 0.0353 - accuracy: 0.9900 - val_loss: 1.9454 - val_accuracy: 0.7190
Epoch 14/15
100/100 - 6s - loss: 0.0549 - accuracy: 0.9875 - val_loss: 1.8197 - val_accuracy: 0.7270
Epoch 15/15
100/100 - 6s - loss: 0.0347 - accuracy: 0.9915 - val_loss: 1.9393 - val_accuracy: 0.7340</code></pre><h2 id="Visualizing-Intermediate-Representations"><a href="#Visualizing-Intermediate-Representations" class="headerlink" title="Visualizing Intermediate Representations"></a>Visualizing Intermediate Representations</h2><p>将中间结果可视化，可以查看各种特征。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span>   tensorflow.keras.preprocessing.image <span class="keyword">import</span> img_to_array, load_img</span><br><span class="line"></span><br><span class="line"><span class="comment"># Let's define a new Model that will take an image as input, and will output</span></span><br><span class="line"><span class="comment"># intermediate representations for all layers in the previous model after</span></span><br><span class="line"><span class="comment"># the first.</span></span><br><span class="line">successive_outputs = [layer.output <span class="keyword">for</span> layer <span class="keyword">in</span> model.layers[<span class="number">1</span>:]]</span><br><span class="line"></span><br><span class="line"><span class="comment">#visualization_model = Model(img_input, successive_outputs)</span></span><br><span class="line">visualization_model = tf.keras.models.Model(inputs = model.input, outputs = successive_outputs)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Let's prepare a random input image of a cat or dog from the training set.</span></span><br><span class="line">cat_img_files = [os.path.join(train_cats_dir, f) <span class="keyword">for</span> f <span class="keyword">in</span> train_cat_fnames]</span><br><span class="line">dog_img_files = [os.path.join(train_dogs_dir, f) <span class="keyword">for</span> f <span class="keyword">in</span> train_dog_fnames]</span><br><span class="line"></span><br><span class="line">img_path = random.choice(cat_img_files + dog_img_files)</span><br><span class="line">img = load_img(img_path, target_size=(<span class="number">150</span>, <span class="number">150</span>))  <span class="comment"># this is a PIL image</span></span><br><span class="line"></span><br><span class="line">x   = img_to_array(img)                           <span class="comment"># Numpy array with shape (150, 150, 3)</span></span><br><span class="line">x   = x.reshape((<span class="number">1</span>,) + x.shape)                   <span class="comment"># Numpy array with shape (1, 150, 150, 3)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Rescale by 1/255</span></span><br><span class="line">x /= <span class="number">255.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Let's run our image through our network, thus obtaining all</span></span><br><span class="line"><span class="comment"># intermediate representations for this image.</span></span><br><span class="line">successive_feature_maps = visualization_model.predict(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># These are the names of the layers, so can have them as part of our plot</span></span><br><span class="line">layer_names = [layer.name <span class="keyword">for</span> layer <span class="keyword">in</span> model.layers]</span><br><span class="line"></span><br><span class="line"><span class="comment"># -----------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Now let's display our representations</span></span><br><span class="line"><span class="comment"># -----------------------------------------------------------------------</span></span><br><span class="line"><span class="keyword">for</span> layer_name, feature_map <span class="keyword">in</span> zip(layer_names, successive_feature_maps):</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> len(feature_map.shape) == <span class="number">4</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#-------------------------------------------</span></span><br><span class="line">    <span class="comment"># Just do this for the conv / maxpool layers, not the fully-connected layers</span></span><br><span class="line">    <span class="comment">#-------------------------------------------</span></span><br><span class="line">    n_features = feature_map.shape[<span class="number">-1</span>]  <span class="comment"># number of features in the feature map</span></span><br><span class="line">    size       = feature_map.shape[ <span class="number">1</span>]  <span class="comment"># feature map shape (1, size, size, n_features)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># We will tile our images in this matrix</span></span><br><span class="line">    display_grid = np.zeros((size, size * n_features))</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#-------------------------------------------------</span></span><br><span class="line">    <span class="comment"># Postprocess the feature to be visually palatable</span></span><br><span class="line">    <span class="comment">#-------------------------------------------------</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n_features):</span><br><span class="line">      x  = feature_map[<span class="number">0</span>, :, :, i]</span><br><span class="line">      x -= x.mean()</span><br><span class="line">      x /= x.std ()</span><br><span class="line">      x *=  <span class="number">64</span></span><br><span class="line">      x += <span class="number">128</span></span><br><span class="line">      x  = np.clip(x, <span class="number">0</span>, <span class="number">255</span>).astype(<span class="string">'uint8'</span>)</span><br><span class="line">      display_grid[:, i * size : (i + <span class="number">1</span>) * size] = x <span class="comment"># Tile each filter into a horizontal grid</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#-----------------</span></span><br><span class="line">    <span class="comment"># Display the grid</span></span><br><span class="line">    <span class="comment">#-----------------</span></span><br><span class="line"></span><br><span class="line">    scale = <span class="number">20.</span> / n_features</span><br><span class="line">    plt.figure( figsize=(scale * n_features, scale) )</span><br><span class="line">    plt.title ( layer_name )</span><br><span class="line">    plt.grid  ( <span class="literal">False</span> )</span><br><span class="line">    plt.imshow( display_grid, aspect=<span class="string">'auto'</span>, cmap=<span class="string">'viridis'</span> )</span><br></pre></td></tr></table></figure>

<pre><code>D:\Anaconda\anaconda\envs\tf2.0\lib\site-packages\ipykernel_launcher.py:55: RuntimeWarning: invalid value encountered in true_divide</code></pre><p><img src="output_17_1.png" alt="png"></p>
<p><img src="output_17_2.png" alt="png"></p>
<p><img src="output_17_3.png" alt="png"></p>
<p><img src="output_17_4.png" alt="png"></p>
<p><img src="output_17_5.png" alt="png"></p>
<h2 id="Evaluating-Accuracy-and-Loss-for-the-Model"><a href="#Evaluating-Accuracy-and-Loss-for-the-Model" class="headerlink" title="Evaluating Accuracy and Loss for the Model"></a>Evaluating Accuracy and Loss for the Model</h2><p>将训练集/验证集的正确率/损失率可视化。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-----------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Retrieve a list of list results on training and test data</span></span><br><span class="line"><span class="comment"># sets for each training epoch</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------</span></span><br><span class="line">acc      = history.history[     <span class="string">'accuracy'</span> ]</span><br><span class="line">val_acc  = history.history[ <span class="string">'val_accuracy'</span> ]</span><br><span class="line">loss     = history.history[    <span class="string">'loss'</span> ]</span><br><span class="line">val_loss = history.history[<span class="string">'val_loss'</span> ]</span><br><span class="line"></span><br><span class="line">epochs   = range(len(acc)) <span class="comment"># Get number of epochs</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------</span></span><br><span class="line"><span class="comment"># Plot training and validation accuracy per epoch</span></span><br><span class="line"><span class="comment">#------------------------------------------------</span></span><br><span class="line">plt.plot  ( epochs,     acc )</span><br><span class="line">plt.plot  ( epochs, val_acc )</span><br><span class="line">plt.title (<span class="string">'Training and validation accuracy'</span>)</span><br><span class="line">plt.figure()</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------</span></span><br><span class="line"><span class="comment"># Plot training and validation loss per epoch</span></span><br><span class="line"><span class="comment">#------------------------------------------------</span></span><br><span class="line">plt.plot  ( epochs,     loss )</span><br><span class="line">plt.plot  ( epochs, val_loss )</span><br><span class="line">plt.title (<span class="string">'Training and validation loss'</span>   )</span><br></pre></td></tr></table></figure>




<pre><code>Text(0.5, 1.0, &apos;Training and validation loss&apos;)</code></pre><p><img src="output_19_1.png" alt="png"></p>
<p><img src="output_19_2.png" alt="png"></p>
<p>如上图所示，产生了过拟合问题，训练集的正确率接近100%，然而验证集正确率下降至70%。  </p>
<p>由于我们使用的样本量相对较小（2000份），过拟合会成为一个问题。当一个模型接受了较小的样本量，却没有适应新数据时，会发生过拟合问题。因为模型会开始使用不相关的特征进行预测。例如，如果你作为一个人类，只看到三个伐木工人的形象和三个水手的形象，其中唯一一个戴帽子的是伐木工人，你可能会开始认为戴帽子是一个伐木工人的标志，而不是一个水手。然后你会做出一个相当糟糕的伐木工人/水手分类器。  </p>
<p>过度拟合是机器学习中的核心问题：既然我们正在将模型的参数拟合到给定的数据集，那么我们如何确保模型学习到的表示将适用于从未见过的数据？我们如何避免学习基于特定训练集的东西？</p>
<p>在下一个练习中，我们将研究如何在猫与狗的分类模型中防止过度拟合。</p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tensorflow-2-0/" rel="tag">Tensorflow 2.0</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-智能交通软件" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/08/31/%E6%99%BA%E8%83%BD%E4%BA%A4%E9%80%9A%E8%BD%AF%E4%BB%B6/"
    >智能交通软件</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/08/31/%E6%99%BA%E8%83%BD%E4%BA%A4%E9%80%9A%E8%BD%AF%E4%BB%B6/" class="article-date">
  <time datetime="2020-08-31T07:59:06.000Z" itemprop="datePublished">2020-08-31</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h1 id="Intelligent-Traffic-Scene"><a href="#Intelligent-Traffic-Scene" class="headerlink" title="Intelligent-Traffic-Scene"></a>Intelligent-Traffic-Scene</h1><h1 id="交通场景智能应用软件"><a href="#交通场景智能应用软件" class="headerlink" title="交通场景智能应用软件"></a>交通场景智能应用软件</h1><p><a href="https://github.com/Gengarrr/Intelligent-Traffic-Scene" target="_blank" rel="noopener">Github源码</a></p>
<h2 id="1️⃣-功能列表"><a href="#1️⃣-功能列表" class="headerlink" title="1️⃣ 功能列表"></a>1️⃣ 功能列表</h2><p>✅ 利用YOLOv3实现车辆、行人、红绿灯检测<br>✅ 利用HSV原理检测红绿灯颜色<br>✅ 利用HyperLPR实现车牌检测<br>✅ 目标分类统计、路段车流量统计，并将结果存储在Excel文件中<br>⭕ 更多高级的行为识别功能等待开发……  </p>
<h2 id="2️⃣-源码说明"><a href="#2️⃣-源码说明" class="headerlink" title="2️⃣ 源码说明"></a>2️⃣ 源码说明</h2><p>通过Anaconda建立虚拟环境，cd至项目目录下，利用<code>requirements.txt</code>文件安装所需环境。  </p>
<pre><code>pip install -r requirements.txt</code></pre><p>运行<code>Video_Player.py</code>文件，显示软件主界面。</p>
<pre><code>python Video_Player.py</code></pre><h3 id="Video-Player-py"><a href="#Video-Player-py" class="headerlink" title="Video_Player.py"></a><code>Video_Player.py</code></h3><p>Pyqt5的软件界面。</p>
<h3 id="Traffic-Scene-Detection-py"><a href="#Traffic-Scene-Detection-py" class="headerlink" title="Traffic_Scene_Detection.py"></a><code>Traffic_Scene_Detection.py</code></h3><p>程序主要文件，进行读取视频，目标检测识别。</p>
<h3 id="utils-py"><a href="#utils-py" class="headerlink" title="utils.py"></a><code>utils.py</code></h3><p>保存各种对当前帧进行的操作。</p>
<h2 id="3️⃣-软件使用说明"><a href="#3️⃣-软件使用说明" class="headerlink" title="3️⃣ 软件使用说明"></a>3️⃣ 软件使用说明</h2><p><img src="https://s1.ax1x.com/2020/08/31/dOKwh8.png" alt="dOKwh8.png"></p>
<p>运行程序后，主界面如上图所示，中间界面为视频播放区域，下方依次为：<br>① 工具图标：选择视频文件进行识别检测处理；<br>② 文件夹图标：选择视频文件进行播放；<br>③ 箭头图标及进度条：播放/暂停键，右侧为视频播放进度条。  </p>
<p>界面最下方为当前状态提示信息，默认情况下显示信息如图所示。使用处理按钮选中文件以后，程序进入处理状态，此时提示信息会变为<code>视频处理中，请耐心等待。</code>。视频处理完毕，结果视频将自动保存，提示信息为<code>结果已存放于: +&quot;存放路径&quot;</code>。</p>
<h2 id="4️⃣-软件截图"><a href="#4️⃣-软件截图" class="headerlink" title="4️⃣ 软件截图"></a>4️⃣ 软件截图</h2><p><a href="https://imgchr.com/i/dOGFEj" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2020/08/31/dOGFEj.png" alt="dOGFEj.png"></a></p>
<h2 id="5️⃣-编写过程中使用的开源代码-教程"><a href="#5️⃣-编写过程中使用的开源代码-教程" class="headerlink" title="5️⃣ 编写过程中使用的开源代码/教程"></a>5️⃣ 编写过程中使用的开源代码/教程</h2><p>🚩 <a href="https://github.com/zeusees/HyperLPR" target="_blank" rel="noopener">HyperLPR高性能车牌检测</a><br>🚩 <a href="https://www.bilibili.com/video/BV1r5411t7Db" target="_blank" rel="noopener">YOLOv3安装教程</a><br>🚩 <a href="https://www.bilibili.com/video/BV1oJ411D71z" target="_blank" rel="noopener">OpenCV教程</a></p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Project/" rel="tag">Project</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-二叉搜索树-增删改查(Python)" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/07/08/%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91-%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5(Python)/"
    >二叉搜索树-增删改查(Python)</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/07/08/%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91-%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5(Python)/" class="article-date">
  <time datetime="2020-07-08T09:00:04.000Z" itemprop="datePublished">2020-07-08</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="01-定义"><a href="#01-定义" class="headerlink" title="01 定义"></a>01 定义</h3><p>首先定义二叉树结点的数据类型：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, val, left=None, right=None)</span>:</span></span><br><span class="line">		self.val = val</span><br><span class="line">		self.left = left</span><br><span class="line">		self.right = right</span><br></pre></td></tr></table></figure>
<p>二叉搜索树的定义：<br><code>二叉搜索树（BST）</code>是二叉树的一种特殊表示形式，它满足如下特性：</p>
<p>每个节点中的值必须<code>大于</code>（或等于）存储在其左侧子树中的任何值。<br>每个节点中的值必须<code>小于</code>（或等于）存储在其右子树中的任何值。</p>
<p>下面是一个二叉搜索树的例子：</p>
<img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hbGl5dW4tbGMtdXBsb2FkLm9zcy1jbi1oYW5nemhvdS5hbGl5dW5jcy5jb20vYWxpeXVuLWxjLXVwbG9hZC91cGxvYWRzLzIwMTgvMDMvMTQvYnN0X2V4YW1wbGUtYTEucG5n?x-oss-process=image/format,png#pic_center" width="50%">

<h3 id="02-增操作"><a href="#02-增操作" class="headerlink" title="02 增操作"></a>02 增操作</h3><p>增加操作本质上与二叉树的遍历操作并无区别。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BinaryTree</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="comment"># 插入操作（增）</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, root, val)</span>:</span></span><br><span class="line">		<span class="keyword">if</span> root == <span class="literal">None</span>:</span><br><span class="line">			root = TreeNode(val)</span><br><span class="line">		<span class="keyword">elif</span> val &lt; root.val:</span><br><span class="line">			root.left = self.insert(root.left, val)</span><br><span class="line">		<span class="keyword">elif</span> val &gt; root.val:</span><br><span class="line">			root.right = self.insert(root.right, val)</span><br><span class="line">		<span class="keyword">return</span> root</span><br></pre></td></tr></table></figure>
<h3 id="03-删操作"><a href="#03-删操作" class="headerlink" title="03 删操作"></a>03 删操作</h3><p>删除操作复杂一些，根据子节点的个数，需要考虑如下三种情况：</p>
<ol>
<li>如果目标节点<strong>没有子节点</strong>，我们可以直接移除该目标节点。</li>
<li>如果目标节<strong>只有一个子节点</strong>，我们可以用其子节点作为替换。</li>
<li>如果目标节点<strong>有两个子节点</strong>，我们需要用其中序后继节点或者前驱节点来替换，再删除该目标节点。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除操作（删）</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self, root, key)</span>:</span></span><br><span class="line">		<span class="keyword">if</span> root == <span class="literal">None</span>:</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> root.val == key:</span><br><span class="line">			<span class="keyword">if</span> root.left==<span class="literal">None</span> <span class="keyword">and</span> root.right==<span class="literal">None</span>:</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">			<span class="keyword">elif</span> root.left!=<span class="literal">None</span> <span class="keyword">and</span> root.right!=<span class="literal">None</span>:</span><br><span class="line">				<span class="comment"># buffer用于存放要替换节点的父节点,tmp是要替换的节点</span></span><br><span class="line">				buffer = <span class="literal">None</span></span><br><span class="line">				temp = root.right</span><br><span class="line">				<span class="keyword">while</span> temp.left:</span><br><span class="line">					buffer = temp</span><br><span class="line">					temp = temp.left</span><br><span class="line">				root.val, temp.val = temp.val, root.val</span><br><span class="line">				<span class="keyword">if</span> buffer == <span class="literal">None</span>:</span><br><span class="line">					root.right = self.delete(temp, key)</span><br><span class="line">				<span class="keyword">else</span>:</span><br><span class="line">					buffer.left = self.delete(buffer, key)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			<span class="keyword">elif</span> root.left == <span class="literal">None</span>:</span><br><span class="line">				root = root.right</span><br><span class="line">			<span class="keyword">elif</span> root.right == <span class="literal">None</span>:</span><br><span class="line">				root = root.left</span><br><span class="line"></span><br><span class="line">		<span class="keyword">elif</span> root.val &gt; key:</span><br><span class="line">			root.left = self.delete(root.left, key)</span><br><span class="line">		<span class="keyword">elif</span> root.val &lt; key:</span><br><span class="line">			root.right = self.delete(root.right, key)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> root</span><br></pre></td></tr></table></figure>
<h3 id="04-改操作"><a href="#04-改操作" class="headerlink" title="04 改操作"></a>04 改操作</h3>这里的修改操作仅仅对结点值进行了修改，修改完以后并没有维护二叉搜索树的性质，后续还可以进一步改进。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改操作（改）</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">modify</span><span class="params">(self, root, val, new_val)</span>:</span></span><br><span class="line">		<span class="keyword">if</span> root == <span class="literal">None</span>:</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">		<span class="keyword">elif</span> root.val &gt; val:</span><br><span class="line">			<span class="keyword">return</span> self.modify(root.left, val, new_val)</span><br><span class="line">		<span class="keyword">elif</span> root.val &lt; val:</span><br><span class="line">			<span class="keyword">return</span> self.modify(root.right, val, new_val)</span><br><span class="line">		<span class="keyword">elif</span> root.val == val:</span><br><span class="line">			root.val = new_val</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<h3 id="04-查操作"><a href="#04-查操作" class="headerlink" title="04 查操作"></a>04 查操作</h3></li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查找操作（查）</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(self, root, val)</span>:</span></span><br><span class="line">		<span class="keyword">if</span> root == <span class="literal">None</span>:</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">		<span class="keyword">elif</span> root.val &gt; val:</span><br><span class="line">			<span class="keyword">return</span> self.search(root.left, val)</span><br><span class="line">		<span class="keyword">elif</span> root.val &lt; val:</span><br><span class="line">			<span class="keyword">return</span> self.search(root.right, val)</span><br><span class="line">		<span class="keyword">elif</span> root.val == val:</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>



      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Data-Structure/" rel="tag">Data Structure</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-hello-world" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/05/07/hello-world/"
    >Hello World</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/05/07/hello-world/" class="article-date">
  <time datetime="2020-05-07T00:51:08.362Z" itemprop="datePublished">2020-05-07</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      

    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Leetcode-2-两数相加" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/09/Leetcode-2-%E4%B8%A4%E6%95%B0%E7%9B%B8%E5%8A%A0/"
    >Leetcode#2 两数相加</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/09/Leetcode-2-%E4%B8%A4%E6%95%B0%E7%9B%B8%E5%8A%A0/" class="article-date">
  <time datetime="2020-04-09T04:11:50.000Z" itemprop="datePublished">2020-04-09</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="两数相加"><a href="#两数相加" class="headerlink" title="两数相加"></a>两数相加</h3><img src='https://s1.ax1x.com/2020/04/09/G43d76.png' width=80%>   


<h3 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h3><p>链表的逆序排列本身就符合加法从低位运算至高位的规则，因此我们只需要顺序遍历链表，同时记录下进位即可。        </p>
<h3 id="链表的遍历"><a href="#链表的遍历" class="headerlink" title="链表的遍历"></a>链表的遍历</h3><p>这里有一个知识点是关于链表的遍历问题。在struct ListNode中有这样一句： ListNode(int x) : val(x), next(NULL) {}，这表明初始化支持 ListNode（int x）这种方式，即 把x赋给val，NULL赋值给next。</p>
<p>在遍历的同时，首先定义一个头结点newHead,同时定义一个nownode用来指向当前操作的结点。</p>
<h3 id="C-代码"><a href="#C-代码" class="headerlink" title="C++代码"></a>C++代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">struct ListNode &#123;</span><br><span class="line">    int val;</span><br><span class="line">    ListNode *next;</span><br><span class="line">    ListNode(int x) : val(x), next(NULL) &#123;&#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Solution &#123;</span><br><span class="line">public:</span><br><span class="line">    ListNode* addTwoNumbers(ListNode* l1, ListNode* l2) &#123;</span><br><span class="line">        int carry &#x3D; 0; &#x2F;&#x2F;记录进位</span><br><span class="line">        int sum &#x3D; 0; &#x2F;&#x2F;记录当前位和</span><br><span class="line">        ListNode* newhead &#x3D; new ListNode(0);</span><br><span class="line">        ListNode* nownode &#x3D; newhead;</span><br><span class="line"></span><br><span class="line">        while (l1 || l2 || carry)</span><br><span class="line">        &#123;</span><br><span class="line">            sum &#x3D; carry;</span><br><span class="line">            if (l1) sum +&#x3D; l1-&gt;val;</span><br><span class="line">            if (l2) sum +&#x3D; l2-&gt;val;</span><br><span class="line">            carry &#x3D; sum&#x2F;10;</span><br><span class="line">            sum %&#x3D; 10;</span><br><span class="line">            nownode-&gt;val &#x3D; sum;</span><br><span class="line"></span><br><span class="line">            ListNode* nextnode &#x3D; new ListNode(0);</span><br><span class="line">            nownode-&gt;next &#x3D; nextnode;</span><br><span class="line">            l1 &#x3D; l1?l1-&gt;next:nullptr;</span><br><span class="line">            l2 &#x3D; l2?l2-&gt;next:nullptr;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        return newhead;</span><br><span class="line">    &#125;      </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Data-Structure/" rel="tag">Data Structure</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-experiment-CM-1" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/05/experiment-CM-1/"
    >experiment-CM-1</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/05/experiment-CM-1/" class="article-date">
  <time datetime="2020-04-05T03:59:06.000Z" itemprop="datePublished">2020-04-05</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="0x01-初步查看"><a href="#0x01-初步查看" class="headerlink" title="0x01 初步查看"></a>0x01 初步查看</h3><p>首先使用PeiD查看，无壳。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405114644986.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>打开CM，查看serial输入处，点击Check it并没有出现任何提示框，并且发现任何除数字外的字符都无法输入。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405114713736.png#pic_center" alt="在这里插入图片描述"><br>将CM拖入OD中，利用查找中文字符串插件找到最终判断条件处。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405114740647.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>这里是最终判断条件，eax和esi相等则得到正确答案。现在要做的就是探寻eax和esi分别是如何得到的。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405114808363.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h3 id="0x02-进一步探寻"><a href="#0x02-进一步探寻" class="headerlink" title="0x02 进一步探寻"></a>0x02 进一步探寻</h3><p>将最终判断条件cmp eax,esi和上方的experime.004013D2断下，按f9运行。<br>进入到004013D2函数中，发现<br>最终返回的esi = 进入函数前esi的值 异或上 0x797A7553。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405114836259.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>而eax即为输入的serial。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405114854567.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>至此我们可以知道，只要知道了esi的生成规则，便可以完成破解。</p>
<h3 id="0x03-esi的生成规则"><a href="#0x03-esi的生成规则" class="headerlink" title="0x03 esi的生成规则"></a>0x03 esi的生成规则</h3><p>通过向上查看可以看到，esi是由[0x40339C]所赋值的。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405115617750.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>这里我们通过IDA来查看[0x40339C]是在哪里生成的，可以看到是通过调用VolumeNameBuffer函数所得到的。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405115133832.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>继续查看VolumeNameBuffer函数，在这里可以看到是调用0x0040142C地址处的GetVolumeInformationA函数。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405115149659.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>返回OD在0x0040142C处进行查看，可以看到GetVolumeInformationA函数的结果是”Windows”。在网上查询后可以看到，GetVolumeInformationA函数的作用是获取硬盘信息。此时我的exe处于C盘，而当我将他放在D盘后，可以看到此时生成的信息变为”DATA”，分别与本机C盘和D盘的名称相对应。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405115248729.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>继续运行，可以看到下方是一段循环，循环后的结果存放在edi中，正是后面我们查看到的最后一步“进入函数前esi的值”。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405115329624.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>这里需要说明一下esi的”Windows”与ecx的3都是GetVolumeInformationA函数中得到的。其中3的获取如下图所示。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405115343538.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>接下来对关键函数进行分析，分析结果在右侧。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405115435501.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>使用C++进行复现：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span>* Disk_name;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span>* ebx;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> eax = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> edi = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> ecx = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> i;</span><br><span class="line">    <span class="keyword">int</span> Disk_type = <span class="number">3</span>;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    Disk_name = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">10</span>];</span><br><span class="line">    <span class="built_in">memset</span>(Disk_name, <span class="number">0</span>, <span class="built_in">strlen</span>(Disk_name));</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"experiment-CM-1.exe所在磁盘的名称:"</span>;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;Disk_name;</span><br><span class="line">   </span><br><span class="line">    ebx = (<span class="keyword">unsigned</span> <span class="keyword">long</span> *)&amp;Disk_name[<span class="number">0</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (ecx = Disk_type; ecx&gt;<span class="number">0</span>; ecx--)</span><br><span class="line">    &#123;</span><br><span class="line">        i = ecx;</span><br><span class="line">        i *= *ebx;</span><br><span class="line">        eax = i&amp;<span class="number">0xFFFFFFFF</span>;</span><br><span class="line">        edi += eax;</span><br><span class="line">    &#125;</span><br><span class="line">    edi ^= <span class="number">0x797A7553</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>&lt;&lt;<span class="string">"Serial: "</span>&lt;&lt;edi&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    system(<span class="string">"pause:"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下图为最终结果。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405115536860.png#pic_center" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20200405115546923.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reverse/" rel="tag">Reverse</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Crackme-3" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/03/23/Crackme-3/"
    >Crackme 3</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/03/23/Crackme-3/" class="article-date">
  <time datetime="2020-03-23T05:22:40.000Z" itemprop="datePublished">2020-03-23</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>0x01 查壳<br>首先用PEiD进行查壳，无壳，但是找到了CRC32的加密方式，后面有可能会用到。<br><img src="https://img-blog.csdnimg.cn/20200323000652844.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200323000711225.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>0x02 初步分析<br>先随意输入Name和Code，发现当输入的Name少于五个字节时则不弹窗；大于等于五个字节才会弹出错误提示框。<br><img src="https://img-blog.csdnimg.cn/2020032300080751.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>用OD打开程序，使用插件搜索字符串，可以找到提示注册成功的字样，双击跟入。<br><img src="https://img-blog.csdnimg.cn/20200323000828748.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>在这里可以看到关键跳转步骤，经过CM3.00404224函数后，esi与eax的值必须相等，才会显示注册码成功。继续往上查看之前，先将关键的CM3.00404224函数断下。</p>
<p><img src="https://img-blog.csdnimg.cn/20200323001053503.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>在上方找到了GetWindowTextA函数，会将Name的长度与5进行比较，大于等于5才能进行下一步。<br><img src="https://img-blog.csdnimg.cn/20200323001109951.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>按f9进行运行，Name和Code按照如下填写，点击Checkme。<br><img src="https://img-blog.csdnimg.cn/202003230013179.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>会发现程序被断在GetWindowTextA函数下方。按f8步步跟，发现经过CM3.00402ED0函数后，Name通过[local.1]局部变量被赋值给eax，变为DiKeNabcde。在堆栈中可以查看到。<br><img src="https://img-blog.csdnimg.cn/20200323001339916.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>继续运行，edx=0xA，猜想这里edx应该是DiKeNabcde的长度，即修改过后的Name（后面用name代替）的长度，同时eax被赋值为存储name的内存地址。<br><img src="https://img-blog.csdnimg.cn/2020032300143071.png#pic_center" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200323001440608.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>0x03 关键函数</p>
<p>接着按f9运行后，发现程序被断在CM3.00404224函数处，并且输入的Code变为012345（后面用code代替），而进入函数前esi为0x5F9501CE，可以想到该函数会对code进行运算处理，从而进行最终判断。按f7进入函数查看。</p>
<p><img src="https://img-blog.csdnimg.cn/20200323001616210.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>进入函数后，在函数下方发现了关键的循环函数，eax作为计数器，从1开始累加，循环code的长度次数后结束循环。<br><img src="https://img-blog.csdnimg.cn/20200323001649710.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>可以发现在结束循环后，存放最终结果的ebx变为0x00003039，而变为十进制后正是12345，eax中存放着局部变量012345的堆栈地址。同时esi的值依然为0x5F9501CE，并没有发生变化。<br><img src="https://img-blog.csdnimg.cn/20200323001712414.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>继续运行会回到最终判断条件的位置，此时esi为0x5F9501CE，而eax为0x00003039。这里可以猜想，是否是输入Code的值与0x5F9501CE即可成功。<br><img src="https://img-blog.csdnimg.cn/20200323001758314.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>进行两组实验后发现果然如此。<br><img src="https://img-blog.csdnimg.cn/20200323001845960.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>0x04 对于注册机的探究</p>
<p>至此为止大致流程已经清楚，即只要我们获取esi根据name生成的值，并转换为十进制即可得到正确的Code。接下来对esi的生成进行探究。<br>从头运行，发现esi的值是由CM3.00403DF0函数得出的，跟入该函数查看。</p>
<p><img src="https://img-blog.csdnimg.cn/2020032300225910.png#pic_center" alt="在这里插入图片描述"></p>
<p>一进去即可看到关键的循环函数，这里的地址也符合开头CRC32算法所在的位置。edx是计数器，循环name长度的次数。</p>
<p><img src="https://img-blog.csdnimg.cn/20200323002348298.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>其中edi在循环过程中一直为0所以直接省略，最终结果存放在eax中，并且会在后面赋值给esi。<br>这里有一个困惑的点就是对于dword ptr ds:[]数组的构建，<br>dword ptr ds:[edi+eax<em>4]本意指将 [edi+eax</em>4] 的双字节段地址里的内容赋值给ebx，一开始没有想到好的办法去构造。后来在网上查询找到了直接将内存中的数据转化为数组的插件，非常好用，效果如下：</p>
<p><img src="https://img-blog.csdnimg.cn/20200324101617505.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200324101631768.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>注册机如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> memory[<span class="number">300</span>] = &#123;<span class="number">0x00000000</span>, <span class="number">0x77073096</span>, <span class="number">0xEE0E612C</span>, <span class="number">0x990951BA</span>, <span class="number">0x076DC419</span>, <span class="number">0x706AF48F</span>, <span class="number">0xE963A535</span>, <span class="number">0x9E6495A3</span>, <span class="number">0x0EDB8832</span>, <span class="number">0x79DCB8A4</span>, </span><br><span class="line">  <span class="number">0xE0D5E91E</span>, <span class="number">0x97D2D988</span>, <span class="number">0x09B64C2B</span>, <span class="number">0x7EB17CBD</span>, <span class="number">0xE7B82D07</span>, <span class="number">0x90BF1D91</span>, <span class="number">0x1DB71064</span>, <span class="number">0x6AB020F2</span>, <span class="number">0xF3B97148</span>, <span class="number">0x84BE41DE</span>, </span><br><span class="line">  <span class="number">0x1ADAD47D</span>, <span class="number">0x6DDDE4EB</span>, <span class="number">0xF4D4B551</span>, <span class="number">0x83D385C7</span>, <span class="number">0x136C9856</span>, <span class="number">0x646BA8C0</span>, <span class="number">0xFD62F97A</span>, <span class="number">0x8A65C9EC</span>, <span class="number">0x14015C4F</span>, <span class="number">0x63066CD9</span>, </span><br><span class="line">  <span class="number">0xFA0F3D63</span>, <span class="number">0x8D080DF5</span>, <span class="number">0x3B6E20C8</span>, <span class="number">0x4C69105E</span>, <span class="number">0xD56041E4</span>, <span class="number">0xA2677172</span>, <span class="number">0x3C03E4D1</span>, <span class="number">0x4B04D447</span>, <span class="number">0xD20D85FD</span>, <span class="number">0xA50AB56B</span>, </span><br><span class="line">  <span class="number">0x35B5A8FA</span>, <span class="number">0x42B2986C</span>, <span class="number">0xDBBBC9D6</span>, <span class="number">0xACBCF940</span>, <span class="number">0x32D86CE3</span>, <span class="number">0x45DF5C75</span>, <span class="number">0xDCD60DCF</span>, <span class="number">0xABD13D59</span>, <span class="number">0x26D930AC</span>, <span class="number">0x51DE003A</span>, </span><br><span class="line">  <span class="number">0xC8D75180</span>, <span class="number">0xBFD06116</span>, <span class="number">0x21B4F4B5</span>, <span class="number">0x56B3C423</span>, <span class="number">0xCFBA9599</span>, <span class="number">0xB8BDA50F</span>, <span class="number">0x2802B89E</span>, <span class="number">0x5F058808</span>, <span class="number">0xC60CD9B2</span>, <span class="number">0xB10BE924</span>, </span><br><span class="line">  <span class="number">0x2F6F7C87</span>, <span class="number">0x58684C11</span>, <span class="number">0xC1611DAB</span>, <span class="number">0xB6662D3D</span>, <span class="number">0x76DC4190</span>, <span class="number">0x01DB7106</span>, <span class="number">0x98D220BC</span>, <span class="number">0xEFD5102A</span>, <span class="number">0x71B18589</span>, <span class="number">0x06B6B51F</span>, </span><br><span class="line">  <span class="number">0x9FBFE4A5</span>, <span class="number">0xE8B8D433</span>, <span class="number">0x7807C9A2</span>, <span class="number">0x0F00F934</span>, <span class="number">0x9609A88E</span>, <span class="number">0xE10E9818</span>, <span class="number">0x7F6A0DBB</span>, <span class="number">0x086D3D2D</span>, <span class="number">0x91646C97</span>, <span class="number">0xE6635C01</span>, </span><br><span class="line">  <span class="number">0x6B6B51F4</span>, <span class="number">0x1C6C6162</span>, <span class="number">0x856530D8</span>, <span class="number">0xF262004E</span>, <span class="number">0x6C0695ED</span>, <span class="number">0x1B01A57B</span>, <span class="number">0x8208F4C1</span>, <span class="number">0xF50FC457</span>, <span class="number">0x65B0D9C6</span>, <span class="number">0x12B7E950</span>, </span><br><span class="line">  <span class="number">0x8BBEB8EA</span>, <span class="number">0xFCB9887C</span>, <span class="number">0x62DD1DDF</span>, <span class="number">0x15DA2D49</span>, <span class="number">0x8CD37CF3</span>, <span class="number">0xFBD44C65</span>, <span class="number">0x4DB26158</span>, <span class="number">0x3AB551CE</span>, <span class="number">0xA3BC0074</span>, <span class="number">0xD4BB30E2</span>, </span><br><span class="line">  <span class="number">0x4ADFA541</span>, <span class="number">0x3DD895D7</span>, <span class="number">0xA4D1C46D</span>, <span class="number">0xD3D6F4FB</span>, <span class="number">0x4369E96A</span>, <span class="number">0x346ED9FC</span>, <span class="number">0xAD678846</span>, <span class="number">0xDA60B8D0</span>, <span class="number">0x44042D73</span>, <span class="number">0x33031DE5</span>, </span><br><span class="line">  <span class="number">0xAA0A4C5F</span>, <span class="number">0xDD0D7CC9</span>, <span class="number">0x5005713C</span>, <span class="number">0x270241AA</span>, <span class="number">0xBE0B1010</span>, <span class="number">0xC90C2086</span>, <span class="number">0x5768B525</span>, <span class="number">0x206F85B3</span>, <span class="number">0xB966D409</span>, <span class="number">0xCE61E49F</span>, </span><br><span class="line">  <span class="number">0x5EDEF90E</span>, <span class="number">0x29D9C998</span>, <span class="number">0xB0D09822</span>, <span class="number">0xC7D7A8B4</span>, <span class="number">0x59B33D17</span>, <span class="number">0x2EB40D81</span>, <span class="number">0xB7BD5C3B</span>, <span class="number">0xC0BA6CAD</span>, <span class="number">0xEDB88320</span>, <span class="number">0x9ABFB3B6</span>, </span><br><span class="line">  <span class="number">0x03B6E20C</span>, <span class="number">0x74B1D29A</span>, <span class="number">0xEAD54739</span>, <span class="number">0x9DD277AF</span>, <span class="number">0x04DB2615</span>, <span class="number">0x73DC1683</span>, <span class="number">0xE3630B12</span>, <span class="number">0x94643B84</span>, <span class="number">0x0D6D6A3E</span>, <span class="number">0x7A6A5AA8</span>, </span><br><span class="line">  <span class="number">0xE40ECF0B</span>, <span class="number">0x9309FF9D</span>, <span class="number">0x0A00AE27</span>, <span class="number">0x7D079EB1</span>, <span class="number">0xF00F9344</span>, <span class="number">0x8708A3D2</span>, <span class="number">0x1E01F268</span>, <span class="number">0x6906C2FE</span>, <span class="number">0xF762575D</span>, <span class="number">0x806567CB</span>, </span><br><span class="line">  <span class="number">0x196C3671</span>, <span class="number">0x6E6B06E7</span>, <span class="number">0xFED41B76</span>, <span class="number">0x89D32BE0</span>, <span class="number">0x10DA7A5A</span>, <span class="number">0x67DD4ACC</span>, <span class="number">0xF9B9DF6F</span>, <span class="number">0x8EBEEFF9</span>, <span class="number">0x17B7BE43</span>, <span class="number">0x60B08ED5</span>, </span><br><span class="line">  <span class="number">0xD6D6A3E8</span>, <span class="number">0xA1D1937E</span>, <span class="number">0x38D8C2C4</span>, <span class="number">0x4FDFF252</span>, <span class="number">0xD1BB67F1</span>, <span class="number">0xA6BC5767</span>, <span class="number">0x3FB506DD</span>, <span class="number">0x48B2364B</span>, <span class="number">0xD80D2BDA</span>, <span class="number">0xAF0A1B4C</span>, </span><br><span class="line">  <span class="number">0x36034AF6</span>, <span class="number">0x41047A60</span>, <span class="number">0xDF60EFC3</span>, <span class="number">0xA867DF55</span>, <span class="number">0x316E8EEF</span>, <span class="number">0x4669BE79</span>, <span class="number">0xCB61B38C</span>, <span class="number">0xBC66831A</span>, <span class="number">0x256FD2A0</span>, <span class="number">0x5268E236</span>, </span><br><span class="line">  <span class="number">0xCC0C7795</span>, <span class="number">0xBB0B4703</span>, <span class="number">0x220216B9</span>, <span class="number">0x5505262F</span>, <span class="number">0xC5BA3BBE</span>, <span class="number">0xB2BD0B28</span>, <span class="number">0x2BB45A92</span>, <span class="number">0x5CB36A04</span>, <span class="number">0xC2D7FFA7</span>, <span class="number">0xB5D0CF31</span>, </span><br><span class="line">  <span class="number">0x2CD99E8B</span>, <span class="number">0x5BDEAE1D</span>, <span class="number">0x9B64C2B0</span>, <span class="number">0xEC63F226</span>, <span class="number">0x756AA39C</span>, <span class="number">0x026D930A</span>, <span class="number">0x9C0906A9</span>, <span class="number">0xEB0E363F</span>, <span class="number">0x72076785</span>, <span class="number">0x05005713</span>, </span><br><span class="line">  <span class="number">0x95BF4A82</span>, <span class="number">0xE2B87A14</span>, <span class="number">0x7BB12BAE</span>, <span class="number">0x0CB61B38</span>, <span class="number">0x92D28E9B</span>, <span class="number">0xE5D5BE0D</span>, <span class="number">0x7CDCEFB7</span>, <span class="number">0x0BDBDF21</span>, <span class="number">0x86D3D2D4</span>, <span class="number">0xF1D4E242</span>, </span><br><span class="line">  <span class="number">0x68DDB3F8</span>, <span class="number">0x1FDA836E</span>, <span class="number">0x81BE16CD</span>, <span class="number">0xF6B9265B</span>, <span class="number">0x6FB077E1</span>, <span class="number">0x18B74777</span>, <span class="number">0x88085AE6</span>, <span class="number">0xFF0F6A70</span>, <span class="number">0x66063BCA</span>, <span class="number">0x11010B5C</span>, </span><br><span class="line">  <span class="number">0x8F659EFF</span>, <span class="number">0xF862AE69</span>, <span class="number">0x616BFFD3</span>, <span class="number">0x166CCF45</span>, <span class="number">0xA00AE278</span>, <span class="number">0xD70DD2EE</span>, <span class="number">0x4E048354</span>, <span class="number">0x3903B3C2</span>, <span class="number">0xA7672661</span>, <span class="number">0xD06016F7</span>, </span><br><span class="line">  <span class="number">0x4969474D</span>, <span class="number">0x3E6E77DB</span>, <span class="number">0xAED16A4A</span>, <span class="number">0xD9D65ADC</span>, <span class="number">0x40DF0B66</span>, <span class="number">0x37D83BF0</span>, <span class="number">0xA9BCAE53</span>, <span class="number">0xDEBB9EC5</span>, <span class="number">0x47B2CF7F</span>, <span class="number">0x30B5FFE9</span>, </span><br><span class="line">  <span class="number">0xBDBDF21C</span>, <span class="number">0xCABAC28A</span>, <span class="number">0x53B39330</span>, <span class="number">0x24B4A3A6</span>, <span class="number">0xBAD03605</span>, <span class="number">0xCDD70693</span>, <span class="number">0x54DE5729</span>, <span class="number">0x23D967BF</span>, <span class="number">0xB3667A2E</span>, <span class="number">0xC4614AB8</span>, </span><br><span class="line">  <span class="number">0x5D681B02</span>, <span class="number">0x2A6F2B94</span>, <span class="number">0xB40BBE37</span>, <span class="number">0xC30C8EA1</span>, <span class="number">0x5A05DF1B</span>&#125;;</span><br><span class="line">  <span class="keyword">int</span> edx = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> ebx = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> eax = <span class="number">0xFFFFFFFF</span>;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> al = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> shed = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">string</span> str1 = <span class="string">"DiKeN"</span>;</span><br><span class="line">  <span class="built_in">string</span> name;  </span><br><span class="line">  </span><br><span class="line">  <span class="built_in">cout</span>&lt;&lt;<span class="string">"Name:"</span>;</span><br><span class="line">  getline(<span class="built_in">cin</span>, name);</span><br><span class="line">  name = str1 + name;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (edx=name.length(); edx&gt;<span class="number">0</span>; edx--)</span><br><span class="line">  &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 仅保留eax的低八位</span></span><br><span class="line">    al = eax &amp; <span class="number">0xFF</span>;</span><br><span class="line">    al = al ^ name[name.length()-edx];</span><br><span class="line">    <span class="comment">// 更新eax的低八位</span></span><br><span class="line">    eax = (eax &amp; <span class="number">0xffffff00</span>) | al;</span><br><span class="line">    </span><br><span class="line">    shed = eax;</span><br><span class="line">    al = eax &amp; <span class="number">0xFF</span>;</span><br><span class="line">    ebx = memory[al];</span><br><span class="line"></span><br><span class="line">    eax = shed;</span><br><span class="line">    eax = eax &gt;&gt; <span class="number">8</span>;</span><br><span class="line">    eax = eax^ebx;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  eax = eax^<span class="number">0xFFFFFFFF</span>;</span><br><span class="line">  <span class="built_in">cout</span>&lt;&lt;<span class="string">"Code:"</span>&lt;&lt;eax&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">  system(<span class="string">"pause:"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输入Name即可得到对应的Code：</p>
<p><img src="https://img-blog.csdnimg.cn/20200324101718240.png#pic_center" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/2020032410180810.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reverse/" rel="tag">Reverse</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Tensorflow2-0-利用卷积神经网络实现简单的验证码识别" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/03/17/Tensorflow2-0-%E5%88%A9%E7%94%A8%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB/"
    >Tensorflow2.0 利用卷积神经网络实现简单的验证码识别</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/03/17/Tensorflow2-0-%E5%88%A9%E7%94%A8%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB/" class="article-date">
  <time datetime="2020-03-17T13:50:47.000Z" itemprop="datePublished">2020-03-17</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p><a href="https://my.oschina.net/u/4105485/blog/3042460" target="_blank" rel="noopener">原文地址</a></p>
<h3 id="0x01-验证码生成及预处理"><a href="#0x01-验证码生成及预处理" class="headerlink" title="0x01 验证码生成及预处理"></a>0x01 验证码生成及预处理</h3><p>验证码的内容是10个数字0~9，小写英文字母和大写英文字母，所以总的字符量为62种</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">number &#x3D; [&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;]</span><br><span class="line">alphabet &#x3D; [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;, &#39;g&#39;, &#39;h&#39;, &#39;i&#39;, &#39;j&#39;, &#39;k&#39;, &#39;l&#39;, &#39;m&#39;, &#39;n&#39;, &#39;o&#39;, &#39;p&#39;, &#39;q&#39;, &#39;r&#39;, &#39;s&#39;, &#39;t&#39;, &#39;u&#39;,</span><br><span class="line">            &#39;v&#39;, &#39;w&#39;, &#39;x&#39;, &#39;y&#39;, &#39;z&#39;]</span><br><span class="line">ALPHABET &#x3D; [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;, &#39;E&#39;, &#39;F&#39;, &#39;G&#39;, &#39;H&#39;, &#39;I&#39;, &#39;J&#39;, &#39;K&#39;, &#39;L&#39;, &#39;M&#39;, &#39;N&#39;, &#39;O&#39;, &#39;P&#39;, &#39;Q&#39;, &#39;R&#39;, &#39;S&#39;, &#39;T&#39;, &#39;U&#39;,</span><br><span class="line">            &#39;V&#39;, &#39;W&#39;, &#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;]</span><br><span class="line">CHAR_SET &#x3D; number + alphabet + ALPHABET</span><br></pre></td></tr></table></figure>
<p>可以看到生成的验证码都是带干扰线干扰点，并且各种颜色和变形处理都是有的<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9vc2NpbWcub3NjaGluYS5uZXQvb3NjbmV0LzQxM2FkZGUwZDNhZjk5Mzk5M2Y5MzNkNWQ2MDJiYTM5MGEzLmpwZw?x-oss-process=image/format,png" alt="在这里插入图片描述"><br>首先将图片转成numpy数组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">captcha_image &#x3D; Image.open(captcha)</span><br><span class="line">captcha_image &#x3D; np.array(captcha_image)</span><br></pre></td></tr></table></figure>
<p>根据分析，这类验证码的颜色对我们的识别没有影响，所以将图像进行预处理——灰度化（根据图片的不同可以做灰度化或者二值化等预处理操作）</p>
<p>这里使用的是求均值的方法（正规的方法应该是RGB三个通道上按照一定的比例取值）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gray &#x3D; np.mean(img, -1)</span><br></pre></td></tr></table></figure>

<h3 id="0x02-建立卷积神经网络"><a href="#0x02-建立卷积神经网络" class="headerlink" title="0x02 建立卷积神经网络"></a>0x02 建立卷积神经网络</h3><p>1.输入的图片为160 * 60的，灰度化预处理以后为一维数组，每张图片总共有9600个输入值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IMAGE_HEIGHT &#x3D; 60</span><br><span class="line">IMAGE_WIDTH &#x3D; 160</span><br></pre></td></tr></table></figure>

<p>2.输出的字符集有62个字符，并且每张图片有4位字符，总共有4 * 62 = 248个输出值（下面的batch_size为每批训练的图片数量）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">batch_y &#x3D; np.zeros([batch_size, MAX_CAPTCHA, CHAR_SET_LEN])</span><br></pre></td></tr></table></figure>

<p>3.输入层有9600个值，输出层有248个值，如果使用全连接层作为隐藏层则会需要天量的计算</p>
<p>所以需要先使用卷积核池化操作尽可能的减少计算量，图片像素不高，所以使用的卷积核和池大小不能太大，优先考虑3 * 3 和5 * 5 的卷积核，池大小使用2 * 2</p>
<p>按照下面的神经网络模型，卷积池化以后的输出应该是128 * 17 * 5 = 10880（如果最后一层的深度仍然使用64的话，大小会减为一半）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">model.add(tf.keras.layers.Conv2D(32, (3, 3)))</span><br><span class="line">model.add(tf.keras.layers.PReLU())</span><br><span class="line">model.add(tf.keras.layers.MaxPool2D((2, 2), strides&#x3D;2))</span><br><span class="line"></span><br><span class="line">model.add(tf.keras.layers.Conv2D(64, (5, 5)))</span><br><span class="line">model.add(tf.keras.layers.PReLU())</span><br><span class="line">model.add(tf.keras.layers.MaxPool2D((2, 2), strides&#x3D;2))</span><br><span class="line"></span><br><span class="line">model.add(tf.keras.layers.Conv2D(128, (5, 5)))</span><br><span class="line">model.add(tf.keras.layers.PReLU())</span><br><span class="line">model.add(tf.keras.layers.MaxPool2D((2, 2), strides&#x3D;2))</span><br></pre></td></tr></table></figure>

<p>4.输出的的每一位的字符之间没有关联关系，所以仍然将输出值看成4组，需要将输出值调整为(4, 62)的数组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">model.add(tf.keras.layers.Flatten())</span><br><span class="line">model.add(tf.keras.layers.Dense(MAX_CAPTCHA * CHAR_SET_LEN))</span><br><span class="line">model.add(tf.keras.layers.Reshape([MAX_CAPTCHA, CHAR_SET_LEN]))</span><br></pre></td></tr></table></figure>

<p>6.识别的原理是计算每一位字符上某个字符出现的可能性最大，所以每张图片都是一个4位的多分类问题，最终输出使用softmax进行归一化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.add(tf.keras.layers.Softmax())</span><br></pre></td></tr></table></figure>

<p>7.在tensorflow2.0中softmax对应的损失函数是categorical_crossentropy，按照这个来配置模型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">model.compile(optimizer&#x3D;&#39;Adam&#39;,</span><br><span class="line">              metrics&#x3D;[&#39;accuracy&#39;],</span><br><span class="line">              loss&#x3D;&#39;categorical_crossentropy&#39;)</span><br></pre></td></tr></table></figure>

<p>8.最后将可能性最大的那个下标取出，作为字符集的下标，获取实际对应的字符（当然我们在训练的时候没有必要转化为字符，直接下标比较一下是否正确就可以了）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prediction_value &#x3D; vec2text(np.argmax(prediction_value, axis&#x3D;2)[0])</span><br></pre></td></tr></table></figure>

<h3 id="0x03-训练模型"><a href="#0x03-训练模型" class="headerlink" title="0x03 训练模型"></a>0x03 训练模型</h3><p>使用一个循环逻辑开启训练，每批训练512张图片，每批训练4次</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for times in range(500000):</span><br><span class="line">    batch_x, batch_y &#x3D; get_next_batch(512)</span><br><span class="line">    model.fit(batch_x, batch_y, epochs&#x3D;4)</span><br><span class="line">    print(&quot;y预测&#x3D;\n&quot;, np.argmax(model.predict(batch_x), axis&#x3D;2))</span><br><span class="line">    print(&quot;y实际&#x3D;\n&quot;, np.argmax(batch_y, axis&#x3D;2))</span><br></pre></td></tr></table></figure>

<p>刚开始的时候可能损失值会在4左右徘徊，多跑几个批次以后损失值会明显下降，精确度accuracy也会直线上升</p>
<p>下面可以看到每批的第一次训练结果中精确度只有不到60%，而在第四次训练结果中精确度基本上都能达到99%以上</p>
<p>但是这个精确度达到99%了也不能说明整个模型就训练结束了，这个精确度只是针对这一批512张图片来说的</p>
<p>毕竟4位验证码有62 * 62 * 62 * 62种可能，训练集并不能代表所有的可能性，所以我们需要使用新生成的验证码来证明整个训练结果是否能结束</p>
<h3 id="0x04-完整代码"><a href="#0x04-完整代码" class="headerlink" title="0x04 完整代码"></a>0x04 完整代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> captcha.image <span class="keyword">import</span> ImageCaptcha</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">number = [<span class="string">'0'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'6'</span>, <span class="string">'7'</span>, <span class="string">'8'</span>, <span class="string">'9'</span>]</span><br><span class="line">alphabet = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>, <span class="string">'g'</span>, <span class="string">'h'</span>, <span class="string">'i'</span>, <span class="string">'j'</span>, <span class="string">'k'</span>, <span class="string">'l'</span>, <span class="string">'m'</span>, <span class="string">'n'</span>, <span class="string">'o'</span>, <span class="string">'p'</span>, <span class="string">'q'</span>, <span class="string">'r'</span>, <span class="string">'s'</span>, <span class="string">'t'</span>, <span class="string">'u'</span>,</span><br><span class="line">            <span class="string">'v'</span>, <span class="string">'w'</span>, <span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'z'</span>]</span><br><span class="line">ALPHABET = [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>, <span class="string">'G'</span>, <span class="string">'H'</span>, <span class="string">'I'</span>, <span class="string">'J'</span>, <span class="string">'K'</span>, <span class="string">'L'</span>, <span class="string">'M'</span>, <span class="string">'N'</span>, <span class="string">'O'</span>, <span class="string">'P'</span>, <span class="string">'Q'</span>, <span class="string">'R'</span>, <span class="string">'S'</span>, <span class="string">'T'</span>, <span class="string">'U'</span>,</span><br><span class="line">            <span class="string">'V'</span>, <span class="string">'W'</span>, <span class="string">'X'</span>, <span class="string">'Y'</span>, <span class="string">'Z'</span>]</span><br><span class="line">SAVE_PATH = <span class="string">"D:\\Programming\\TF2.0 Verification Code"</span></span><br><span class="line">CHAR_SET = number + alphabet + ALPHABET</span><br><span class="line">CHAR_SET_LEN = len(CHAR_SET)</span><br><span class="line">IMAGE_HEIGHT = <span class="number">60</span></span><br><span class="line">IMAGE_WIDTH = <span class="number">160</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_captcha_text</span><span class="params">(char_set=None, captcha_size=<span class="number">4</span>)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> char_set <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        char_set = number + alphabet + ALPHABET</span><br><span class="line"></span><br><span class="line">    captcha_text = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(captcha_size):</span><br><span class="line">        c = random.choice(char_set)</span><br><span class="line">        captcha_text.append(c)</span><br><span class="line">    <span class="keyword">return</span> captcha_text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_captcha_text_and_image</span><span class="params">(width=<span class="number">160</span>, height=<span class="number">60</span>, char_set=CHAR_SET)</span>:</span></span><br><span class="line">    image = ImageCaptcha(width=width, height=height)</span><br><span class="line"></span><br><span class="line">    captcha_text = random_captcha_text(char_set)</span><br><span class="line">    captcha_text = <span class="string">''</span>.join(captcha_text)</span><br><span class="line"></span><br><span class="line">    captcha = image.generate(captcha_text)</span><br><span class="line"></span><br><span class="line">    captcha_image = Image.open(captcha)</span><br><span class="line">    captcha_image = np.array(captcha_image)</span><br><span class="line">    <span class="keyword">return</span> captcha_text, captcha_image</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">text, image = gen_captcha_text_and_image(char_set=CHAR_SET)</span><br><span class="line">MAX_CAPTCHA = len(text)</span><br><span class="line">print(<span class="string">'CHAR_SET_LEN='</span>, CHAR_SET_LEN, <span class="string">' MAX_CAPTCHA='</span>, MAX_CAPTCHA)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert2gray</span><span class="params">(img)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(img.shape) &gt; <span class="number">2</span>:</span><br><span class="line">        gray = np.mean(img, <span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">return</span> gray</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> img</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">text2vec</span><span class="params">(text)</span>:</span></span><br><span class="line">    vector = np.zeros([MAX_CAPTCHA, CHAR_SET_LEN])</span><br><span class="line">    <span class="keyword">for</span> i, c <span class="keyword">in</span> enumerate(text):</span><br><span class="line">        idx = CHAR_SET.index(c)</span><br><span class="line">        vector[i][idx] = <span class="number">1.0</span></span><br><span class="line">    <span class="keyword">return</span> vector</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">vec2text</span><span class="params">(vec)</span>:</span></span><br><span class="line">    text = []</span><br><span class="line">    <span class="keyword">for</span> i, c <span class="keyword">in</span> enumerate(vec):</span><br><span class="line">        text.append(CHAR_SET[c])</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>.join(text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_next_batch</span><span class="params">(batch_size=<span class="number">128</span>)</span>:</span></span><br><span class="line">    batch_x = np.zeros([batch_size, IMAGE_HEIGHT, IMAGE_WIDTH, <span class="number">1</span>])</span><br><span class="line">    batch_y = np.zeros([batch_size, MAX_CAPTCHA, CHAR_SET_LEN])</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrap_gen_captcha_text_and_image</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            text, image = gen_captcha_text_and_image(char_set=CHAR_SET)</span><br><span class="line">            <span class="keyword">if</span> image.shape == (<span class="number">60</span>, <span class="number">160</span>, <span class="number">3</span>):</span><br><span class="line">                <span class="keyword">return</span> text, image</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(batch_size):</span><br><span class="line">        text, image = wrap_gen_captcha_text_and_image()</span><br><span class="line">        image = tf.reshape(convert2gray(image), (IMAGE_HEIGHT, IMAGE_WIDTH, <span class="number">1</span>))</span><br><span class="line">        batch_x[i, :] = image</span><br><span class="line">        batch_y[i, :] = text2vec(text)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> batch_x, batch_y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_captcha_cnn</span><span class="params">()</span>:</span></span><br><span class="line">    model = tf.keras.Sequential()</span><br><span class="line"></span><br><span class="line">    model.add(tf.keras.layers.Conv2D(<span class="number">32</span>, (<span class="number">3</span>, <span class="number">3</span>)))</span><br><span class="line">    model.add(tf.keras.layers.PReLU())</span><br><span class="line">    model.add(tf.keras.layers.MaxPool2D((<span class="number">2</span>, <span class="number">2</span>), strides=<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">    model.add(tf.keras.layers.Conv2D(<span class="number">64</span>, (<span class="number">5</span>, <span class="number">5</span>)))</span><br><span class="line">    model.add(tf.keras.layers.PReLU())</span><br><span class="line">    model.add(tf.keras.layers.MaxPool2D((<span class="number">2</span>, <span class="number">2</span>), strides=<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">    model.add(tf.keras.layers.Conv2D(<span class="number">128</span>, (<span class="number">5</span>, <span class="number">5</span>)))</span><br><span class="line">    model.add(tf.keras.layers.PReLU())</span><br><span class="line">    model.add(tf.keras.layers.MaxPool2D((<span class="number">2</span>, <span class="number">2</span>), strides=<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">    model.add(tf.keras.layers.Flatten())</span><br><span class="line">    model.add(tf.keras.layers.Dense(MAX_CAPTCHA * CHAR_SET_LEN))</span><br><span class="line">    model.add(tf.keras.layers.Reshape([MAX_CAPTCHA, CHAR_SET_LEN]))</span><br><span class="line"></span><br><span class="line">    model.add(tf.keras.layers.Softmax())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> model</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        model = tf.keras.models.load_model(SAVE_PATH + <span class="string">'model'</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">'#######Exception'</span>, e)</span><br><span class="line">        model = crack_captcha_cnn()</span><br><span class="line"></span><br><span class="line">    model.compile(optimizer=<span class="string">'Adam'</span>,</span><br><span class="line">                  metrics=[<span class="string">'accuracy'</span>],</span><br><span class="line">                  loss=<span class="string">'categorical_crossentropy'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> times <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        batch_x, batch_y = get_next_batch(<span class="number">512</span>)</span><br><span class="line">        print(<span class="string">'times='</span>, times, <span class="string">' batch_x.shape='</span>, batch_x.shape, <span class="string">' batch_y.shape='</span>, batch_y.shape)</span><br><span class="line">        model.fit(batch_x, batch_y, epochs=<span class="number">4</span>)</span><br><span class="line">        print(<span class="string">"y预测=\n"</span>, np.argmax(model.predict(batch_x), axis=<span class="number">2</span>))</span><br><span class="line">        print(<span class="string">"y实际=\n"</span>, np.argmax(batch_y, axis=<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> == times % <span class="number">10</span>:</span><br><span class="line">            print(<span class="string">"save model at times="</span>, times)</span><br><span class="line">            model.save(SAVE_PATH + <span class="string">'model'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">()</span>:</span></span><br><span class="line">    model = tf.keras.models.load_model(SAVE_PATH + <span class="string">'model'</span>)</span><br><span class="line">    success = <span class="number">0</span></span><br><span class="line">    count = <span class="number">100</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> range(count):</span><br><span class="line">        data_x, data_y = get_next_batch(<span class="number">1</span>)</span><br><span class="line">        prediction_value = model.predict(data_x)</span><br><span class="line">        data_y = vec2text(np.argmax(data_y, axis=<span class="number">2</span>)[<span class="number">0</span>])</span><br><span class="line">        prediction_value = vec2text(np.argmax(prediction_value, axis=<span class="number">2</span>)[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> data_y.upper() == prediction_value.upper():</span><br><span class="line">            print(<span class="string">"y预测="</span>, prediction_value, <span class="string">"y实际="</span>, data_y, <span class="string">"预测成功。"</span>)</span><br><span class="line">            success += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">"y预测="</span>, prediction_value, <span class="string">"y实际="</span>, data_y, <span class="string">"预测失败。"</span>)</span><br><span class="line">        print(<span class="string">"预测"</span>, count, <span class="string">"次"</span>, <span class="string">"成功率="</span>, success / count)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    train()</span><br><span class="line">    predict()</span><br></pre></td></tr></table></figure>


      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tensorflow-2-0/" rel="tag">Tensorflow 2.0</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-160个CrackMe 0x17" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/03/09/160%E4%B8%AACrackMe%200x17/"
    >160个CrackMe 0x17</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/03/09/160%E4%B8%AACrackMe%200x17/" class="article-date">
  <time datetime="2020-03-09T12:00:00.000Z" itemprop="datePublished">2020-03-09</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="0x00-初步分析"><a href="#0x00-初步分析" class="headerlink" title="0x00 初步分析"></a>0x00 初步分析</h3><p>首先打开crackme，要求输入name和serial，但是并没有Check之类的字样，只有底部的Status显示当前的序列号不合法。点击底部的About，出现说明：找到符合name的serial，并且不允许修改程序。<br><img src="https://img-blog.csdnimg.cn/20200309192631260.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200309193510837.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>拖入OD中进行分析，利用查找字符串插件找寻到成功和失败字样。<br><img src="https://img-blog.csdnimg.cn/20200309194720903.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>点击进入。发现了判断成功的条件，即0x403167地址的值（以下用[166]代替）需等于0x10。而166的值会在call Chafe_1.00401453函数后发生改变，于是按回车进入函数。</p>
<h3 id="0x01-三段代码"><a href="#0x01-三段代码" class="headerlink" title="0x01 三段代码"></a>0x01 三段代码</h3><p>这里会发现三段代码，都断下之后按f9，发现程序会在三段代码之间来回跳，却一直无法输入name和serial，于是才想这个程序可能是持续循环的对name和serial进行判断。<br><img src="https://img-blog.csdnimg.cn/20200309194811253.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>将所有断点去掉后，填入name和serial，以便接下来进一步研究。<br><img src="https://img-blog.csdnimg.cn/20200309194825105.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>将所有断点恢复后，按下f9，会发现程序在代码段一三、代码段二三之间来回跳转，跳往一开始找到的最终判断点。<br>首先等程序断在代码段二之后，跟代码段二，发现这是一个GetDlgItemInt函数。它通过发送控件WM_GETTEXT消息来检索指定控件的文本。该函数通过剥离文本开头的任何额外的空格，然后转换十进制数字来翻译检索到的文本。该功能在到达文本末尾或遇到非数字字符时停止转换。简单来说就是会获取eax中的文本并赋值给188地址。而此时eax中的数为0x00BC614E（12345678），发现就是我们的serial。那么此时就可以知道，[188]=serial。</p>
<p><img src="https://img-blog.csdnimg.cn/20200309194916941.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>当程序断在代码段三以后，单步跟进行分析。[188] += 0x9112478，加完之后[188]==0则不跳转，不跳转则[166]可以加4。而此时可以看到[166] = 0xC，接着单步跟会发现程序来到开头的地方，进行赋值后最后[166]的值会跟0x10进行比较，相等则成功。<br>这意味着想要得到正确的serial就不能跳转，得让[166]加4，而要想不跳转[188]就得为<br>-0x9112478。这里要注意，计算机中负数进行加法得用他的补码来表示，而-0x9112478的补码为0xF6EEDB88。<br><img src="https://img-blog.csdnimg.cn/20200309194934605.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="0x02-核心算法"><a href="#0x02-核心算法" class="headerlink" title="0x02 核心算法"></a>0x02 核心算法</h3><p>那么[188]怎样才能为0xF6EEDB88呢？这就需要查看[188]到底经过了哪些算法变化。通过右键查找地址常量，就可以查看哪些地方出现了188地址。<br><img src="https://img-blog.csdnimg.cn/20200309195017853.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200309195049802.png" alt="在这里插入图片描述"><br>点击进去查看，会出现下方的代码。在代码段开头下断点，运行，会发现程序在跑完上方的代码段二后运行下方的代码，并且其中出现了我们的name。也就是说此时name存储在edi（通过lea操作edi获取18C地址）中，serial存储在[188]中。<br><img src="https://img-blog.csdnimg.cn/2020030919511040.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>18C地址中存放的是我们输入的用户名，被edi引用，[168]地址是一个计数器，用edi+[168]计数器进行偏移，168计数器初始为0，edi加完后，计数器累加1，然后取出[188]中我们输入序列号（数字格式，输入非数字会变为0）放入eax，eax加1后与edi（<strong>相当于取用户名计数器指针位置4字节，因为edi最多存放四个字节</strong>）异或运算，结果存入188地址，一直到计数器累加至0x10退出循环。经过16次循环后，[188]决定了是否能注册通过。</p>
<p>而最关键的异或步骤就是eax中的值与edi中的值异或，这里要注意，通过f8单步跟发现，每循环一次，name（存储在edi中）都会后移一位，相当于<br>[1234]5,1[2345], 12[345],123[45],1234[5]这样<strong>每次取四字节的运算方式</strong>。</p>
<p><img src="https://img-blog.csdnimg.cn/20200309195133416.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>知道了加密原理，接下来就可以写注册机。因为异或是可以逆向进行的，所以我们令<br>serial = 0xF6EEDB88，而name分别为1234[5], 123[45], 12[345],1[2345] ,[1234]5的逆向方式进行计算。并且还要注意不论长度十六次循环是一定要走完的。</p>
<h3 id="0x03-注册机实现"><a href="#0x03-注册机实现" class="headerlink" title="0x03 注册机实现"></a>0x03 注册机实现</h3><p>注册机算法如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">char</span> * name;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> serial = <span class="number">0xF6EEDB88</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> * p;</span><br><span class="line">    name = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">30</span>];</span><br><span class="line">    <span class="comment">// 对一片内存空间逐字节进行初始化，用0填充很重要</span></span><br><span class="line">    <span class="built_in">memset</span>(name, <span class="number">0</span>, <span class="built_in">strlen</span>(name));</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"name: "</span>;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0x10</span><span class="number">-1</span>; x &gt;= <span class="number">0</span>; x--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// unsigned long 确保四字节，这里p每次循环分别为一个长度为4的数组 </span></span><br><span class="line">        p = (<span class="keyword">unsigned</span> <span class="keyword">long</span> *) &amp;name[x];</span><br><span class="line">        serial = serial ^ *p;</span><br><span class="line">        serial--;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt;<span class="string">"serial: "</span> &lt;&lt;serial&lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    system(<span class="string">"pause"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>经过验证，注册机正确。<br><img src="https://img-blog.csdnimg.cn/20200309195712343.png" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200309195722682.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>参考资料：<a href="https://www.52pojie.cn/thread-670504-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-670504-1-1.html</a></p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reverse/" rel="tag">Reverse</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
  </article>
  

  
  <nav class="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul class="list-inline">
      <li>
        &copy;
        2015-2020
        Gengar
      </li>
      <li>
        
          Powered by
        
        
        <a href="https://hexo.io" target="_blank">Hexo</a> Theme <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul class="list-inline">
      <li>
        
        
        <span>
  <i>PV:<span id="busuanzi_value_page_pv"></span></i>
  <i>UV:<span id="busuanzi_value_site_uv"></span></i>
</span>
        
      </li>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>
    <div class="to_top">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>
      </div>
    </main>
      <aside class="sidebar">
        <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="Ayer"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
      </aside>
      <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
      
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>


<script src="/js/share.js"></script>



<script src="/fancybox/jquery.fancybox.min.js"></script>




<script>
  try {
    var typed = new Typed("#subtitle", {
    strings: ['Stay hungry. Stay foolish.','',''],
    startDelay: 0,
    typeSpeed: 200,
    loop: true,
    backSpeed: 100,
    showCursor: true
    });
  } catch (err) {
  }
  
</script>




<script>
  var ayerConfig = {
    mathjax: false
  }
</script>


<script src="/js/ayer.js"></script>


<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>




<script type="text/javascript" src="https://js.users.51.la/20544303.js"></script>
  </div>
</body>

</html>