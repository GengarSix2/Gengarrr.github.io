<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
    
  <meta name="description" content="一个兴趣使然的小站" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
     Ayer
  </title>
  <meta name="generator" content="hexo-theme-yilia-plus">
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  
<link rel="stylesheet" href="/css/style.css">

  
<script src="/js/pace.min.js"></script>


  

  

</head>

</html>

<body>
  <div id="app">
    <main class="content">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover1.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">Ayer</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>

<div id="main">
  <section class="outer">
  <article class="articles">
    
    
    
    
    <article id="post-二叉搜索树-增删改查(Python)" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/07/08/%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91-%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5(Python)/"
    >二叉搜索树-增删改查(Python)</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/07/08/%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91-%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5(Python)/" class="article-date">
  <time datetime="2020-07-08T09:00:04.000Z" itemprop="datePublished">2020-07-08</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="01-定义"><a href="#01-定义" class="headerlink" title="01 定义"></a>01 定义</h3><p>首先定义二叉树结点的数据类型：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, val, left=None, right=None)</span>:</span></span><br><span class="line">		self.val = val</span><br><span class="line">		self.left = left</span><br><span class="line">		self.right = right</span><br></pre></td></tr></table></figure>
<p>二叉搜索树的定义：<br><code>二叉搜索树（BST）</code>是二叉树的一种特殊表示形式，它满足如下特性：</p>
<p>每个节点中的值必须<code>大于</code>（或等于）存储在其左侧子树中的任何值。<br>每个节点中的值必须<code>小于</code>（或等于）存储在其右子树中的任何值。</p>
<p>下面是一个二叉搜索树的例子：</p>
<img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hbGl5dW4tbGMtdXBsb2FkLm9zcy1jbi1oYW5nemhvdS5hbGl5dW5jcy5jb20vYWxpeXVuLWxjLXVwbG9hZC91cGxvYWRzLzIwMTgvMDMvMTQvYnN0X2V4YW1wbGUtYTEucG5n?x-oss-process=image/format,png#pic_center" width="50%">

<h3 id="02-增操作"><a href="#02-增操作" class="headerlink" title="02 增操作"></a>02 增操作</h3><p>增加操作本质上与二叉树的遍历操作并无区别。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BinaryTree</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="comment"># 插入操作（增）</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, root, val)</span>:</span></span><br><span class="line">		<span class="keyword">if</span> root == <span class="literal">None</span>:</span><br><span class="line">			root = TreeNode(val)</span><br><span class="line">		<span class="keyword">elif</span> val &lt; root.val:</span><br><span class="line">			root.left = self.insert(root.left, val)</span><br><span class="line">		<span class="keyword">elif</span> val &gt; root.val:</span><br><span class="line">			root.right = self.insert(root.right, val)</span><br><span class="line">		<span class="keyword">return</span> root</span><br></pre></td></tr></table></figure>
<h3 id="03-删操作"><a href="#03-删操作" class="headerlink" title="03 删操作"></a>03 删操作</h3><p>删除操作复杂一些，根据子节点的个数，需要考虑如下三种情况：</p>
<ol>
<li>如果目标节点<strong>没有子节点</strong>，我们可以直接移除该目标节点。</li>
<li>如果目标节<strong>只有一个子节点</strong>，我们可以用其子节点作为替换。</li>
<li>如果目标节点<strong>有两个子节点</strong>，我们需要用其中序后继节点或者前驱节点来替换，再删除该目标节点。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除操作（删）</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self, root, key)</span>:</span></span><br><span class="line">		<span class="keyword">if</span> root == <span class="literal">None</span>:</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> root.val == key:</span><br><span class="line">			<span class="keyword">if</span> root.left==<span class="literal">None</span> <span class="keyword">and</span> root.right==<span class="literal">None</span>:</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">			<span class="keyword">elif</span> root.left!=<span class="literal">None</span> <span class="keyword">and</span> root.right!=<span class="literal">None</span>:</span><br><span class="line">				<span class="comment"># buffer用于存放要替换节点的父节点,tmp是要替换的节点</span></span><br><span class="line">				buffer = <span class="literal">None</span></span><br><span class="line">				temp = root.right</span><br><span class="line">				<span class="keyword">while</span> temp.left:</span><br><span class="line">					buffer = temp</span><br><span class="line">					temp = temp.left</span><br><span class="line">				root.val, temp.val = temp.val, root.val</span><br><span class="line">				<span class="keyword">if</span> buffer == <span class="literal">None</span>:</span><br><span class="line">					root.right = self.delete(temp, key)</span><br><span class="line">				<span class="keyword">else</span>:</span><br><span class="line">					buffer.left = self.delete(buffer, key)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			<span class="keyword">elif</span> root.left == <span class="literal">None</span>:</span><br><span class="line">				root = root.right</span><br><span class="line">			<span class="keyword">elif</span> root.right == <span class="literal">None</span>:</span><br><span class="line">				root = root.left</span><br><span class="line"></span><br><span class="line">		<span class="keyword">elif</span> root.val &gt; key:</span><br><span class="line">			root.left = self.delete(root.left, key)</span><br><span class="line">		<span class="keyword">elif</span> root.val &lt; key:</span><br><span class="line">			root.right = self.delete(root.right, key)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> root</span><br></pre></td></tr></table></figure>
<h3 id="04-改操作"><a href="#04-改操作" class="headerlink" title="04 改操作"></a>04 改操作</h3>这里的修改操作仅仅对结点值进行了修改，修改完以后并没有维护二叉搜索树的性质，后续还可以进一步改进。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改操作（改）</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">modify</span><span class="params">(self, root, val, new_val)</span>:</span></span><br><span class="line">		<span class="keyword">if</span> root == <span class="literal">None</span>:</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">		<span class="keyword">elif</span> root.val &gt; val:</span><br><span class="line">			<span class="keyword">return</span> self.modify(root.left, val, new_val)</span><br><span class="line">		<span class="keyword">elif</span> root.val &lt; val:</span><br><span class="line">			<span class="keyword">return</span> self.modify(root.right, val, new_val)</span><br><span class="line">		<span class="keyword">elif</span> root.val == val:</span><br><span class="line">			root.val = new_val</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<h3 id="04-查操作"><a href="#04-查操作" class="headerlink" title="04 查操作"></a>04 查操作</h3></li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查找操作（查）</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(self, root, val)</span>:</span></span><br><span class="line">		<span class="keyword">if</span> root == <span class="literal">None</span>:</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">		<span class="keyword">elif</span> root.val &gt; val:</span><br><span class="line">			<span class="keyword">return</span> self.search(root.left, val)</span><br><span class="line">		<span class="keyword">elif</span> root.val &lt; val:</span><br><span class="line">			<span class="keyword">return</span> self.search(root.right, val)</span><br><span class="line">		<span class="keyword">elif</span> root.val == val:</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>



      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Data-Structure/" rel="tag">Data Structure</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Leetcode-2-两数相加" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/09/Leetcode-2-%E4%B8%A4%E6%95%B0%E7%9B%B8%E5%8A%A0/"
    >Leetcode#2 两数相加</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/09/Leetcode-2-%E4%B8%A4%E6%95%B0%E7%9B%B8%E5%8A%A0/" class="article-date">
  <time datetime="2020-04-09T04:11:50.000Z" itemprop="datePublished">2020-04-09</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="两数相加"><a href="#两数相加" class="headerlink" title="两数相加"></a>两数相加</h3><img src="https://s1.ax1x.com/2020/04/09/G43d76.png" width="80%">   


<h3 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h3><p>链表的逆序排列本身就符合加法从低位运算至高位的规则，因此我们只需要顺序遍历链表，同时记录下进位即可。        </p>
<h3 id="链表的遍历"><a href="#链表的遍历" class="headerlink" title="链表的遍历"></a>链表的遍历</h3><p>这里有一个知识点是关于链表的遍历问题。在struct ListNode中有这样一句： ListNode(int x) : val(x), next(NULL) {}，这表明初始化支持 ListNode（int x）这种方式，即 把x赋给val，NULL赋值给next。</p>
<p>在遍历的同时，首先定义一个头结点newHead,同时定义一个nownode用来指向当前操作的结点。</p>
<h3 id="C-代码"><a href="#C-代码" class="headerlink" title="C++代码"></a>C++代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">struct ListNode &#123;</span><br><span class="line">    int val;</span><br><span class="line">    ListNode *next;</span><br><span class="line">    ListNode(int x) : val(x), next(NULL) &#123;&#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Solution &#123;</span><br><span class="line">public:</span><br><span class="line">    ListNode* addTwoNumbers(ListNode* l1, ListNode* l2) &#123;</span><br><span class="line">        int carry &#x3D; 0; &#x2F;&#x2F;记录进位</span><br><span class="line">        int sum &#x3D; 0; &#x2F;&#x2F;记录当前位和</span><br><span class="line">        ListNode* newhead &#x3D; new ListNode(0);</span><br><span class="line">        ListNode* nownode &#x3D; newhead;</span><br><span class="line"></span><br><span class="line">        while (l1 || l2 || carry)</span><br><span class="line">        &#123;</span><br><span class="line">            sum &#x3D; carry;</span><br><span class="line">            if (l1) sum +&#x3D; l1-&gt;val;</span><br><span class="line">            if (l2) sum +&#x3D; l2-&gt;val;</span><br><span class="line">            carry &#x3D; sum&#x2F;10;</span><br><span class="line">            sum %&#x3D; 10;</span><br><span class="line">            nownode-&gt;val &#x3D; sum;</span><br><span class="line"></span><br><span class="line">            ListNode* nextnode &#x3D; new ListNode(0);</span><br><span class="line">            nownode-&gt;next &#x3D; nextnode;</span><br><span class="line">            l1 &#x3D; l1?l1-&gt;next:nullptr;</span><br><span class="line">            l2 &#x3D; l2?l2-&gt;next:nullptr;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        return newhead;</span><br><span class="line">    &#125;      </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Data-Structure/" rel="tag">Data Structure</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-experiment-CM-1" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/04/05/experiment-CM-1/"
    >experiment-CM-1</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/04/05/experiment-CM-1/" class="article-date">
  <time datetime="2020-04-05T03:59:06.000Z" itemprop="datePublished">2020-04-05</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="0x01-初步查看"><a href="#0x01-初步查看" class="headerlink" title="0x01 初步查看"></a>0x01 初步查看</h3><p>首先使用PeiD查看，无壳。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405114644986.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>打开CM，查看serial输入处，点击Check it并没有出现任何提示框，并且发现任何除数字外的字符都无法输入。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405114713736.png#pic_center" alt="在这里插入图片描述"><br>将CM拖入OD中，利用查找中文字符串插件找到最终判断条件处。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405114740647.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>这里是最终判断条件，eax和esi相等则得到正确答案。现在要做的就是探寻eax和esi分别是如何得到的。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405114808363.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h3 id="0x02-进一步探寻"><a href="#0x02-进一步探寻" class="headerlink" title="0x02 进一步探寻"></a>0x02 进一步探寻</h3><p>将最终判断条件cmp eax,esi和上方的experime.004013D2断下，按f9运行。<br>进入到004013D2函数中，发现<br>最终返回的esi = 进入函数前esi的值 异或上 0x797A7553。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405114836259.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>而eax即为输入的serial。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405114854567.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>至此我们可以知道，只要知道了esi的生成规则，便可以完成破解。</p>
<h3 id="0x03-esi的生成规则"><a href="#0x03-esi的生成规则" class="headerlink" title="0x03 esi的生成规则"></a>0x03 esi的生成规则</h3><p>通过向上查看可以看到，esi是由[0x40339C]所赋值的。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405115617750.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>这里我们通过IDA来查看[0x40339C]是在哪里生成的，可以看到是通过调用VolumeNameBuffer函数所得到的。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405115133832.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>继续查看VolumeNameBuffer函数，在这里可以看到是调用0x0040142C地址处的GetVolumeInformationA函数。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405115149659.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>返回OD在0x0040142C处进行查看，可以看到GetVolumeInformationA函数的结果是”Windows”。在网上查询后可以看到，GetVolumeInformationA函数的作用是获取硬盘信息。此时我的exe处于C盘，而当我将他放在D盘后，可以看到此时生成的信息变为”DATA”，分别与本机C盘和D盘的名称相对应。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405115248729.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>继续运行，可以看到下方是一段循环，循环后的结果存放在edi中，正是后面我们查看到的最后一步“进入函数前esi的值”。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405115329624.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>这里需要说明一下esi的”Windows”与ecx的3都是GetVolumeInformationA函数中得到的。其中3的获取如下图所示。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405115343538.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>接下来对关键函数进行分析，分析结果在右侧。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405115435501.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>使用C++进行复现：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span>* Disk_name;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span>* ebx;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> eax = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> edi = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> ecx = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> i;</span><br><span class="line">    <span class="keyword">int</span> Disk_type = <span class="number">3</span>;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    Disk_name = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">10</span>];</span><br><span class="line">    <span class="built_in">memset</span>(Disk_name, <span class="number">0</span>, <span class="built_in">strlen</span>(Disk_name));</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"experiment-CM-1.exe所在磁盘的名称:"</span>;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;Disk_name;</span><br><span class="line">   </span><br><span class="line">    ebx = (<span class="keyword">unsigned</span> <span class="keyword">long</span> *)&amp;Disk_name[<span class="number">0</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (ecx = Disk_type; ecx&gt;<span class="number">0</span>; ecx--)</span><br><span class="line">    &#123;</span><br><span class="line">        i = ecx;</span><br><span class="line">        i *= *ebx;</span><br><span class="line">        eax = i&amp;<span class="number">0xFFFFFFFF</span>;</span><br><span class="line">        edi += eax;</span><br><span class="line">    &#125;</span><br><span class="line">    edi ^= <span class="number">0x797A7553</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>&lt;&lt;<span class="string">"Serial: "</span>&lt;&lt;edi&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    system(<span class="string">"pause:"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下图为最终结果。</p>
<p><img src="https://img-blog.csdnimg.cn/20200405115536860.png#pic_center" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20200405115546923.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reverse/" rel="tag">Reverse</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Crackme-3" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/03/23/Crackme-3/"
    >Crackme 3</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/03/23/Crackme-3/" class="article-date">
  <time datetime="2020-03-23T05:22:40.000Z" itemprop="datePublished">2020-03-23</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p>0x01 查壳<br>首先用PEiD进行查壳，无壳，但是找到了CRC32的加密方式，后面有可能会用到。<br><img src="https://img-blog.csdnimg.cn/20200323000652844.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200323000711225.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>0x02 初步分析<br>先随意输入Name和Code，发现当输入的Name少于五个字节时则不弹窗；大于等于五个字节才会弹出错误提示框。<br><img src="https://img-blog.csdnimg.cn/2020032300080751.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>用OD打开程序，使用插件搜索字符串，可以找到提示注册成功的字样，双击跟入。<br><img src="https://img-blog.csdnimg.cn/20200323000828748.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>在这里可以看到关键跳转步骤，经过CM3.00404224函数后，esi与eax的值必须相等，才会显示注册码成功。继续往上查看之前，先将关键的CM3.00404224函数断下。</p>
<p><img src="https://img-blog.csdnimg.cn/20200323001053503.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>在上方找到了GetWindowTextA函数，会将Name的长度与5进行比较，大于等于5才能进行下一步。<br><img src="https://img-blog.csdnimg.cn/20200323001109951.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>按f9进行运行，Name和Code按照如下填写，点击Checkme。<br><img src="https://img-blog.csdnimg.cn/202003230013179.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>会发现程序被断在GetWindowTextA函数下方。按f8步步跟，发现经过CM3.00402ED0函数后，Name通过[local.1]局部变量被赋值给eax，变为DiKeNabcde。在堆栈中可以查看到。<br><img src="https://img-blog.csdnimg.cn/20200323001339916.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>继续运行，edx=0xA，猜想这里edx应该是DiKeNabcde的长度，即修改过后的Name（后面用name代替）的长度，同时eax被赋值为存储name的内存地址。<br><img src="https://img-blog.csdnimg.cn/2020032300143071.png#pic_center" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200323001440608.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>0x03 关键函数</p>
<p>接着按f9运行后，发现程序被断在CM3.00404224函数处，并且输入的Code变为012345（后面用code代替），而进入函数前esi为0x5F9501CE，可以想到该函数会对code进行运算处理，从而进行最终判断。按f7进入函数查看。</p>
<p><img src="https://img-blog.csdnimg.cn/20200323001616210.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>进入函数后，在函数下方发现了关键的循环函数，eax作为计数器，从1开始累加，循环code的长度次数后结束循环。<br><img src="https://img-blog.csdnimg.cn/20200323001649710.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>可以发现在结束循环后，存放最终结果的ebx变为0x00003039，而变为十进制后正是12345，eax中存放着局部变量012345的堆栈地址。同时esi的值依然为0x5F9501CE，并没有发生变化。<br><img src="https://img-blog.csdnimg.cn/20200323001712414.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>继续运行会回到最终判断条件的位置，此时esi为0x5F9501CE，而eax为0x00003039。这里可以猜想，是否是输入Code的值与0x5F9501CE即可成功。<br><img src="https://img-blog.csdnimg.cn/20200323001758314.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>进行两组实验后发现果然如此。<br><img src="https://img-blog.csdnimg.cn/20200323001845960.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>0x04 对于注册机的探究</p>
<p>至此为止大致流程已经清楚，即只要我们获取esi根据name生成的值，并转换为十进制即可得到正确的Code。接下来对esi的生成进行探究。<br>从头运行，发现esi的值是由CM3.00403DF0函数得出的，跟入该函数查看。</p>
<p><img src="https://img-blog.csdnimg.cn/2020032300225910.png#pic_center" alt="在这里插入图片描述"></p>
<p>一进去即可看到关键的循环函数，这里的地址也符合开头CRC32算法所在的位置。edx是计数器，循环name长度的次数。</p>
<p><img src="https://img-blog.csdnimg.cn/20200323002348298.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>其中edi在循环过程中一直为0所以直接省略，最终结果存放在eax中，并且会在后面赋值给esi。<br>这里有一个困惑的点就是对于dword ptr ds:[]数组的构建，<br>dword ptr ds:[edi+eax<em>4]本意指将 [edi+eax</em>4] 的双字节段地址里的内容赋值给ebx，一开始没有想到好的办法去构造。后来在网上查询找到了直接将内存中的数据转化为数组的插件，非常好用，效果如下：</p>
<p><img src="https://img-blog.csdnimg.cn/20200324101617505.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200324101631768.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><br>注册机如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> memory[<span class="number">300</span>] = &#123;<span class="number">0x00000000</span>, <span class="number">0x77073096</span>, <span class="number">0xEE0E612C</span>, <span class="number">0x990951BA</span>, <span class="number">0x076DC419</span>, <span class="number">0x706AF48F</span>, <span class="number">0xE963A535</span>, <span class="number">0x9E6495A3</span>, <span class="number">0x0EDB8832</span>, <span class="number">0x79DCB8A4</span>, </span><br><span class="line">  <span class="number">0xE0D5E91E</span>, <span class="number">0x97D2D988</span>, <span class="number">0x09B64C2B</span>, <span class="number">0x7EB17CBD</span>, <span class="number">0xE7B82D07</span>, <span class="number">0x90BF1D91</span>, <span class="number">0x1DB71064</span>, <span class="number">0x6AB020F2</span>, <span class="number">0xF3B97148</span>, <span class="number">0x84BE41DE</span>, </span><br><span class="line">  <span class="number">0x1ADAD47D</span>, <span class="number">0x6DDDE4EB</span>, <span class="number">0xF4D4B551</span>, <span class="number">0x83D385C7</span>, <span class="number">0x136C9856</span>, <span class="number">0x646BA8C0</span>, <span class="number">0xFD62F97A</span>, <span class="number">0x8A65C9EC</span>, <span class="number">0x14015C4F</span>, <span class="number">0x63066CD9</span>, </span><br><span class="line">  <span class="number">0xFA0F3D63</span>, <span class="number">0x8D080DF5</span>, <span class="number">0x3B6E20C8</span>, <span class="number">0x4C69105E</span>, <span class="number">0xD56041E4</span>, <span class="number">0xA2677172</span>, <span class="number">0x3C03E4D1</span>, <span class="number">0x4B04D447</span>, <span class="number">0xD20D85FD</span>, <span class="number">0xA50AB56B</span>, </span><br><span class="line">  <span class="number">0x35B5A8FA</span>, <span class="number">0x42B2986C</span>, <span class="number">0xDBBBC9D6</span>, <span class="number">0xACBCF940</span>, <span class="number">0x32D86CE3</span>, <span class="number">0x45DF5C75</span>, <span class="number">0xDCD60DCF</span>, <span class="number">0xABD13D59</span>, <span class="number">0x26D930AC</span>, <span class="number">0x51DE003A</span>, </span><br><span class="line">  <span class="number">0xC8D75180</span>, <span class="number">0xBFD06116</span>, <span class="number">0x21B4F4B5</span>, <span class="number">0x56B3C423</span>, <span class="number">0xCFBA9599</span>, <span class="number">0xB8BDA50F</span>, <span class="number">0x2802B89E</span>, <span class="number">0x5F058808</span>, <span class="number">0xC60CD9B2</span>, <span class="number">0xB10BE924</span>, </span><br><span class="line">  <span class="number">0x2F6F7C87</span>, <span class="number">0x58684C11</span>, <span class="number">0xC1611DAB</span>, <span class="number">0xB6662D3D</span>, <span class="number">0x76DC4190</span>, <span class="number">0x01DB7106</span>, <span class="number">0x98D220BC</span>, <span class="number">0xEFD5102A</span>, <span class="number">0x71B18589</span>, <span class="number">0x06B6B51F</span>, </span><br><span class="line">  <span class="number">0x9FBFE4A5</span>, <span class="number">0xE8B8D433</span>, <span class="number">0x7807C9A2</span>, <span class="number">0x0F00F934</span>, <span class="number">0x9609A88E</span>, <span class="number">0xE10E9818</span>, <span class="number">0x7F6A0DBB</span>, <span class="number">0x086D3D2D</span>, <span class="number">0x91646C97</span>, <span class="number">0xE6635C01</span>, </span><br><span class="line">  <span class="number">0x6B6B51F4</span>, <span class="number">0x1C6C6162</span>, <span class="number">0x856530D8</span>, <span class="number">0xF262004E</span>, <span class="number">0x6C0695ED</span>, <span class="number">0x1B01A57B</span>, <span class="number">0x8208F4C1</span>, <span class="number">0xF50FC457</span>, <span class="number">0x65B0D9C6</span>, <span class="number">0x12B7E950</span>, </span><br><span class="line">  <span class="number">0x8BBEB8EA</span>, <span class="number">0xFCB9887C</span>, <span class="number">0x62DD1DDF</span>, <span class="number">0x15DA2D49</span>, <span class="number">0x8CD37CF3</span>, <span class="number">0xFBD44C65</span>, <span class="number">0x4DB26158</span>, <span class="number">0x3AB551CE</span>, <span class="number">0xA3BC0074</span>, <span class="number">0xD4BB30E2</span>, </span><br><span class="line">  <span class="number">0x4ADFA541</span>, <span class="number">0x3DD895D7</span>, <span class="number">0xA4D1C46D</span>, <span class="number">0xD3D6F4FB</span>, <span class="number">0x4369E96A</span>, <span class="number">0x346ED9FC</span>, <span class="number">0xAD678846</span>, <span class="number">0xDA60B8D0</span>, <span class="number">0x44042D73</span>, <span class="number">0x33031DE5</span>, </span><br><span class="line">  <span class="number">0xAA0A4C5F</span>, <span class="number">0xDD0D7CC9</span>, <span class="number">0x5005713C</span>, <span class="number">0x270241AA</span>, <span class="number">0xBE0B1010</span>, <span class="number">0xC90C2086</span>, <span class="number">0x5768B525</span>, <span class="number">0x206F85B3</span>, <span class="number">0xB966D409</span>, <span class="number">0xCE61E49F</span>, </span><br><span class="line">  <span class="number">0x5EDEF90E</span>, <span class="number">0x29D9C998</span>, <span class="number">0xB0D09822</span>, <span class="number">0xC7D7A8B4</span>, <span class="number">0x59B33D17</span>, <span class="number">0x2EB40D81</span>, <span class="number">0xB7BD5C3B</span>, <span class="number">0xC0BA6CAD</span>, <span class="number">0xEDB88320</span>, <span class="number">0x9ABFB3B6</span>, </span><br><span class="line">  <span class="number">0x03B6E20C</span>, <span class="number">0x74B1D29A</span>, <span class="number">0xEAD54739</span>, <span class="number">0x9DD277AF</span>, <span class="number">0x04DB2615</span>, <span class="number">0x73DC1683</span>, <span class="number">0xE3630B12</span>, <span class="number">0x94643B84</span>, <span class="number">0x0D6D6A3E</span>, <span class="number">0x7A6A5AA8</span>, </span><br><span class="line">  <span class="number">0xE40ECF0B</span>, <span class="number">0x9309FF9D</span>, <span class="number">0x0A00AE27</span>, <span class="number">0x7D079EB1</span>, <span class="number">0xF00F9344</span>, <span class="number">0x8708A3D2</span>, <span class="number">0x1E01F268</span>, <span class="number">0x6906C2FE</span>, <span class="number">0xF762575D</span>, <span class="number">0x806567CB</span>, </span><br><span class="line">  <span class="number">0x196C3671</span>, <span class="number">0x6E6B06E7</span>, <span class="number">0xFED41B76</span>, <span class="number">0x89D32BE0</span>, <span class="number">0x10DA7A5A</span>, <span class="number">0x67DD4ACC</span>, <span class="number">0xF9B9DF6F</span>, <span class="number">0x8EBEEFF9</span>, <span class="number">0x17B7BE43</span>, <span class="number">0x60B08ED5</span>, </span><br><span class="line">  <span class="number">0xD6D6A3E8</span>, <span class="number">0xA1D1937E</span>, <span class="number">0x38D8C2C4</span>, <span class="number">0x4FDFF252</span>, <span class="number">0xD1BB67F1</span>, <span class="number">0xA6BC5767</span>, <span class="number">0x3FB506DD</span>, <span class="number">0x48B2364B</span>, <span class="number">0xD80D2BDA</span>, <span class="number">0xAF0A1B4C</span>, </span><br><span class="line">  <span class="number">0x36034AF6</span>, <span class="number">0x41047A60</span>, <span class="number">0xDF60EFC3</span>, <span class="number">0xA867DF55</span>, <span class="number">0x316E8EEF</span>, <span class="number">0x4669BE79</span>, <span class="number">0xCB61B38C</span>, <span class="number">0xBC66831A</span>, <span class="number">0x256FD2A0</span>, <span class="number">0x5268E236</span>, </span><br><span class="line">  <span class="number">0xCC0C7795</span>, <span class="number">0xBB0B4703</span>, <span class="number">0x220216B9</span>, <span class="number">0x5505262F</span>, <span class="number">0xC5BA3BBE</span>, <span class="number">0xB2BD0B28</span>, <span class="number">0x2BB45A92</span>, <span class="number">0x5CB36A04</span>, <span class="number">0xC2D7FFA7</span>, <span class="number">0xB5D0CF31</span>, </span><br><span class="line">  <span class="number">0x2CD99E8B</span>, <span class="number">0x5BDEAE1D</span>, <span class="number">0x9B64C2B0</span>, <span class="number">0xEC63F226</span>, <span class="number">0x756AA39C</span>, <span class="number">0x026D930A</span>, <span class="number">0x9C0906A9</span>, <span class="number">0xEB0E363F</span>, <span class="number">0x72076785</span>, <span class="number">0x05005713</span>, </span><br><span class="line">  <span class="number">0x95BF4A82</span>, <span class="number">0xE2B87A14</span>, <span class="number">0x7BB12BAE</span>, <span class="number">0x0CB61B38</span>, <span class="number">0x92D28E9B</span>, <span class="number">0xE5D5BE0D</span>, <span class="number">0x7CDCEFB7</span>, <span class="number">0x0BDBDF21</span>, <span class="number">0x86D3D2D4</span>, <span class="number">0xF1D4E242</span>, </span><br><span class="line">  <span class="number">0x68DDB3F8</span>, <span class="number">0x1FDA836E</span>, <span class="number">0x81BE16CD</span>, <span class="number">0xF6B9265B</span>, <span class="number">0x6FB077E1</span>, <span class="number">0x18B74777</span>, <span class="number">0x88085AE6</span>, <span class="number">0xFF0F6A70</span>, <span class="number">0x66063BCA</span>, <span class="number">0x11010B5C</span>, </span><br><span class="line">  <span class="number">0x8F659EFF</span>, <span class="number">0xF862AE69</span>, <span class="number">0x616BFFD3</span>, <span class="number">0x166CCF45</span>, <span class="number">0xA00AE278</span>, <span class="number">0xD70DD2EE</span>, <span class="number">0x4E048354</span>, <span class="number">0x3903B3C2</span>, <span class="number">0xA7672661</span>, <span class="number">0xD06016F7</span>, </span><br><span class="line">  <span class="number">0x4969474D</span>, <span class="number">0x3E6E77DB</span>, <span class="number">0xAED16A4A</span>, <span class="number">0xD9D65ADC</span>, <span class="number">0x40DF0B66</span>, <span class="number">0x37D83BF0</span>, <span class="number">0xA9BCAE53</span>, <span class="number">0xDEBB9EC5</span>, <span class="number">0x47B2CF7F</span>, <span class="number">0x30B5FFE9</span>, </span><br><span class="line">  <span class="number">0xBDBDF21C</span>, <span class="number">0xCABAC28A</span>, <span class="number">0x53B39330</span>, <span class="number">0x24B4A3A6</span>, <span class="number">0xBAD03605</span>, <span class="number">0xCDD70693</span>, <span class="number">0x54DE5729</span>, <span class="number">0x23D967BF</span>, <span class="number">0xB3667A2E</span>, <span class="number">0xC4614AB8</span>, </span><br><span class="line">  <span class="number">0x5D681B02</span>, <span class="number">0x2A6F2B94</span>, <span class="number">0xB40BBE37</span>, <span class="number">0xC30C8EA1</span>, <span class="number">0x5A05DF1B</span>&#125;;</span><br><span class="line">  <span class="keyword">int</span> edx = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> ebx = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> eax = <span class="number">0xFFFFFFFF</span>;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> al = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> shed = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">string</span> str1 = <span class="string">"DiKeN"</span>;</span><br><span class="line">  <span class="built_in">string</span> name;  </span><br><span class="line">  </span><br><span class="line">  <span class="built_in">cout</span>&lt;&lt;<span class="string">"Name:"</span>;</span><br><span class="line">  getline(<span class="built_in">cin</span>, name);</span><br><span class="line">  name = str1 + name;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span> (edx=name.length(); edx&gt;<span class="number">0</span>; edx--)</span><br><span class="line">  &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 仅保留eax的低八位</span></span><br><span class="line">    al = eax &amp; <span class="number">0xFF</span>;</span><br><span class="line">    al = al ^ name[name.length()-edx];</span><br><span class="line">    <span class="comment">// 更新eax的低八位</span></span><br><span class="line">    eax = (eax &amp; <span class="number">0xffffff00</span>) | al;</span><br><span class="line">    </span><br><span class="line">    shed = eax;</span><br><span class="line">    al = eax &amp; <span class="number">0xFF</span>;</span><br><span class="line">    ebx = memory[al];</span><br><span class="line"></span><br><span class="line">    eax = shed;</span><br><span class="line">    eax = eax &gt;&gt; <span class="number">8</span>;</span><br><span class="line">    eax = eax^ebx;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  eax = eax^<span class="number">0xFFFFFFFF</span>;</span><br><span class="line">  <span class="built_in">cout</span>&lt;&lt;<span class="string">"Code:"</span>&lt;&lt;eax&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">  system(<span class="string">"pause:"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输入Name即可得到对应的Code：</p>
<p><img src="https://img-blog.csdnimg.cn/20200324101718240.png#pic_center" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/2020032410180810.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reverse/" rel="tag">Reverse</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Tensorflow2-0-利用卷积神经网络实现简单的验证码识别" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/03/17/Tensorflow2-0-%E5%88%A9%E7%94%A8%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB/"
    >Tensorflow2.0 利用卷积神经网络实现简单的验证码识别</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/03/17/Tensorflow2-0-%E5%88%A9%E7%94%A8%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB/" class="article-date">
  <time datetime="2020-03-17T13:50:47.000Z" itemprop="datePublished">2020-03-17</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <p><a href="https://my.oschina.net/u/4105485/blog/3042460" target="_blank" rel="noopener">原文地址</a></p>
<h3 id="0x01-验证码生成及预处理"><a href="#0x01-验证码生成及预处理" class="headerlink" title="0x01 验证码生成及预处理"></a>0x01 验证码生成及预处理</h3><p>验证码的内容是10个数字0~9，小写英文字母和大写英文字母，所以总的字符量为62种</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">number &#x3D; [&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;]</span><br><span class="line">alphabet &#x3D; [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;, &#39;g&#39;, &#39;h&#39;, &#39;i&#39;, &#39;j&#39;, &#39;k&#39;, &#39;l&#39;, &#39;m&#39;, &#39;n&#39;, &#39;o&#39;, &#39;p&#39;, &#39;q&#39;, &#39;r&#39;, &#39;s&#39;, &#39;t&#39;, &#39;u&#39;,</span><br><span class="line">            &#39;v&#39;, &#39;w&#39;, &#39;x&#39;, &#39;y&#39;, &#39;z&#39;]</span><br><span class="line">ALPHABET &#x3D; [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;, &#39;E&#39;, &#39;F&#39;, &#39;G&#39;, &#39;H&#39;, &#39;I&#39;, &#39;J&#39;, &#39;K&#39;, &#39;L&#39;, &#39;M&#39;, &#39;N&#39;, &#39;O&#39;, &#39;P&#39;, &#39;Q&#39;, &#39;R&#39;, &#39;S&#39;, &#39;T&#39;, &#39;U&#39;,</span><br><span class="line">            &#39;V&#39;, &#39;W&#39;, &#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;]</span><br><span class="line">CHAR_SET &#x3D; number + alphabet + ALPHABET</span><br></pre></td></tr></table></figure>
<p>可以看到生成的验证码都是带干扰线干扰点，并且各种颜色和变形处理都是有的<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9vc2NpbWcub3NjaGluYS5uZXQvb3NjbmV0LzQxM2FkZGUwZDNhZjk5Mzk5M2Y5MzNkNWQ2MDJiYTM5MGEzLmpwZw?x-oss-process=image/format,png" alt="在这里插入图片描述"><br>首先将图片转成numpy数组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">captcha_image &#x3D; Image.open(captcha)</span><br><span class="line">captcha_image &#x3D; np.array(captcha_image)</span><br></pre></td></tr></table></figure>
<p>根据分析，这类验证码的颜色对我们的识别没有影响，所以将图像进行预处理——灰度化（根据图片的不同可以做灰度化或者二值化等预处理操作）</p>
<p>这里使用的是求均值的方法（正规的方法应该是RGB三个通道上按照一定的比例取值）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gray &#x3D; np.mean(img, -1)</span><br></pre></td></tr></table></figure>

<h3 id="0x02-建立卷积神经网络"><a href="#0x02-建立卷积神经网络" class="headerlink" title="0x02 建立卷积神经网络"></a>0x02 建立卷积神经网络</h3><p>1.输入的图片为160 * 60的，灰度化预处理以后为一维数组，每张图片总共有9600个输入值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IMAGE_HEIGHT &#x3D; 60</span><br><span class="line">IMAGE_WIDTH &#x3D; 160</span><br></pre></td></tr></table></figure>

<p>2.输出的字符集有62个字符，并且每张图片有4位字符，总共有4 * 62 = 248个输出值（下面的batch_size为每批训练的图片数量）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">batch_y &#x3D; np.zeros([batch_size, MAX_CAPTCHA, CHAR_SET_LEN])</span><br></pre></td></tr></table></figure>

<p>3.输入层有9600个值，输出层有248个值，如果使用全连接层作为隐藏层则会需要天量的计算</p>
<p>所以需要先使用卷积核池化操作尽可能的减少计算量，图片像素不高，所以使用的卷积核和池大小不能太大，优先考虑3 * 3 和5 * 5 的卷积核，池大小使用2 * 2</p>
<p>按照下面的神经网络模型，卷积池化以后的输出应该是128 * 17 * 5 = 10880（如果最后一层的深度仍然使用64的话，大小会减为一半）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">model.add(tf.keras.layers.Conv2D(32, (3, 3)))</span><br><span class="line">model.add(tf.keras.layers.PReLU())</span><br><span class="line">model.add(tf.keras.layers.MaxPool2D((2, 2), strides&#x3D;2))</span><br><span class="line"></span><br><span class="line">model.add(tf.keras.layers.Conv2D(64, (5, 5)))</span><br><span class="line">model.add(tf.keras.layers.PReLU())</span><br><span class="line">model.add(tf.keras.layers.MaxPool2D((2, 2), strides&#x3D;2))</span><br><span class="line"></span><br><span class="line">model.add(tf.keras.layers.Conv2D(128, (5, 5)))</span><br><span class="line">model.add(tf.keras.layers.PReLU())</span><br><span class="line">model.add(tf.keras.layers.MaxPool2D((2, 2), strides&#x3D;2))</span><br></pre></td></tr></table></figure>

<p>4.输出的的每一位的字符之间没有关联关系，所以仍然将输出值看成4组，需要将输出值调整为(4, 62)的数组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">model.add(tf.keras.layers.Flatten())</span><br><span class="line">model.add(tf.keras.layers.Dense(MAX_CAPTCHA * CHAR_SET_LEN))</span><br><span class="line">model.add(tf.keras.layers.Reshape([MAX_CAPTCHA, CHAR_SET_LEN]))</span><br></pre></td></tr></table></figure>

<p>6.识别的原理是计算每一位字符上某个字符出现的可能性最大，所以每张图片都是一个4位的多分类问题，最终输出使用softmax进行归一化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.add(tf.keras.layers.Softmax())</span><br></pre></td></tr></table></figure>

<p>7.在tensorflow2.0中softmax对应的损失函数是categorical_crossentropy，按照这个来配置模型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">model.compile(optimizer&#x3D;&#39;Adam&#39;,</span><br><span class="line">              metrics&#x3D;[&#39;accuracy&#39;],</span><br><span class="line">              loss&#x3D;&#39;categorical_crossentropy&#39;)</span><br></pre></td></tr></table></figure>

<p>8.最后将可能性最大的那个下标取出，作为字符集的下标，获取实际对应的字符（当然我们在训练的时候没有必要转化为字符，直接下标比较一下是否正确就可以了）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prediction_value &#x3D; vec2text(np.argmax(prediction_value, axis&#x3D;2)[0])</span><br></pre></td></tr></table></figure>

<h3 id="0x03-训练模型"><a href="#0x03-训练模型" class="headerlink" title="0x03 训练模型"></a>0x03 训练模型</h3><p>使用一个循环逻辑开启训练，每批训练512张图片，每批训练4次</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for times in range(500000):</span><br><span class="line">    batch_x, batch_y &#x3D; get_next_batch(512)</span><br><span class="line">    model.fit(batch_x, batch_y, epochs&#x3D;4)</span><br><span class="line">    print(&quot;y预测&#x3D;\n&quot;, np.argmax(model.predict(batch_x), axis&#x3D;2))</span><br><span class="line">    print(&quot;y实际&#x3D;\n&quot;, np.argmax(batch_y, axis&#x3D;2))</span><br></pre></td></tr></table></figure>

<p>刚开始的时候可能损失值会在4左右徘徊，多跑几个批次以后损失值会明显下降，精确度accuracy也会直线上升</p>
<p>下面可以看到每批的第一次训练结果中精确度只有不到60%，而在第四次训练结果中精确度基本上都能达到99%以上</p>
<p>但是这个精确度达到99%了也不能说明整个模型就训练结束了，这个精确度只是针对这一批512张图片来说的</p>
<p>毕竟4位验证码有62 * 62 * 62 * 62种可能，训练集并不能代表所有的可能性，所以我们需要使用新生成的验证码来证明整个训练结果是否能结束</p>
<h3 id="0x04-完整代码"><a href="#0x04-完整代码" class="headerlink" title="0x04 完整代码"></a>0x04 完整代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> captcha.image <span class="keyword">import</span> ImageCaptcha</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">number = [<span class="string">'0'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'6'</span>, <span class="string">'7'</span>, <span class="string">'8'</span>, <span class="string">'9'</span>]</span><br><span class="line">alphabet = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>, <span class="string">'g'</span>, <span class="string">'h'</span>, <span class="string">'i'</span>, <span class="string">'j'</span>, <span class="string">'k'</span>, <span class="string">'l'</span>, <span class="string">'m'</span>, <span class="string">'n'</span>, <span class="string">'o'</span>, <span class="string">'p'</span>, <span class="string">'q'</span>, <span class="string">'r'</span>, <span class="string">'s'</span>, <span class="string">'t'</span>, <span class="string">'u'</span>,</span><br><span class="line">            <span class="string">'v'</span>, <span class="string">'w'</span>, <span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'z'</span>]</span><br><span class="line">ALPHABET = [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>, <span class="string">'G'</span>, <span class="string">'H'</span>, <span class="string">'I'</span>, <span class="string">'J'</span>, <span class="string">'K'</span>, <span class="string">'L'</span>, <span class="string">'M'</span>, <span class="string">'N'</span>, <span class="string">'O'</span>, <span class="string">'P'</span>, <span class="string">'Q'</span>, <span class="string">'R'</span>, <span class="string">'S'</span>, <span class="string">'T'</span>, <span class="string">'U'</span>,</span><br><span class="line">            <span class="string">'V'</span>, <span class="string">'W'</span>, <span class="string">'X'</span>, <span class="string">'Y'</span>, <span class="string">'Z'</span>]</span><br><span class="line">SAVE_PATH = <span class="string">"D:\\Programming\\TF2.0 Verification Code"</span></span><br><span class="line">CHAR_SET = number + alphabet + ALPHABET</span><br><span class="line">CHAR_SET_LEN = len(CHAR_SET)</span><br><span class="line">IMAGE_HEIGHT = <span class="number">60</span></span><br><span class="line">IMAGE_WIDTH = <span class="number">160</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_captcha_text</span><span class="params">(char_set=None, captcha_size=<span class="number">4</span>)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> char_set <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        char_set = number + alphabet + ALPHABET</span><br><span class="line"></span><br><span class="line">    captcha_text = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(captcha_size):</span><br><span class="line">        c = random.choice(char_set)</span><br><span class="line">        captcha_text.append(c)</span><br><span class="line">    <span class="keyword">return</span> captcha_text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_captcha_text_and_image</span><span class="params">(width=<span class="number">160</span>, height=<span class="number">60</span>, char_set=CHAR_SET)</span>:</span></span><br><span class="line">    image = ImageCaptcha(width=width, height=height)</span><br><span class="line"></span><br><span class="line">    captcha_text = random_captcha_text(char_set)</span><br><span class="line">    captcha_text = <span class="string">''</span>.join(captcha_text)</span><br><span class="line"></span><br><span class="line">    captcha = image.generate(captcha_text)</span><br><span class="line"></span><br><span class="line">    captcha_image = Image.open(captcha)</span><br><span class="line">    captcha_image = np.array(captcha_image)</span><br><span class="line">    <span class="keyword">return</span> captcha_text, captcha_image</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">text, image = gen_captcha_text_and_image(char_set=CHAR_SET)</span><br><span class="line">MAX_CAPTCHA = len(text)</span><br><span class="line">print(<span class="string">'CHAR_SET_LEN='</span>, CHAR_SET_LEN, <span class="string">' MAX_CAPTCHA='</span>, MAX_CAPTCHA)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert2gray</span><span class="params">(img)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(img.shape) &gt; <span class="number">2</span>:</span><br><span class="line">        gray = np.mean(img, <span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">return</span> gray</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> img</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">text2vec</span><span class="params">(text)</span>:</span></span><br><span class="line">    vector = np.zeros([MAX_CAPTCHA, CHAR_SET_LEN])</span><br><span class="line">    <span class="keyword">for</span> i, c <span class="keyword">in</span> enumerate(text):</span><br><span class="line">        idx = CHAR_SET.index(c)</span><br><span class="line">        vector[i][idx] = <span class="number">1.0</span></span><br><span class="line">    <span class="keyword">return</span> vector</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">vec2text</span><span class="params">(vec)</span>:</span></span><br><span class="line">    text = []</span><br><span class="line">    <span class="keyword">for</span> i, c <span class="keyword">in</span> enumerate(vec):</span><br><span class="line">        text.append(CHAR_SET[c])</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>.join(text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_next_batch</span><span class="params">(batch_size=<span class="number">128</span>)</span>:</span></span><br><span class="line">    batch_x = np.zeros([batch_size, IMAGE_HEIGHT, IMAGE_WIDTH, <span class="number">1</span>])</span><br><span class="line">    batch_y = np.zeros([batch_size, MAX_CAPTCHA, CHAR_SET_LEN])</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrap_gen_captcha_text_and_image</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            text, image = gen_captcha_text_and_image(char_set=CHAR_SET)</span><br><span class="line">            <span class="keyword">if</span> image.shape == (<span class="number">60</span>, <span class="number">160</span>, <span class="number">3</span>):</span><br><span class="line">                <span class="keyword">return</span> text, image</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(batch_size):</span><br><span class="line">        text, image = wrap_gen_captcha_text_and_image()</span><br><span class="line">        image = tf.reshape(convert2gray(image), (IMAGE_HEIGHT, IMAGE_WIDTH, <span class="number">1</span>))</span><br><span class="line">        batch_x[i, :] = image</span><br><span class="line">        batch_y[i, :] = text2vec(text)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> batch_x, batch_y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_captcha_cnn</span><span class="params">()</span>:</span></span><br><span class="line">    model = tf.keras.Sequential()</span><br><span class="line"></span><br><span class="line">    model.add(tf.keras.layers.Conv2D(<span class="number">32</span>, (<span class="number">3</span>, <span class="number">3</span>)))</span><br><span class="line">    model.add(tf.keras.layers.PReLU())</span><br><span class="line">    model.add(tf.keras.layers.MaxPool2D((<span class="number">2</span>, <span class="number">2</span>), strides=<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">    model.add(tf.keras.layers.Conv2D(<span class="number">64</span>, (<span class="number">5</span>, <span class="number">5</span>)))</span><br><span class="line">    model.add(tf.keras.layers.PReLU())</span><br><span class="line">    model.add(tf.keras.layers.MaxPool2D((<span class="number">2</span>, <span class="number">2</span>), strides=<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">    model.add(tf.keras.layers.Conv2D(<span class="number">128</span>, (<span class="number">5</span>, <span class="number">5</span>)))</span><br><span class="line">    model.add(tf.keras.layers.PReLU())</span><br><span class="line">    model.add(tf.keras.layers.MaxPool2D((<span class="number">2</span>, <span class="number">2</span>), strides=<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">    model.add(tf.keras.layers.Flatten())</span><br><span class="line">    model.add(tf.keras.layers.Dense(MAX_CAPTCHA * CHAR_SET_LEN))</span><br><span class="line">    model.add(tf.keras.layers.Reshape([MAX_CAPTCHA, CHAR_SET_LEN]))</span><br><span class="line"></span><br><span class="line">    model.add(tf.keras.layers.Softmax())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> model</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        model = tf.keras.models.load_model(SAVE_PATH + <span class="string">'model'</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">'#######Exception'</span>, e)</span><br><span class="line">        model = crack_captcha_cnn()</span><br><span class="line"></span><br><span class="line">    model.compile(optimizer=<span class="string">'Adam'</span>,</span><br><span class="line">                  metrics=[<span class="string">'accuracy'</span>],</span><br><span class="line">                  loss=<span class="string">'categorical_crossentropy'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> times <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        batch_x, batch_y = get_next_batch(<span class="number">512</span>)</span><br><span class="line">        print(<span class="string">'times='</span>, times, <span class="string">' batch_x.shape='</span>, batch_x.shape, <span class="string">' batch_y.shape='</span>, batch_y.shape)</span><br><span class="line">        model.fit(batch_x, batch_y, epochs=<span class="number">4</span>)</span><br><span class="line">        print(<span class="string">"y预测=\n"</span>, np.argmax(model.predict(batch_x), axis=<span class="number">2</span>))</span><br><span class="line">        print(<span class="string">"y实际=\n"</span>, np.argmax(batch_y, axis=<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> == times % <span class="number">10</span>:</span><br><span class="line">            print(<span class="string">"save model at times="</span>, times)</span><br><span class="line">            model.save(SAVE_PATH + <span class="string">'model'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">()</span>:</span></span><br><span class="line">    model = tf.keras.models.load_model(SAVE_PATH + <span class="string">'model'</span>)</span><br><span class="line">    success = <span class="number">0</span></span><br><span class="line">    count = <span class="number">100</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> range(count):</span><br><span class="line">        data_x, data_y = get_next_batch(<span class="number">1</span>)</span><br><span class="line">        prediction_value = model.predict(data_x)</span><br><span class="line">        data_y = vec2text(np.argmax(data_y, axis=<span class="number">2</span>)[<span class="number">0</span>])</span><br><span class="line">        prediction_value = vec2text(np.argmax(prediction_value, axis=<span class="number">2</span>)[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> data_y.upper() == prediction_value.upper():</span><br><span class="line">            print(<span class="string">"y预测="</span>, prediction_value, <span class="string">"y实际="</span>, data_y, <span class="string">"预测成功。"</span>)</span><br><span class="line">            success += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">"y预测="</span>, prediction_value, <span class="string">"y实际="</span>, data_y, <span class="string">"预测失败。"</span>)</span><br><span class="line">        print(<span class="string">"预测"</span>, count, <span class="string">"次"</span>, <span class="string">"成功率="</span>, success / count)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    train()</span><br><span class="line">    predict()</span><br></pre></td></tr></table></figure>


      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tensorflow-2-0/" rel="tag">Tensorflow 2.0</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-160个CrackMe 0x17" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/03/09/160%E4%B8%AACrackMe%200x17/"
    >160个CrackMe 0x17</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/03/09/160%E4%B8%AACrackMe%200x17/" class="article-date">
  <time datetime="2020-03-09T12:00:00.000Z" itemprop="datePublished">2020-03-09</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="0x00-初步分析"><a href="#0x00-初步分析" class="headerlink" title="0x00 初步分析"></a>0x00 初步分析</h3><p>首先打开crackme，要求输入name和serial，但是并没有Check之类的字样，只有底部的Status显示当前的序列号不合法。点击底部的About，出现说明：找到符合name的serial，并且不允许修改程序。<br><img src="https://img-blog.csdnimg.cn/20200309192631260.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200309193510837.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>拖入OD中进行分析，利用查找字符串插件找寻到成功和失败字样。<br><img src="https://img-blog.csdnimg.cn/20200309194720903.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>点击进入。发现了判断成功的条件，即0x403167地址的值（以下用[166]代替）需等于0x10。而166的值会在call Chafe_1.00401453函数后发生改变，于是按回车进入函数。</p>
<h3 id="0x01-三段代码"><a href="#0x01-三段代码" class="headerlink" title="0x01 三段代码"></a>0x01 三段代码</h3><p>这里会发现三段代码，都断下之后按f9，发现程序会在三段代码之间来回跳，却一直无法输入name和serial，于是才想这个程序可能是持续循环的对name和serial进行判断。<br><img src="https://img-blog.csdnimg.cn/20200309194811253.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>将所有断点去掉后，填入name和serial，以便接下来进一步研究。<br><img src="https://img-blog.csdnimg.cn/20200309194825105.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_1,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>将所有断点恢复后，按下f9，会发现程序在代码段一三、代码段二三之间来回跳转，跳往一开始找到的最终判断点。<br>首先等程序断在代码段二之后，跟代码段二，发现这是一个GetDlgItemInt函数。它通过发送控件WM_GETTEXT消息来检索指定控件的文本。该函数通过剥离文本开头的任何额外的空格，然后转换十进制数字来翻译检索到的文本。该功能在到达文本末尾或遇到非数字字符时停止转换。简单来说就是会获取eax中的文本并赋值给188地址。而此时eax中的数为0x00BC614E（12345678），发现就是我们的serial。那么此时就可以知道，[188]=serial。</p>
<p><img src="https://img-blog.csdnimg.cn/20200309194916941.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>当程序断在代码段三以后，单步跟进行分析。[188] += 0x9112478，加完之后[188]==0则不跳转，不跳转则[166]可以加4。而此时可以看到[166] = 0xC，接着单步跟会发现程序来到开头的地方，进行赋值后最后[166]的值会跟0x10进行比较，相等则成功。<br>这意味着想要得到正确的serial就不能跳转，得让[166]加4，而要想不跳转[188]就得为<br>-0x9112478。这里要注意，计算机中负数进行加法得用他的补码来表示，而-0x9112478的补码为0xF6EEDB88。<br><img src="https://img-blog.csdnimg.cn/20200309194934605.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="0x02-核心算法"><a href="#0x02-核心算法" class="headerlink" title="0x02 核心算法"></a>0x02 核心算法</h3><p>那么[188]怎样才能为0xF6EEDB88呢？这就需要查看[188]到底经过了哪些算法变化。通过右键查找地址常量，就可以查看哪些地方出现了188地址。<br><img src="https://img-blog.csdnimg.cn/20200309195017853.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200309195049802.png" alt="在这里插入图片描述"><br>点击进去查看，会出现下方的代码。在代码段开头下断点，运行，会发现程序在跑完上方的代码段二后运行下方的代码，并且其中出现了我们的name。也就是说此时name存储在edi（通过lea操作edi获取18C地址）中，serial存储在[188]中。<br><img src="https://img-blog.csdnimg.cn/2020030919511040.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>18C地址中存放的是我们输入的用户名，被edi引用，[168]地址是一个计数器，用edi+[168]计数器进行偏移，168计数器初始为0，edi加完后，计数器累加1，然后取出[188]中我们输入序列号（数字格式，输入非数字会变为0）放入eax，eax加1后与edi（<strong>相当于取用户名计数器指针位置4字节，因为edi最多存放四个字节</strong>）异或运算，结果存入188地址，一直到计数器累加至0x10退出循环。经过16次循环后，[188]决定了是否能注册通过。</p>
<p>而最关键的异或步骤就是eax中的值与edi中的值异或，这里要注意，通过f8单步跟发现，每循环一次，name（存储在edi中）都会后移一位，相当于<br>[1234]5,1[2345], 12[345],123[45],1234[5]这样<strong>每次取四字节的运算方式</strong>。</p>
<p><img src="https://img-blog.csdnimg.cn/20200309195133416.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>知道了加密原理，接下来就可以写注册机。因为异或是可以逆向进行的，所以我们令<br>serial = 0xF6EEDB88，而name分别为1234[5], 123[45], 12[345],1[2345] ,[1234]5的逆向方式进行计算。并且还要注意不论长度十六次循环是一定要走完的。</p>
<h3 id="0x03-注册机实现"><a href="#0x03-注册机实现" class="headerlink" title="0x03 注册机实现"></a>0x03 注册机实现</h3><p>注册机算法如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">char</span> * name;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> serial = <span class="number">0xF6EEDB88</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> * p;</span><br><span class="line">    name = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">30</span>];</span><br><span class="line">    <span class="comment">// 对一片内存空间逐字节进行初始化，用0填充很重要</span></span><br><span class="line">    <span class="built_in">memset</span>(name, <span class="number">0</span>, <span class="built_in">strlen</span>(name));</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"name: "</span>;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0x10</span><span class="number">-1</span>; x &gt;= <span class="number">0</span>; x--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// unsigned long 确保四字节，这里p每次循环分别为一个长度为4的数组 </span></span><br><span class="line">        p = (<span class="keyword">unsigned</span> <span class="keyword">long</span> *) &amp;name[x];</span><br><span class="line">        serial = serial ^ *p;</span><br><span class="line">        serial--;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt;<span class="string">"serial: "</span> &lt;&lt;serial&lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    system(<span class="string">"pause"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>经过验证，注册机正确。<br><img src="https://img-blog.csdnimg.cn/20200309195712343.png" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200309195722682.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>参考资料：<a href="https://www.52pojie.cn/thread-670504-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-670504-1-1.html</a></p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reverse/" rel="tag">Reverse</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-转轮机的加解密实现" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/03/07/%E8%BD%AC%E8%BD%AE%E6%9C%BA%E7%9A%84%E5%8A%A0%E8%A7%A3%E5%AF%86%E5%AE%9E%E7%8E%B0/"
    >转轮机的加解密实现</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/03/07/%E8%BD%AC%E8%BD%AE%E6%9C%BA%E7%9A%84%E5%8A%A0%E8%A7%A3%E5%AF%86%E5%AE%9E%E7%8E%B0/" class="article-date">
  <time datetime="2020-03-07T14:20:10.000Z" itemprop="datePublished">2020-03-07</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="转轮机的加解密实现"><a href="#转轮机的加解密实现" class="headerlink" title="转轮机的加解密实现"></a>转轮机的加解密实现</h2><h4 id="0x00"><a href="#0x00" class="headerlink" title="0x00"></a>0x00</h4><p>密码学课程的第一个实验，要求实现转轮机的加解密，于是重新拿起C++变成，权当复习。</p>
<h4 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h4><p>转轮机的原理如下图：<br><img src="https://img-blog.csdnimg.cn/20200307221118136.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_10,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>转轮密码机由多个转轮构成，每个转轮旋转的速度都不一样，比如有3个转轮，分别标号为1,2,3，其中1号转轮转动26个字母后，2号转轮就转动一个字母，当2号转轮转动26个字母后，3号转轮就转动1个字母。因此，当转轮密码机转动26X26X26次后，所有转轮恢复到初始状态，即3个转轮密码机的一个周期长度为26X26X26（17576）的多表代换密码。<br>（资料来源：<a href="https://blog.csdn.net/zdh89786/article/details/84497357）" target="_blank" rel="noopener">https://blog.csdn.net/zdh89786/article/details/84497357）</a></p>
<h4 id="0x02"><a href="#0x02" class="headerlink" title="0x02"></a>0x02</h4><p>实现原理：首先定义了六个数组，即三组轮子，分别为慢轮左、慢轮右、中轮左、中轮右、快轮左、快轮右，用于存储转轮的初始状态。接着将密文的字符挨个输入，如果判断是字母则进行加密处理，同时计数。转轮的转动情况便是基于字符输入的次数，如果达到26的倍数，则中轮转动，如果达到26*26的倍数，则慢轮转动。解密过程反之即可。</p>
<p>源码如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Turn_wheel</span><span class="params">(<span class="keyword">int</span>* wheel_l, <span class="keyword">int</span>* wheel_r)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Reverse_turn_wheel</span><span class="params">(<span class="keyword">int</span>* wheel_l, <span class="keyword">int</span>* wheel_r)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Encrypt</span><span class="params">(<span class="keyword">char</span>* cleartext,<span class="keyword">char</span>* ciphertext,<span class="keyword">int</span>* slow_wheel_l,<span class="keyword">int</span>* slow_wheel_r,<span class="keyword">int</span>* mid_wheel_l,<span class="keyword">int</span>* mid_wheel_r,</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">int</span>* fast_wheel_l,<span class="keyword">int</span>* fast_wheel_r)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Decrypt</span><span class="params">(<span class="keyword">char</span>* ciphertext,<span class="keyword">char</span>* cleartext,<span class="keyword">int</span>* slow_wheel_l,<span class="keyword">int</span>* slow_wheel_r,<span class="keyword">int</span>* mid_wheel_l,<span class="keyword">int</span>* mid_wheel_r,</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">int</span>* fast_wheel_l,<span class="keyword">int</span>* fast_wheel_r)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义快、中、慢三组轮子</span></span><br><span class="line">    <span class="keyword">int</span> slow_wheel_l[<span class="number">26</span>]=&#123;<span class="number">24</span>,<span class="number">25</span>,<span class="number">26</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> slow_wheel_r[<span class="number">26</span>]=&#123;<span class="number">21</span>,<span class="number">3</span>,<span class="number">15</span>,<span class="number">1</span>,<span class="number">19</span>,<span class="number">10</span>,<span class="number">14</span>,<span class="number">26</span>,<span class="number">20</span>,<span class="number">8</span>,<span class="number">16</span>,<span class="number">7</span>,<span class="number">22</span>,<span class="number">4</span>,<span class="number">11</span>,<span class="number">5</span>,<span class="number">17</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">23</span>,<span class="number">18</span>,<span class="number">2</span>,<span class="number">25</span>,<span class="number">6</span>,<span class="number">24</span>,<span class="number">13</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> mid_wheel_l[<span class="number">26</span>]=&#123;<span class="number">26</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">24</span>,<span class="number">25</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> mid_wheel_r[<span class="number">26</span>]=&#123;<span class="number">20</span>,<span class="number">1</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">15</span>,<span class="number">3</span>,<span class="number">14</span>,<span class="number">12</span>,<span class="number">23</span>,<span class="number">5</span>,<span class="number">16</span>,<span class="number">2</span>,<span class="number">22</span>,<span class="number">19</span>,<span class="number">11</span>,<span class="number">18</span>,<span class="number">25</span>,<span class="number">24</span>,<span class="number">13</span>,<span class="number">7</span>,<span class="number">10</span>,<span class="number">8</span>,<span class="number">21</span>,<span class="number">9</span>,<span class="number">26</span>,<span class="number">17</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> fast_wheel_l[<span class="number">26</span>]=&#123;<span class="number">26</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">24</span>,<span class="number">25</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> fast_wheel_r[<span class="number">26</span>]=&#123;<span class="number">14</span>,<span class="number">8</span>,<span class="number">18</span>,<span class="number">26</span>,<span class="number">17</span>,<span class="number">20</span>,<span class="number">22</span>,<span class="number">10</span>,<span class="number">3</span>,<span class="number">13</span>,<span class="number">11</span>,<span class="number">4</span>,<span class="number">23</span>,<span class="number">5</span>,<span class="number">24</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">25</span>,<span class="number">16</span>,<span class="number">19</span>,<span class="number">6</span>,<span class="number">15</span>,<span class="number">21</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">1</span>&#125;;</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 进行加密</span></span><br><span class="line">    <span class="keyword">char</span> cleartext[] = <span class="string">"the state key boratory of networking and switching technology belongs to beijing university of posts and telecommunication the laboratory was opened in nineteen ninety two in nineteen ninety five the laboratory passed acceptance inspection by government and an evaluation organized by ministry of science and technology in two thousand and two since two thousand an our the laboratory has been renamed as the state key laboratory of networking and switching technology by ministry of science and technology."</span>;</span><br><span class="line">    <span class="keyword">char</span> ciphertext[] = <span class="string">"the state key boratory of networking and switching technology belongs to beijing university of posts and telecommunication the laboratory was opened in nineteen ninety two in nineteen ninety five the laboratory passed acceptance inspection by government and an evaluation organized by ministry of science and technology in two thousand and two since two thousand an our the laboratory has been renamed as the state key laboratory of networking and switching technology by ministry of science and technology."</span>;</span><br><span class="line">    </span><br><span class="line">    Encrypt(cleartext,ciphertext,slow_wheel_l,slow_wheel_r,mid_wheel_l,mid_wheel_r,fast_wheel_l,fast_wheel_r);</span><br><span class="line">    <span class="comment">// 输出加密后的结果</span></span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"CIPHERTEXT:"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="built_in">strlen</span>(ciphertext)<span class="number">-1</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;ciphertext[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    Decrypt(ciphertext,cleartext,slow_wheel_l,slow_wheel_r,mid_wheel_l,mid_wheel_r,fast_wheel_l,fast_wheel_r);</span><br><span class="line">    <span class="comment">// 输出解密后的结果</span></span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"CLEARTEXT:"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="built_in">strlen</span>(cleartext)<span class="number">-1</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;cleartext[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">    getchar();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Turn_wheel</span><span class="params">(<span class="keyword">int</span>* wheel_l, <span class="keyword">int</span>* wheel_r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp = wheel_l[<span class="number">25</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">25</span>;i&gt;=<span class="number">1</span>;i--)</span><br><span class="line">    &#123;</span><br><span class="line">        wheel_l[i] = wheel_l[i<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    wheel_l[<span class="number">0</span>] = temp;</span><br><span class="line"></span><br><span class="line">    temp = wheel_r[<span class="number">25</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">25</span>;i&gt;=<span class="number">1</span>;i--)</span><br><span class="line">    &#123;</span><br><span class="line">        wheel_r[i] = wheel_r[i<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    wheel_r[<span class="number">0</span>] = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Reverse_turn_wheel</span><span class="params">(<span class="keyword">int</span>* wheel_l, <span class="keyword">int</span>* wheel_r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp = wheel_l[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">24</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        wheel_l[i] = wheel_l[i+<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    wheel_l[<span class="number">25</span>] = temp;</span><br><span class="line"></span><br><span class="line">    temp = wheel_r[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">24</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        wheel_r[i] = wheel_r[i+<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    wheel_r[<span class="number">25</span>] = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Encrypt</span><span class="params">(<span class="keyword">char</span>* cleartext,<span class="keyword">char</span>* ciphertext,<span class="keyword">int</span>* slow_wheel_l,<span class="keyword">int</span>* slow_wheel_r,<span class="keyword">int</span>* mid_wheel_l,<span class="keyword">int</span>* mid_wheel_r,</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">int</span>* fast_wheel_l,<span class="keyword">int</span>* fast_wheel_r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 分别定义三个转轮的计数器</span></span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 转轮加密过程</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="built_in">strlen</span>(cleartext)<span class="number">-1</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'a'</span>&lt;=cleartext[i] &amp;&amp; cleartext[i]&lt;=<span class="string">'z'</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> cur = cleartext[i]-<span class="string">'a'</span>;</span><br><span class="line">        </span><br><span class="line">            cur = slow_wheel_l[cur];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">26</span>;j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (cur == slow_wheel_r[j])</span><br><span class="line">                &#123;</span><br><span class="line">                    cur = mid_wheel_l[j];</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">26</span>;j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (cur == mid_wheel_r[j])</span><br><span class="line">                &#123;</span><br><span class="line">                    cur = fast_wheel_l[j];</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">26</span>;j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (cur == fast_wheel_r[j])</span><br><span class="line">                &#123;</span><br><span class="line">                    cur = j+<span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            ciphertext[i] = <span class="keyword">char</span>(cur+<span class="number">96</span>); </span><br><span class="line"></span><br><span class="line">            <span class="comment">// 判断三个转子是否需要转动</span></span><br><span class="line">            count++;</span><br><span class="line">            </span><br><span class="line">            Turn_wheel(fast_wheel_l, fast_wheel_r);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (count%<span class="number">26</span> == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                </span><br><span class="line">                Turn_wheel(mid_wheel_l, mid_wheel_r);</span><br><span class="line">                <span class="keyword">if</span> (count%(<span class="number">26</span>*<span class="number">26</span>) == <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    Turn_wheel(slow_wheel_l, slow_wheel_r);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">           </span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Decrypt</span><span class="params">(<span class="keyword">char</span>* ciphertext,<span class="keyword">char</span>* cleartext,<span class="keyword">int</span>* slow_wheel_l,<span class="keyword">int</span>* slow_wheel_r,<span class="keyword">int</span>* mid_wheel_l,<span class="keyword">int</span>* mid_wheel_r,</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">int</span>* fast_wheel_l,<span class="keyword">int</span>* fast_wheel_r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="built_in">strlen</span>(ciphertext)<span class="number">-1</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'a'</span>&lt;=ciphertext[i] &amp;&amp; ciphertext[i]&lt;=<span class="string">'z'</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;count&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    Reverse_turn_wheel(fast_wheel_l, fast_wheel_r);</span><br><span class="line">    <span class="keyword">if</span> (count%<span class="number">26</span> == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        Reverse_turn_wheel(mid_wheel_l, mid_wheel_r);</span><br><span class="line">        <span class="keyword">if</span> (count%(<span class="number">26</span>*<span class="number">26</span>) == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Turn_wheel(slow_wheel_l, slow_wheel_r);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 转轮解密过程</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="built_in">strlen</span>(ciphertext)<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'a'</span>&lt;=ciphertext[i] &amp;&amp; ciphertext[i]&lt;=<span class="string">'z'</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> cur = ciphertext[i]-<span class="string">'a'</span>;</span><br><span class="line">            cur = fast_wheel_r[cur];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">26</span>;j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (cur == fast_wheel_l[j])</span><br><span class="line">                &#123;</span><br><span class="line">                    cur = mid_wheel_r[j];</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">26</span>;j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (cur == mid_wheel_l[j])</span><br><span class="line">                &#123;</span><br><span class="line">                    cur = slow_wheel_r[j];</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">26</span>;j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (cur == slow_wheel_l[j])</span><br><span class="line">                &#123;</span><br><span class="line">                    cur = j+<span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 判断三个转子是否需要转动</span></span><br><span class="line">            count--;</span><br><span class="line">            Reverse_turn_wheel(fast_wheel_l, fast_wheel_r);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (count%<span class="number">26</span> == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                Reverse_turn_wheel(mid_wheel_l, mid_wheel_r);</span><br><span class="line">                <span class="keyword">if</span> (count%(<span class="number">26</span>*<span class="number">26</span>) == <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    Reverse_turn_wheel(slow_wheel_l, slow_wheel_r);   </span><br><span class="line">                &#125;</span><br><span class="line">        </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            cleartext[i] = <span class="keyword">char</span>(cur+<span class="number">96</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行后显示如下：<br><img src="https://img-blog.csdnimg.cn/20200307221522463.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cryptography/" rel="tag">Cryptography</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-CNN与RNN的比较" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/03/02/CNN%E4%B8%8ERNN%E7%9A%84%E6%AF%94%E8%BE%83/"
    >CNN与RNN的比较</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/03/02/CNN%E4%B8%8ERNN%E7%9A%84%E6%AF%94%E8%BE%83/" class="article-date">
  <time datetime="2020-03-02T13:53:33.000Z" itemprop="datePublished">2020-03-02</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="学习资料：B站教程"><a href="#学习资料：B站教程" class="headerlink" title="学习资料：B站教程"></a>学习资料：<a href="https://www.bilibili.com/video/av74959887?p=80" target="_blank" rel="noopener">B站教程</a></h3><h2 id="0x00-CNN-卷积神经网络"><a href="#0x00-CNN-卷积神经网络" class="headerlink" title="0x00 CNN:卷积神经网络"></a>0x00 CNN:卷积神经网络</h2><p><a href="https://blog.csdn.net/qq_36501027/article/details/83211682" target="_blank" rel="noopener">CSDN参考链接</a></p>
<p>一般用于<strong>图像识别，视觉数据(visual data)</strong>。</p>
<img src="https://s2.ax1x.com/2020/03/02/3fiUcq.png" width="60%">

<p>卷积神经网络的主要组成部分有：输入层、卷积层、池化层、全连接层。其中重点是卷积层与池化层。</p>
<h3 id="卷积层："><a href="#卷积层：" class="headerlink" title="卷积层："></a>卷积层：</h3><p>卷积层是卷积神经网络（CNN）的核心，但是什么是卷积呢？卷积就是图片中的局部数据和卷积核的内积，它是为了提取图片局部的特征，那卷积核又是什么呢？卷积核又称过滤器（filter），如下图，其实就是一组带有固定的权重的神经元，一组二维矩阵，用来提取一组特定的特征，提取的特征一般称为feature map（特征映射）。至于卷积层就是多个filter的叠加形成的，至于通道就是理解为视角、角度。例如同样是提取边界特征的卷积核，可以按照R、G、B三种元素的角度提取边界，RGB在边界这个角度上有不同的表达；再比如需要检查一个人的机器学习能力，可以从特征工程、模型选择、参数调优等多个方面检测。（最初输入的图片样本的 channels，取决于图片类型，比如RGB；卷积操作完成后输出的 out_channels ，取决于卷积核的数量。此时的 out_channels 也会作为下一次卷积时的卷积核的 in_channels；卷积核中的 in_channels ，就是上一次卷积的 out_channels ，如果是第一次做卷积，就是样本图片的channels）</p>
<img src="https://img-blog.csdn.net/20181021175409140?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2NTAxMDI3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" width="60%">

<p>至于卷积层的参数问题，就不得不提CNN的两大“特色”了，局部感知和权值共享！在BPNN里，我们可以看见一张图片假如它是黑白的，也就是100x100x1，而隐藏层的节点数是100个，那也就是说权重就高达100x100x1x100+100=1000100个，这还是比较小的单通道图片，在现在这种小图片很少了，所以在CNN里必须的精简参数了，不然难以训练出一个好的模型！为了解决这个问题。，CNN就提出了<strong>局部感知</strong>和<strong>权值共享</strong>两个方法。</p>
<h3 id="池化层："><a href="#池化层：" class="headerlink" title="池化层："></a>池化层：</h3><p><code>最大池化</code>思想很简单，以下图为例，把4x4的图像分割成4个不同的区域，然后输出每个区域的最大值，这就是最大池化所做的事情。其实这里我们选择了2x2的过滤器，步长为2。在一幅真正的图像中提取最大值可能意味着提取了某些特定特征，比如垂直边缘、一只眼睛等等。</p>
<img src="https://img-blog.csdn.net/20181021181434387?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2NTAxMDI3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" width="60%">

<p><code>平均池化</code>和最大池化唯一的不同是，它计算的是区域内的平均值而最大池化计算的是最大值。在日常应用使用最多的还是最大池化。</p>
<p>总结：池化层不会改变矩阵的深度，但是它可以缩小矩阵的大小，也可以进一步减少全连接层的节点数，从而减少整个神经网络的参数个数。</p>
<h2 id="0x01-RNN-循环神经网络"><a href="#0x01-RNN-循环神经网络" class="headerlink" title="0x01 RNN:循环神经网络"></a>0x01 RNN:循环神经网络</h2><p>[博客园参考链接]<a href="https://www.cnblogs.com/imzgmc/p/10632636.html" target="_blank" rel="noopener">https://www.cnblogs.com/imzgmc/p/10632636.html</a>)</p>
<p>一般用于连续的数据(sequential data)。</p>
<img src="https://s2.ax1x.com/2020/03/02/3fkCdO.png" width="60%">

<p>循环神经网络是一类用于处理序列数据的神经网络。它与其他神经网络的不同是，RNN可以更好的去处理序列的信息，即认准了前后的输入之间存在关系。在NLP (Natural Language Processing)中，去理解一整句话，孤立的理解组成这句话的词显然是不够的，我们需要整体的处理由这些词连接起来的整个序列。</p>
<p>如：(1) 我饿了，我要去食堂<strong><em>。(2)  我饭卡丢了，我要去食堂</em></strong>。很显然，第一句话是想表明去食堂就餐，而第二句则很有可能因为刚吃过饭，发现饭卡不见了，去食堂寻找饭卡。而在此之前，我们常用的语言模型是N-Gram，无论何种语境，可能去食堂大概率匹配的是“吃饭”而不在乎之前的信息。RNN就解决了N-Gram的缺陷，它在理论上可以往前(后)看任意多个词。</p>
<p>循环神经网络的大致结构：</p>
<img src="https://s2.ax1x.com/2020/03/02/3fkL0f.png" width="60%">

<h2 id="0x02-今后学习的方向"><a href="#0x02-今后学习的方向" class="headerlink" title="0x02 今后学习的方向"></a>0x02 今后学习的方向</h2><p>CNN, RNN网络的实例<br>数据可视化<br>计算机视觉</p>
<img src="https://s2.ax1x.com/2020/03/02/3fAKj1.png" width="60%">
      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Deep-Learning/" rel="tag">Deep Learning</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Tensorflow2-0-IMDB评论文本分类" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/02/29/Tensorflow2-0-IMDB%E8%AF%84%E8%AE%BA%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/"
    >Tensorflow2.0 IMDB评论文本分类</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/02/29/Tensorflow2-0-IMDB%E8%AF%84%E8%AE%BA%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/" class="article-date">
  <time datetime="2020-02-29T08:54:06.000Z" itemprop="datePublished">2020-02-29</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="学习资料：B站教程"><a href="#学习资料：B站教程" class="headerlink" title="学习资料：B站教程"></a>学习资料：<a href="https://www.bilibili.com/video/av71867574" target="_blank" rel="noopener">B站教程</a></h3><h2 id="0x00-文本预处理"><a href="#0x00-文本预处理" class="headerlink" title="0x00 文本预处理"></a>0x00 文本预处理</h2><p>在对训练数据集之前，我们需要对训练文本进行预处理，很多时候预处理其实比训练本身要花费更多的时间…预处理代码如下：</p>
<pre><code>import tensorflow as tf
from tensorflow import keras
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

data = tf.keras.datasets.imdb
(train_data, train_labels), (test_data, test_labels) = data.load_data(num_words = 88000)

word_index = data.get_word_index()

word_index = {k:(v+3) for k,v in word_index.items()}
word_index[&quot;&lt;PAD&gt;&quot;] = 0
word_index[&quot;&lt;START&gt;&quot;] = 1
word_index[&quot;&lt;UNK&gt;&quot;] = 2
word_index[&quot;&lt;UNUSED&gt;&quot;] = 3

reverse_word_index = dict([(value, key) for (key, value) in word_index.items()])

train_data = keras.preprocessing.sequence.pad_sequences(train_data, value=word_index[&quot;&lt;PAD&gt;&quot;], padding=&quot;post&quot;, maxlen=250)
test_data = keras.preprocessing.sequence.pad_sequences(test_data, value=word_index[&quot;&lt;PAD&gt;&quot;], padding=&quot;post&quot;, maxlen=250)

def decode_review(text):
    return &quot; &quot;.join([reverse_word_index.get(i, &quot;?&quot;) for i in text])</code></pre><h2 id="0x01-训练过程"><a href="#0x01-训练过程" class="headerlink" title="0x01 训练过程"></a>0x01 训练过程</h2><p><code>Embedding</code>层的作用：创建<strong>单词向量</strong>，并根据单词相关程度区分它们。   </p>
<p><code>GlobalAverage1D</code>层的作用：将任何尺寸的数据放入其中并将其放在一个较低的维度。</p>
<p><code>DENSE</code>层的作用：尝试对单词进行分类并掌握单词模式(pattern)，最终提升网络准确性(accuracy)</p>
<p>其中<code>binary_cross_entropy</code>是二分类的交叉熵，实际是多分类<code>softmax_cross_entropy</code>的一种特殊情况，当多分类中，类别只有两类时，即0或者1，即为二分类，二分类也是一个逻辑回归问题，也可以套用逻辑回归的损失函数。</p>
<p>model.fit中的batch_size：一轮训练的数据量。<br>    # model down here</p>
<pre><code>model = keras.Sequential()
model.add(keras.layers.Embedding(88000, 16))
model.add(keras.layers.GlobalAveragePooling1D())
model.add(keras.layers.Dense(16, activation=&apos;relu&apos;))
model.add(keras.layers.Dense(1, activation=&apos;sigmoid&apos;))

model.summary()
model.compile(optimizer=&quot;adam&quot;, loss=&quot;binary_crossentropy&quot;, metrics=[&quot;accuracy&quot;])</code></pre><p>整个模型结构如下：</p>
<img src="https://s2.ax1x.com/2020/02/29/3yBnc6.png" width="60%">


<p>验证集选取前10000，训练集选取10000以后的。</p>
<pre><code>x_val = train_data[:10000]
x_train = train_data[10000:]

y_val = train_labels[:10000]
y_train = train_labels[10000:]

fitModel = model.fit(x_train, y_train,epochs=40, batch_size=512,
                    validation_data=(x_val, y_val), verbose=1)

results = model.evaluate(test_data, test_labels)</code></pre><p>最后训练得出损失值是<code>0.3283079787778854</code>，正确率是<code>0.87256</code>。</p>
<h2 id="0x02-保存模型"><a href="#0x02-保存模型" class="headerlink" title="0x02 保存模型"></a>0x02 保存模型</h2><p>用如下的代码便可以很轻松的保存模型，保存在当前目录下。</p>
<pre><code>model.save(&quot;model.h5&quot;) 
model = keras.models.load_model(&quot;model.h5&quot;)</code></pre><h2 id="0x03-模型测试"><a href="#0x03-模型测试" class="headerlink" title="0x03 模型测试"></a>0x03 模型测试</h2><p>打开测试集文件，同样注意要进行文本预处理，<strong>细节</strong>很重要。</p>
<pre><code>def review_encode(s):
    encoded = [1]

    for word in s:
        if word.lower() in word_index:
            encoded.append(word_index[word.lower()])
        else:
            encoded.append(2)

    return encoded


with open(&quot;test.txt&quot;, encoding=&quot;utf-8&quot;) as f:
    for line in f.readlines():
        nline = line.replace(&quot;,&quot;,&quot;&quot;).replace(&quot;.&quot;, &quot;&quot;).replace(&quot;(&quot;,&quot;&quot;).replace(&quot;)&quot;,&quot;&quot;).replace(&quot;:&quot;,&quot;&quot;).replace(&quot;\&quot;&quot;,&quot;&quot;).strip().split(&quot; &quot;)

        encode = review_encode(nline)

        encode = keras.preprocessing.sequence.pad_sequences([encode], value=word_index[&quot;&lt;PAD&gt;&quot;], padding=&quot;post&quot;, maxlen=250)
        predict = model.predict(encode)
        print(line)
        print(encode)
        print(predict[0])    </code></pre><p>最终得到的预测结果是<code>0.93312705</code>，表明是positive的评论。 </p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tensorflow-2-0/" rel="tag">Tensorflow 2.0</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-数据结构单链表相关题目" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/02/23/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8D%95%E9%93%BE%E8%A1%A8%E7%9B%B8%E5%85%B3%E9%A2%98%E7%9B%AE/"
    >数据结构单链表相关题目</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/02/23/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8D%95%E9%93%BE%E8%A1%A8%E7%9B%B8%E5%85%B3%E9%A2%98%E7%9B%AE/" class="article-date">
  <time datetime="2020-02-23T09:08:04.000Z" itemprop="datePublished">2020-02-23</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="资料来源：CSDN"><a href="#资料来源：CSDN" class="headerlink" title="资料来源：CSDN"></a>资料来源：<a href="https://blog.csdn.net/weixin_44796147/article/details/100824206" target="_blank" rel="noopener">CSDN</a></h3><h2 id="题目一"><a href="#题目一" class="headerlink" title="题目一"></a>题目一</h2><p>完成下列算法填空，将两个有序递增的带表头结点的单链表合并为一个有序递增的单链表。<br>链表结点Node和链表SingleList结构体定义如下：</p>
<pre><code>typedef struct node
{
    ElemType element;
    struct node *link;
}Node;
typedef struct headerlist
{
    Node *head;
    int n;
}HeaderList;

void MergeList1(HeaderList *La,HeaderList *Lb,HeaderList *Lc) { 
    //合并链表La和Lb，合并后的新表使用头指针Lc指向 
    Node *pa,*pb,*pc,*q;
    pa=La-&gt;head-&gt;link; 
    pb=Lb-&gt;head-&gt;link; 
    pc=Lc-&gt;head; 
    while(pa &amp;&amp; pb) {
        if(____________________) { 
            pc-&gt;link=pa; 
            pc=pa; 
            pa=pa-&gt;link; 
            La-&gt;n--; 
        }
        else if(pa-&gt;element&gt;pb-&gt;element) { 
            pc-&gt;link=___________; 
            pc=________; 
            pb=_________;
            Lb-&gt;n--; 
        } 
        else { 
            pc-&gt;link=pa; 
            pc=pa; 
            pa=_________; 
            q=_________; 
            free(pb); 
            pb =q;
        } 
        Lc-&gt;n++; 
    } 
    pc-&gt;link=pa?pa:pb; //插入剩余段 Lc-&gt;n+=pa?La-&gt;n:Lb-&gt;n; 
}</code></pre><p>解答</p>
<pre><code>while(pa &amp;&amp; pb) {
    if(pa-&gt;element&lt;pb-&gt;element) { 
        pc-&gt;link=pa; 
        pc=pa; 
        pa=pa-&gt;link; 
        La-&gt;n--; }
    else if(pa-&gt;element&gt;pb-&gt;element) { 
        pc-&gt;link=___pb___; 
        pc=__pb__; 
        pb=__pb-&gt;link___;
        Lb-&gt;n--; } 
    else { 
        pc-&gt;link=pa; 
        pc=pa; 
        pa=__pa-&gt;link__; 
        q=__pb-&gt;link__; 
        free(pb); 
        pb =q; } 
Lc-&gt;n++; } 
pc-&gt;link=pa?pa:pb;
}</code></pre><p>这里的思路是源于​L-&gt;first=NULL; 题目要把链表首地址置为空，是要重新排列链表。<br>第一次循环，将q指向第二个结点，把第一个结点取下，然后拼到链表头结点上，然后p指针向后移；<br>第二次循环，将q指向第三个结点，把第二个结点取下，然后拼到头结点后、第一个结点前，然后p指针后移。以此类推，直到p移到了原链表的尾部结束循环。</p>
<h2 id="题目二"><a href="#题目二" class="headerlink" title="题目二"></a>题目二</h2><p>请完成算法填空，实现带表头结点的单链表形式实现的队列上的元素入队与出队操作，队列和元素结点结构体定义如下：</p>
<pre><code>typedef struct node
{
    ElemType element; 
    struct node* link;   
}Node;
typedef struct queue
{
    Node* front; //注意front指向表头结点，非头结点
    Node* rear; //指向尾结点
}Queue;

void EnQueue(Queue *Q, ElemType x)
{
    Node* p= (Node*)malloc(sizeof(Node));
    ____________ = x;
    p-&gt;link = NULL;
    ____________=p;
    Q-&gt;rear=p;
}

void DeQueue(Queue *Q)
{     
    //若队列为空，直接返回
    if(___________ ==NULL)  
            return; 
    Node *p=_____________;
    Q-&gt;front-&gt;link=___________;
    free(p);
        //若出队后，队列为空，则需重置rear
    if(______________==NULL)
        Q-&gt;rear=Q-&gt;front;//指向表头结点  
} </code></pre><p>解答</p>
<pre><code>while(pa &amp;&amp; pb) {
    if(pa-&gt;element&lt;pb-&gt;element) { 
        pc-&gt;link=pa; 
        pc=pa; 
        pa=pa-&gt;link; 
        La-&gt;n--; }
    else if(pa-&gt;element&gt;pb-&gt;element) { 
        pc-&gt;link=___pb___; 
        pc=__pb__; 
        pb=__pb-&gt;link___;
        Lb-&gt;n--; } 
    else { 
        pc-&gt;link=pa; 
        pc=pa; 
        pa=__pa-&gt;link__; 
        q=__pb-&gt;link__; 
        free(pb); 
        pb =q; } 
Lc-&gt;n++; } 
pc-&gt;link=pa?pa:pb;
}</code></pre>
      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Data-Structure/" rel="tag">Data Structure</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
  </article>
  

  
  <nav class="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul class="list-inline">
      <li>
        &copy;
        2015-2020
        Gengar
      </li>
      <li>
        
          Powered by
        
        
        <a href="https://hexo.io" target="_blank">Hexo</a> Theme <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul class="list-inline">
      <li>
        
        
        <span>
  <i>PV:<span id="busuanzi_value_page_pv"></span></i>
  <i>UV:<span id="busuanzi_value_site_uv"></span></i>
</span>
        
      </li>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>
    <div class="to_top">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>
      </div>
    </main>
      <aside class="sidebar">
        <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="Ayer"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
      </aside>
      <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
      
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>


<script src="/js/share.js"></script>



<script src="/fancybox/jquery.fancybox.min.js"></script>




<script>
  try {
    var typed = new Typed("#subtitle", {
    strings: ['Stay hungry. Stay foolish.','',''],
    startDelay: 0,
    typeSpeed: 200,
    loop: true,
    backSpeed: 100,
    showCursor: true
    });
  } catch (err) {
  }
  
</script>




<script>
  var ayerConfig = {
    mathjax: false
  }
</script>


<script src="/js/ayer.js"></script>


<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>




<script type="text/javascript" src="https://js.users.51.la/20544303.js"></script>
  </div>
</body>

</html>