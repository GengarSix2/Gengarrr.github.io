<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
    
  <meta name="description" content="一个兴趣使然的小站" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
     Ayer
  </title>
  <meta name="generator" content="hexo-theme-yilia-plus">
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  
<link rel="stylesheet" href="/css/style.css">

  
<script src="/js/pace.min.js"></script>


  

  

</head>

</html>

<body>
  <div id="app">
    <main class="content">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover1.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">Ayer</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>

<div id="main">
  <section class="outer">
  <article class="articles">
    
    
    
    
    <article id="post-转轮机的加解密实现" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/03/07/%E8%BD%AC%E8%BD%AE%E6%9C%BA%E7%9A%84%E5%8A%A0%E8%A7%A3%E5%AF%86%E5%AE%9E%E7%8E%B0/"
    >转轮机的加解密实现</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/03/07/%E8%BD%AC%E8%BD%AE%E6%9C%BA%E7%9A%84%E5%8A%A0%E8%A7%A3%E5%AF%86%E5%AE%9E%E7%8E%B0/" class="article-date">
  <time datetime="2020-03-07T14:20:10.000Z" itemprop="datePublished">2020-03-07</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="转轮机的加解密实现"><a href="#转轮机的加解密实现" class="headerlink" title="转轮机的加解密实现"></a>转轮机的加解密实现</h2><h4 id="0x00"><a href="#0x00" class="headerlink" title="0x00"></a>0x00</h4><p>密码学课程的第一个实验，要求实现转轮机的加解密，于是重新拿起C++变成，权当复习。</p>
<h4 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h4><p>转轮机的原理如下图：<br><img src="https://img-blog.csdnimg.cn/20200307221118136.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_10,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>转轮密码机由多个转轮构成，每个转轮旋转的速度都不一样，比如有3个转轮，分别标号为1,2,3，其中1号转轮转动26个字母后，2号转轮就转动一个字母，当2号转轮转动26个字母后，3号转轮就转动1个字母。因此，当转轮密码机转动26X26X26次后，所有转轮恢复到初始状态，即3个转轮密码机的一个周期长度为26X26X26（17576）的多表代换密码。<br>（资料来源：<a href="https://blog.csdn.net/zdh89786/article/details/84497357）" target="_blank" rel="noopener">https://blog.csdn.net/zdh89786/article/details/84497357）</a></p>
<h4 id="0x02"><a href="#0x02" class="headerlink" title="0x02"></a>0x02</h4><p>实现原理：首先定义了六个数组，即三组轮子，分别为慢轮左、慢轮右、中轮左、中轮右、快轮左、快轮右，用于存储转轮的初始状态。接着将密文的字符挨个输入，如果判断是字母则进行加密处理，同时计数。转轮的转动情况便是基于字符输入的次数，如果达到26的倍数，则中轮转动，如果达到26*26的倍数，则慢轮转动。解密过程反之即可。</p>
<p>源码如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Turn_wheel</span><span class="params">(<span class="keyword">int</span>* wheel_l, <span class="keyword">int</span>* wheel_r)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Reverse_turn_wheel</span><span class="params">(<span class="keyword">int</span>* wheel_l, <span class="keyword">int</span>* wheel_r)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Encrypt</span><span class="params">(<span class="keyword">char</span>* cleartext,<span class="keyword">char</span>* ciphertext,<span class="keyword">int</span>* slow_wheel_l,<span class="keyword">int</span>* slow_wheel_r,<span class="keyword">int</span>* mid_wheel_l,<span class="keyword">int</span>* mid_wheel_r,</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">int</span>* fast_wheel_l,<span class="keyword">int</span>* fast_wheel_r)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Decrypt</span><span class="params">(<span class="keyword">char</span>* ciphertext,<span class="keyword">char</span>* cleartext,<span class="keyword">int</span>* slow_wheel_l,<span class="keyword">int</span>* slow_wheel_r,<span class="keyword">int</span>* mid_wheel_l,<span class="keyword">int</span>* mid_wheel_r,</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">int</span>* fast_wheel_l,<span class="keyword">int</span>* fast_wheel_r)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义快、中、慢三组轮子</span></span><br><span class="line">    <span class="keyword">int</span> slow_wheel_l[<span class="number">26</span>]=&#123;<span class="number">24</span>,<span class="number">25</span>,<span class="number">26</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> slow_wheel_r[<span class="number">26</span>]=&#123;<span class="number">21</span>,<span class="number">3</span>,<span class="number">15</span>,<span class="number">1</span>,<span class="number">19</span>,<span class="number">10</span>,<span class="number">14</span>,<span class="number">26</span>,<span class="number">20</span>,<span class="number">8</span>,<span class="number">16</span>,<span class="number">7</span>,<span class="number">22</span>,<span class="number">4</span>,<span class="number">11</span>,<span class="number">5</span>,<span class="number">17</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">23</span>,<span class="number">18</span>,<span class="number">2</span>,<span class="number">25</span>,<span class="number">6</span>,<span class="number">24</span>,<span class="number">13</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> mid_wheel_l[<span class="number">26</span>]=&#123;<span class="number">26</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">24</span>,<span class="number">25</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> mid_wheel_r[<span class="number">26</span>]=&#123;<span class="number">20</span>,<span class="number">1</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">15</span>,<span class="number">3</span>,<span class="number">14</span>,<span class="number">12</span>,<span class="number">23</span>,<span class="number">5</span>,<span class="number">16</span>,<span class="number">2</span>,<span class="number">22</span>,<span class="number">19</span>,<span class="number">11</span>,<span class="number">18</span>,<span class="number">25</span>,<span class="number">24</span>,<span class="number">13</span>,<span class="number">7</span>,<span class="number">10</span>,<span class="number">8</span>,<span class="number">21</span>,<span class="number">9</span>,<span class="number">26</span>,<span class="number">17</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> fast_wheel_l[<span class="number">26</span>]=&#123;<span class="number">26</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">24</span>,<span class="number">25</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> fast_wheel_r[<span class="number">26</span>]=&#123;<span class="number">14</span>,<span class="number">8</span>,<span class="number">18</span>,<span class="number">26</span>,<span class="number">17</span>,<span class="number">20</span>,<span class="number">22</span>,<span class="number">10</span>,<span class="number">3</span>,<span class="number">13</span>,<span class="number">11</span>,<span class="number">4</span>,<span class="number">23</span>,<span class="number">5</span>,<span class="number">24</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">25</span>,<span class="number">16</span>,<span class="number">19</span>,<span class="number">6</span>,<span class="number">15</span>,<span class="number">21</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">1</span>&#125;;</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 进行加密</span></span><br><span class="line">    <span class="keyword">char</span> cleartext[] = <span class="string">"the state key boratory of networking and switching technology belongs to beijing university of posts and telecommunication the laboratory was opened in nineteen ninety two in nineteen ninety five the laboratory passed acceptance inspection by government and an evaluation organized by ministry of science and technology in two thousand and two since two thousand an our the laboratory has been renamed as the state key laboratory of networking and switching technology by ministry of science and technology."</span>;</span><br><span class="line">    <span class="keyword">char</span> ciphertext[] = <span class="string">"the state key boratory of networking and switching technology belongs to beijing university of posts and telecommunication the laboratory was opened in nineteen ninety two in nineteen ninety five the laboratory passed acceptance inspection by government and an evaluation organized by ministry of science and technology in two thousand and two since two thousand an our the laboratory has been renamed as the state key laboratory of networking and switching technology by ministry of science and technology."</span>;</span><br><span class="line">    </span><br><span class="line">    Encrypt(cleartext,ciphertext,slow_wheel_l,slow_wheel_r,mid_wheel_l,mid_wheel_r,fast_wheel_l,fast_wheel_r);</span><br><span class="line">    <span class="comment">// 输出加密后的结果</span></span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"CIPHERTEXT:"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="built_in">strlen</span>(ciphertext)<span class="number">-1</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;ciphertext[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    Decrypt(ciphertext,cleartext,slow_wheel_l,slow_wheel_r,mid_wheel_l,mid_wheel_r,fast_wheel_l,fast_wheel_r);</span><br><span class="line">    <span class="comment">// 输出解密后的结果</span></span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"CLEARTEXT:"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="built_in">strlen</span>(cleartext)<span class="number">-1</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;cleartext[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">    getchar();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Turn_wheel</span><span class="params">(<span class="keyword">int</span>* wheel_l, <span class="keyword">int</span>* wheel_r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp = wheel_l[<span class="number">25</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">25</span>;i&gt;=<span class="number">1</span>;i--)</span><br><span class="line">    &#123;</span><br><span class="line">        wheel_l[i] = wheel_l[i<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    wheel_l[<span class="number">0</span>] = temp;</span><br><span class="line"></span><br><span class="line">    temp = wheel_r[<span class="number">25</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">25</span>;i&gt;=<span class="number">1</span>;i--)</span><br><span class="line">    &#123;</span><br><span class="line">        wheel_r[i] = wheel_r[i<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    wheel_r[<span class="number">0</span>] = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Reverse_turn_wheel</span><span class="params">(<span class="keyword">int</span>* wheel_l, <span class="keyword">int</span>* wheel_r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp = wheel_l[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">24</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        wheel_l[i] = wheel_l[i+<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    wheel_l[<span class="number">25</span>] = temp;</span><br><span class="line"></span><br><span class="line">    temp = wheel_r[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">24</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        wheel_r[i] = wheel_r[i+<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    wheel_r[<span class="number">25</span>] = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Encrypt</span><span class="params">(<span class="keyword">char</span>* cleartext,<span class="keyword">char</span>* ciphertext,<span class="keyword">int</span>* slow_wheel_l,<span class="keyword">int</span>* slow_wheel_r,<span class="keyword">int</span>* mid_wheel_l,<span class="keyword">int</span>* mid_wheel_r,</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">int</span>* fast_wheel_l,<span class="keyword">int</span>* fast_wheel_r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 分别定义三个转轮的计数器</span></span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 转轮加密过程</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="built_in">strlen</span>(cleartext)<span class="number">-1</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'a'</span>&lt;=cleartext[i] &amp;&amp; cleartext[i]&lt;=<span class="string">'z'</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> cur = cleartext[i]-<span class="string">'a'</span>;</span><br><span class="line">        </span><br><span class="line">            cur = slow_wheel_l[cur];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">26</span>;j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (cur == slow_wheel_r[j])</span><br><span class="line">                &#123;</span><br><span class="line">                    cur = mid_wheel_l[j];</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">26</span>;j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (cur == mid_wheel_r[j])</span><br><span class="line">                &#123;</span><br><span class="line">                    cur = fast_wheel_l[j];</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">26</span>;j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (cur == fast_wheel_r[j])</span><br><span class="line">                &#123;</span><br><span class="line">                    cur = j+<span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            ciphertext[i] = <span class="keyword">char</span>(cur+<span class="number">96</span>); </span><br><span class="line"></span><br><span class="line">            <span class="comment">// 判断三个转子是否需要转动</span></span><br><span class="line">            count++;</span><br><span class="line">            </span><br><span class="line">            Turn_wheel(fast_wheel_l, fast_wheel_r);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (count%<span class="number">26</span> == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                </span><br><span class="line">                Turn_wheel(mid_wheel_l, mid_wheel_r);</span><br><span class="line">                <span class="keyword">if</span> (count%(<span class="number">26</span>*<span class="number">26</span>) == <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    Turn_wheel(slow_wheel_l, slow_wheel_r);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">           </span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Decrypt</span><span class="params">(<span class="keyword">char</span>* ciphertext,<span class="keyword">char</span>* cleartext,<span class="keyword">int</span>* slow_wheel_l,<span class="keyword">int</span>* slow_wheel_r,<span class="keyword">int</span>* mid_wheel_l,<span class="keyword">int</span>* mid_wheel_r,</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">int</span>* fast_wheel_l,<span class="keyword">int</span>* fast_wheel_r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="built_in">strlen</span>(ciphertext)<span class="number">-1</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'a'</span>&lt;=ciphertext[i] &amp;&amp; ciphertext[i]&lt;=<span class="string">'z'</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;count&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    Reverse_turn_wheel(fast_wheel_l, fast_wheel_r);</span><br><span class="line">    <span class="keyword">if</span> (count%<span class="number">26</span> == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        Reverse_turn_wheel(mid_wheel_l, mid_wheel_r);</span><br><span class="line">        <span class="keyword">if</span> (count%(<span class="number">26</span>*<span class="number">26</span>) == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Turn_wheel(slow_wheel_l, slow_wheel_r);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 转轮解密过程</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="built_in">strlen</span>(ciphertext)<span class="number">-1</span>;i&gt;=<span class="number">0</span>;i--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'a'</span>&lt;=ciphertext[i] &amp;&amp; ciphertext[i]&lt;=<span class="string">'z'</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> cur = ciphertext[i]-<span class="string">'a'</span>;</span><br><span class="line">            cur = fast_wheel_r[cur];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">26</span>;j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (cur == fast_wheel_l[j])</span><br><span class="line">                &#123;</span><br><span class="line">                    cur = mid_wheel_r[j];</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">26</span>;j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (cur == mid_wheel_l[j])</span><br><span class="line">                &#123;</span><br><span class="line">                    cur = slow_wheel_r[j];</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">26</span>;j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (cur == slow_wheel_l[j])</span><br><span class="line">                &#123;</span><br><span class="line">                    cur = j+<span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 判断三个转子是否需要转动</span></span><br><span class="line">            count--;</span><br><span class="line">            Reverse_turn_wheel(fast_wheel_l, fast_wheel_r);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (count%<span class="number">26</span> == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                Reverse_turn_wheel(mid_wheel_l, mid_wheel_r);</span><br><span class="line">                <span class="keyword">if</span> (count%(<span class="number">26</span>*<span class="number">26</span>) == <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    Reverse_turn_wheel(slow_wheel_l, slow_wheel_r);   </span><br><span class="line">                &#125;</span><br><span class="line">        </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            cleartext[i] = <span class="keyword">char</span>(cur+<span class="number">96</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行后显示如下：<br><img src="https://img-blog.csdnimg.cn/20200307221522463.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cryptography/" rel="tag">Cryptography</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-CNN与RNN的比较" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/03/02/CNN%E4%B8%8ERNN%E7%9A%84%E6%AF%94%E8%BE%83/"
    >CNN与RNN的比较</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/03/02/CNN%E4%B8%8ERNN%E7%9A%84%E6%AF%94%E8%BE%83/" class="article-date">
  <time datetime="2020-03-02T13:53:33.000Z" itemprop="datePublished">2020-03-02</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="学习资料：B站教程"><a href="#学习资料：B站教程" class="headerlink" title="学习资料：B站教程"></a>学习资料：<a href="https://www.bilibili.com/video/av74959887?p=80" target="_blank" rel="noopener">B站教程</a></h3><h2 id="0x00-CNN-卷积神经网络"><a href="#0x00-CNN-卷积神经网络" class="headerlink" title="0x00 CNN:卷积神经网络"></a>0x00 CNN:卷积神经网络</h2><p><a href="https://blog.csdn.net/qq_36501027/article/details/83211682" target="_blank" rel="noopener">CSDN参考链接</a></p>
<p>一般用于<strong>图像识别，视觉数据(visual data)</strong>。</p>
<img src='https://s2.ax1x.com/2020/03/02/3fiUcq.png' width=60%>

<p>卷积神经网络的主要组成部分有：输入层、卷积层、池化层、全连接层。其中重点是卷积层与池化层。</p>
<h3 id="卷积层："><a href="#卷积层：" class="headerlink" title="卷积层："></a>卷积层：</h3><p>卷积层是卷积神经网络（CNN）的核心，但是什么是卷积呢？卷积就是图片中的局部数据和卷积核的内积，它是为了提取图片局部的特征，那卷积核又是什么呢？卷积核又称过滤器（filter），如下图，其实就是一组带有固定的权重的神经元，一组二维矩阵，用来提取一组特定的特征，提取的特征一般称为feature map（特征映射）。至于卷积层就是多个filter的叠加形成的，至于通道就是理解为视角、角度。例如同样是提取边界特征的卷积核，可以按照R、G、B三种元素的角度提取边界，RGB在边界这个角度上有不同的表达；再比如需要检查一个人的机器学习能力，可以从特征工程、模型选择、参数调优等多个方面检测。（最初输入的图片样本的 channels，取决于图片类型，比如RGB；卷积操作完成后输出的 out_channels ，取决于卷积核的数量。此时的 out_channels 也会作为下一次卷积时的卷积核的 in_channels；卷积核中的 in_channels ，就是上一次卷积的 out_channels ，如果是第一次做卷积，就是样本图片的channels）</p>
<img src='https://img-blog.csdn.net/20181021175409140?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2NTAxMDI3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70' width=60%>

<p>至于卷积层的参数问题，就不得不提CNN的两大“特色”了，局部感知和权值共享！在BPNN里，我们可以看见一张图片假如它是黑白的，也就是100x100x1，而隐藏层的节点数是100个，那也就是说权重就高达100x100x1x100+100=1000100个，这还是比较小的单通道图片，在现在这种小图片很少了，所以在CNN里必须的精简参数了，不然难以训练出一个好的模型！为了解决这个问题。，CNN就提出了<strong>局部感知</strong>和<strong>权值共享</strong>两个方法。</p>
<h3 id="池化层："><a href="#池化层：" class="headerlink" title="池化层："></a>池化层：</h3><p><code>最大池化</code>思想很简单，以下图为例，把4x4的图像分割成4个不同的区域，然后输出每个区域的最大值，这就是最大池化所做的事情。其实这里我们选择了2x2的过滤器，步长为2。在一幅真正的图像中提取最大值可能意味着提取了某些特定特征，比如垂直边缘、一只眼睛等等。</p>
<img src='https://img-blog.csdn.net/20181021181434387?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2NTAxMDI3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70' width=60%>

<p><code>平均池化</code>和最大池化唯一的不同是，它计算的是区域内的平均值而最大池化计算的是最大值。在日常应用使用最多的还是最大池化。</p>
<p>总结：池化层不会改变矩阵的深度，但是它可以缩小矩阵的大小，也可以进一步减少全连接层的节点数，从而减少整个神经网络的参数个数。</p>
<h2 id="0x01-RNN-循环神经网络"><a href="#0x01-RNN-循环神经网络" class="headerlink" title="0x01 RNN:循环神经网络"></a>0x01 RNN:循环神经网络</h2><p>[博客园参考链接]<a href="https://www.cnblogs.com/imzgmc/p/10632636.html" target="_blank" rel="noopener">https://www.cnblogs.com/imzgmc/p/10632636.html</a>)</p>
<p>一般用于连续的数据(sequential data)。</p>
<img src='https://s2.ax1x.com/2020/03/02/3fkCdO.png' width=60%>

<p>循环神经网络是一类用于处理序列数据的神经网络。它与其他神经网络的不同是，RNN可以更好的去处理序列的信息，即认准了前后的输入之间存在关系。在NLP (Natural Language Processing)中，去理解一整句话，孤立的理解组成这句话的词显然是不够的，我们需要整体的处理由这些词连接起来的整个序列。</p>
<p>如：(1) 我饿了，我要去食堂<strong><em>。(2)  我饭卡丢了，我要去食堂</em></strong>。很显然，第一句话是想表明去食堂就餐，而第二句则很有可能因为刚吃过饭，发现饭卡不见了，去食堂寻找饭卡。而在此之前，我们常用的语言模型是N-Gram，无论何种语境，可能去食堂大概率匹配的是“吃饭”而不在乎之前的信息。RNN就解决了N-Gram的缺陷，它在理论上可以往前(后)看任意多个词。</p>
<p>循环神经网络的大致结构：</p>
<img src='https://s2.ax1x.com/2020/03/02/3fkL0f.png' width=60%>

<h2 id="0x02-今后学习的方向"><a href="#0x02-今后学习的方向" class="headerlink" title="0x02 今后学习的方向"></a>0x02 今后学习的方向</h2><p>CNN, RNN网络的实例<br>数据可视化<br>计算机视觉</p>
<img src='https://s2.ax1x.com/2020/03/02/3fAKj1.png' width=60%>
      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Deep-Learning/" rel="tag">Deep Learning</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Tensorflow2-0-IMDB评论文本分类" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/02/29/Tensorflow2-0-IMDB%E8%AF%84%E8%AE%BA%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/"
    >Tensorflow2.0 IMDB评论文本分类</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/02/29/Tensorflow2-0-IMDB%E8%AF%84%E8%AE%BA%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/" class="article-date">
  <time datetime="2020-02-29T08:54:06.000Z" itemprop="datePublished">2020-02-29</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="学习资料：B站教程"><a href="#学习资料：B站教程" class="headerlink" title="学习资料：B站教程"></a>学习资料：<a href="https://www.bilibili.com/video/av71867574" target="_blank" rel="noopener">B站教程</a></h3><h2 id="0x00-文本预处理"><a href="#0x00-文本预处理" class="headerlink" title="0x00 文本预处理"></a>0x00 文本预处理</h2><p>在对训练数据集之前，我们需要对训练文本进行预处理，很多时候预处理其实比训练本身要花费更多的时间…预处理代码如下：</p>
<pre><code>import tensorflow as tf
from tensorflow import keras
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

data = tf.keras.datasets.imdb
(train_data, train_labels), (test_data, test_labels) = data.load_data(num_words = 88000)

word_index = data.get_word_index()

word_index = {k:(v+3) for k,v in word_index.items()}
word_index[&quot;&lt;PAD&gt;&quot;] = 0
word_index[&quot;&lt;START&gt;&quot;] = 1
word_index[&quot;&lt;UNK&gt;&quot;] = 2
word_index[&quot;&lt;UNUSED&gt;&quot;] = 3

reverse_word_index = dict([(value, key) for (key, value) in word_index.items()])

train_data = keras.preprocessing.sequence.pad_sequences(train_data, value=word_index[&quot;&lt;PAD&gt;&quot;], padding=&quot;post&quot;, maxlen=250)
test_data = keras.preprocessing.sequence.pad_sequences(test_data, value=word_index[&quot;&lt;PAD&gt;&quot;], padding=&quot;post&quot;, maxlen=250)

def decode_review(text):
    return &quot; &quot;.join([reverse_word_index.get(i, &quot;?&quot;) for i in text])</code></pre><h2 id="0x01-训练过程"><a href="#0x01-训练过程" class="headerlink" title="0x01 训练过程"></a>0x01 训练过程</h2><p><code>Embedding</code>层的作用：创建<strong>单词向量</strong>，并根据单词相关程度区分它们。   </p>
<p><code>GlobalAverage1D</code>层的作用：将任何尺寸的数据放入其中并将其放在一个较低的维度。</p>
<p><code>DENSE</code>层的作用：尝试对单词进行分类并掌握单词模式(pattern)，最终提升网络准确性(accuracy)</p>
<p>其中<code>binary_cross_entropy</code>是二分类的交叉熵，实际是多分类<code>softmax_cross_entropy</code>的一种特殊情况，当多分类中，类别只有两类时，即0或者1，即为二分类，二分类也是一个逻辑回归问题，也可以套用逻辑回归的损失函数。</p>
<p>model.fit中的batch_size：一轮训练的数据量。<br>    # model down here</p>
<pre><code>model = keras.Sequential()
model.add(keras.layers.Embedding(88000, 16))
model.add(keras.layers.GlobalAveragePooling1D())
model.add(keras.layers.Dense(16, activation=&apos;relu&apos;))
model.add(keras.layers.Dense(1, activation=&apos;sigmoid&apos;))

model.summary()
model.compile(optimizer=&quot;adam&quot;, loss=&quot;binary_crossentropy&quot;, metrics=[&quot;accuracy&quot;])</code></pre><p>整个模型结构如下：</p>
<img src='https://s2.ax1x.com/2020/02/29/3yBnc6.png' width=60%>


<p>验证集选取前10000，训练集选取10000以后的。</p>
<pre><code>x_val = train_data[:10000]
x_train = train_data[10000:]

y_val = train_labels[:10000]
y_train = train_labels[10000:]

fitModel = model.fit(x_train, y_train,epochs=40, batch_size=512,
                    validation_data=(x_val, y_val), verbose=1)

results = model.evaluate(test_data, test_labels)</code></pre><p>最后训练得出损失值是<code>0.3283079787778854</code>，正确率是<code>0.87256</code>。</p>
<h2 id="0x02-保存模型"><a href="#0x02-保存模型" class="headerlink" title="0x02 保存模型"></a>0x02 保存模型</h2><p>用如下的代码便可以很轻松的保存模型，保存在当前目录下。</p>
<pre><code>model.save(&quot;model.h5&quot;) 
model = keras.models.load_model(&quot;model.h5&quot;)</code></pre><h2 id="0x03-模型测试"><a href="#0x03-模型测试" class="headerlink" title="0x03 模型测试"></a>0x03 模型测试</h2><p>打开测试集文件，同样注意要进行文本预处理，<strong>细节</strong>很重要。</p>
<pre><code>def review_encode(s):
    encoded = [1]

    for word in s:
        if word.lower() in word_index:
            encoded.append(word_index[word.lower()])
        else:
            encoded.append(2)

    return encoded


with open(&quot;test.txt&quot;, encoding=&quot;utf-8&quot;) as f:
    for line in f.readlines():
        nline = line.replace(&quot;,&quot;,&quot;&quot;).replace(&quot;.&quot;, &quot;&quot;).replace(&quot;(&quot;,&quot;&quot;).replace(&quot;)&quot;,&quot;&quot;).replace(&quot;:&quot;,&quot;&quot;).replace(&quot;\&quot;&quot;,&quot;&quot;).strip().split(&quot; &quot;)

        encode = review_encode(nline)

        encode = keras.preprocessing.sequence.pad_sequences([encode], value=word_index[&quot;&lt;PAD&gt;&quot;], padding=&quot;post&quot;, maxlen=250)
        predict = model.predict(encode)
        print(line)
        print(encode)
        print(predict[0])    </code></pre><p>最终得到的预测结果是<code>0.93312705</code>，表明是positive的评论。 </p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tensorflow-2-0/" rel="tag">Tensorflow 2.0</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-数据结构单链表相关题目" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/02/23/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8D%95%E9%93%BE%E8%A1%A8%E7%9B%B8%E5%85%B3%E9%A2%98%E7%9B%AE/"
    >数据结构单链表相关题目</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/02/23/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8D%95%E9%93%BE%E8%A1%A8%E7%9B%B8%E5%85%B3%E9%A2%98%E7%9B%AE/" class="article-date">
  <time datetime="2020-02-23T09:08:04.000Z" itemprop="datePublished">2020-02-23</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="资料来源：CSDN"><a href="#资料来源：CSDN" class="headerlink" title="资料来源：CSDN"></a>资料来源：<a href="https://blog.csdn.net/weixin_44796147/article/details/100824206" target="_blank" rel="noopener">CSDN</a></h3><h2 id="题目一"><a href="#题目一" class="headerlink" title="题目一"></a>题目一</h2><p>完成下列算法填空，将两个有序递增的带表头结点的单链表合并为一个有序递增的单链表。<br>链表结点Node和链表SingleList结构体定义如下：</p>
<pre><code>typedef struct node
{
    ElemType element;
    struct node *link;
}Node;
typedef struct headerlist
{
    Node *head;
    int n;
}HeaderList;

void MergeList1(HeaderList *La,HeaderList *Lb,HeaderList *Lc) { 
    //合并链表La和Lb，合并后的新表使用头指针Lc指向 
    Node *pa,*pb,*pc,*q;
    pa=La-&gt;head-&gt;link; 
    pb=Lb-&gt;head-&gt;link; 
    pc=Lc-&gt;head; 
    while(pa &amp;&amp; pb) {
        if(____________________) { 
            pc-&gt;link=pa; 
            pc=pa; 
            pa=pa-&gt;link; 
            La-&gt;n--; 
        }
        else if(pa-&gt;element&gt;pb-&gt;element) { 
            pc-&gt;link=___________; 
            pc=________; 
            pb=_________;
            Lb-&gt;n--; 
        } 
        else { 
            pc-&gt;link=pa; 
            pc=pa; 
            pa=_________; 
            q=_________; 
            free(pb); 
            pb =q;
        } 
        Lc-&gt;n++; 
    } 
    pc-&gt;link=pa?pa:pb; //插入剩余段 Lc-&gt;n+=pa?La-&gt;n:Lb-&gt;n; 
}</code></pre><p>解答</p>
<pre><code>while(pa &amp;&amp; pb) {
    if(pa-&gt;element&lt;pb-&gt;element) { 
        pc-&gt;link=pa; 
        pc=pa; 
        pa=pa-&gt;link; 
        La-&gt;n--; }
    else if(pa-&gt;element&gt;pb-&gt;element) { 
        pc-&gt;link=___pb___; 
        pc=__pb__; 
        pb=__pb-&gt;link___;
        Lb-&gt;n--; } 
    else { 
        pc-&gt;link=pa; 
        pc=pa; 
        pa=__pa-&gt;link__; 
        q=__pb-&gt;link__; 
        free(pb); 
        pb =q; } 
Lc-&gt;n++; } 
pc-&gt;link=pa?pa:pb;
}</code></pre><p>这里的思路是源于​L-&gt;first=NULL; 题目要把链表首地址置为空，是要重新排列链表。<br>第一次循环，将q指向第二个结点，把第一个结点取下，然后拼到链表头结点上，然后p指针向后移；<br>第二次循环，将q指向第三个结点，把第二个结点取下，然后拼到头结点后、第一个结点前，然后p指针后移。以此类推，直到p移到了原链表的尾部结束循环。</p>
<h2 id="题目二"><a href="#题目二" class="headerlink" title="题目二"></a>题目二</h2><p>请完成算法填空，实现带表头结点的单链表形式实现的队列上的元素入队与出队操作，队列和元素结点结构体定义如下：</p>
<pre><code>typedef struct node
{
    ElemType element; 
    struct node* link;   
}Node;
typedef struct queue
{
    Node* front; //注意front指向表头结点，非头结点
    Node* rear; //指向尾结点
}Queue;

void EnQueue(Queue *Q, ElemType x)
{
    Node* p= (Node*)malloc(sizeof(Node));
    ____________ = x;
    p-&gt;link = NULL;
    ____________=p;
    Q-&gt;rear=p;
}

void DeQueue(Queue *Q)
{     
    //若队列为空，直接返回
    if(___________ ==NULL)  
            return; 
    Node *p=_____________;
    Q-&gt;front-&gt;link=___________;
    free(p);
        //若出队后，队列为空，则需重置rear
    if(______________==NULL)
        Q-&gt;rear=Q-&gt;front;//指向表头结点  
} </code></pre><p>解答</p>
<pre><code>while(pa &amp;&amp; pb) {
    if(pa-&gt;element&lt;pb-&gt;element) { 
        pc-&gt;link=pa; 
        pc=pa; 
        pa=pa-&gt;link; 
        La-&gt;n--; }
    else if(pa-&gt;element&gt;pb-&gt;element) { 
        pc-&gt;link=___pb___; 
        pc=__pb__; 
        pb=__pb-&gt;link___;
        Lb-&gt;n--; } 
    else { 
        pc-&gt;link=pa; 
        pc=pa; 
        pa=__pa-&gt;link__; 
        q=__pb-&gt;link__; 
        free(pb); 
        pb =q; } 
Lc-&gt;n++; } 
pc-&gt;link=pa?pa:pb;
}</code></pre>
      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Data-Structure/" rel="tag">Data Structure</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Crackme-2" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/02/20/Crackme-2/"
    >Crackme_2</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/02/20/Crackme-2/" class="article-date">
  <time datetime="2020-02-20T12:51:46.000Z" itemprop="datePublished">2020-02-20</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h1 id="第二个CrackMe"><a href="#第二个CrackMe" class="headerlink" title="第二个CrackMe"></a>第二个CrackMe</h1><h3 id="0x00-初步查壳"><a href="#0x00-初步查壳" class="headerlink" title="0x00 初步查壳"></a>0x00 初步查壳</h3><p>  <img src="https://img-blog.csdnimg.cn/2019042709530249.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_12,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p> <img src="https://img-blog.csdnimg.cn/20190427101529926.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>  无壳。但发现了MD5函数，后面要注意。<br>  先直接利用IDA静态分析。</p>
<h3 id="0x01-静态分析"><a href="#0x01-静态分析" class="headerlink" title="0x01 静态分析"></a>0x01 静态分析</h3><p>  拖入IDA，发现DialogFunc函数，点开分析。<br>  <img src="https://img-blog.csdnimg.cn/20190427095647844.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_12,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>  利用关键字符串，大致找到程序入口。</p>
<h3 id="0x02-动态分析"><a href="#0x02-动态分析" class="headerlink" title="0x02 动态分析"></a>0x02 动态分析</h3><p>  拖入OD，定位至00401AAA,函数主体部分应该就在这附近了。<br>  <img src="https://img-blog.csdnimg.cn/20190427100334404.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>  往上翻一翻，看看能否找到关键函数。<br><img src="https://img-blog.csdnimg.cn/2019042710124424.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>  果然发现两个GetDlgItemTextA函数，都断下试试。<br><img src="https://img-blog.csdnimg.cn/20190427101408337.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="随便输入姓名和注册码"></p>
<p> 随便输入姓名和注册码，按F9，发现两个点都被断下，但并未在寄存器中找到明显与注册码相关的数字。<br><img src="https://img-blog.csdnimg.cn/20190427102053977.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>继续往下查看，注意00401B13和00401B18两处的call函数，比较关键。跟入查看。果然在第二个call函数cm2.00401B79处发现端倪。<br><img src="https://img-blog.csdnimg.cn/20190427102405591.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="0x03-算法简单分析"><a href="#0x03-算法简单分析" class="headerlink" title="0x03 算法简单分析"></a>0x03 算法简单分析</h3><p>为了理解这里的四段函数，我们需要引入MD5的概念。</p>
<blockquote>
<p>1、数据初始化过程 首先要对需加密消息进行数据填充，使消息的长度对 512取模后等于448，消息长度 mod 512=448。不足位数 在消息（字符串）后面进行填充，填充第一位为1，其 余为0。即第一个字节为0x80,其余字节为0x00。<br> 2、添加消息长度 再填充上原消息的长度，例如欲加密字符为16个ASCII， 即16字节×8位=128位，16进制：0x80,但它是一个 QWORD值，占用8个字节。在此步骤进行完毕后，最 终消息长度就是512的整数倍。<br> 3、数据加密处理 准备需要用到的数据： 4个种子值： A = 0x67452301, B = 0xEFCDAB89, C = 0x98BADCFE, D = 0x10325476; 4个函数：F(X,Y,Z)=(X &amp; Y) | ((<del>X) &amp; Z); G(X,Y,Z)=(X &amp; Z) | (Y &amp; (</del>Z)); H(X,Y,Z)=X ^ Y ^ Z; I(X,Y,Z)=Y ^ (X | (~Z)); 把消息分以512位为一分组进行处理，每一个分组进行4轮变换， 以上面所说4个常数为起始变量进行计算，重新输出4个变量，以 这4个变量再进行下一分组的运算，如果已经是最后一个分组，则 这4个变量为最后的结果，即MD5值。</p>
</blockquote>
<p>由MD5加密的概念我们可以知道，这四组函数便是四个种子值，我们回到函数主体部分继续分析。<br><img src="https://img-blog.csdnimg.cn/20190427102750558.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">由jnz可知，只要eax中字符串不为0则不跳转，即可跳出注册码成功的消息框。其实这题的答案已经很明显，就是String2，不过以我目前的水平还很难解释String2是如何计算出的……同时，经过测试，不同的name会产生不同的String2，这也进一步验证了此crackme的md5算法。</p>
<p><img src="https://img-blog.csdnimg.cn/20190427103536737.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>结束。</p>
<h3 id="0x04-总结"><a href="#0x04-总结" class="headerlink" title="0x04 总结"></a>0x04 总结</h3><p>不同的CrackMe总是有着不同的算法，还是那句话，能不爆破尽量不爆破，多分析加密算法才能更好地提升自我。</p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reverse/" rel="tag">Reverse</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Crackme-1" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/02/20/Crackme-1/"
    >Crackme_1</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/02/20/Crackme-1/" class="article-date">
  <time datetime="2020-02-20T12:51:36.000Z" itemprop="datePublished">2020-02-20</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h1 id="第一个CrackMe"><a href="#第一个CrackMe" class="headerlink" title="第一个CrackMe"></a>第一个CrackMe</h1><h3 id="0x00-摘要"><a href="#0x00-摘要" class="headerlink" title="0x00 摘要"></a>0x00 摘要</h3><p>   最近正式开始学习逆向破解，下面附上我破解的第一个crackme小程序，以作留念。</p>
<h3 id="0x01-初步查壳"><a href="#0x01-初步查壳" class="headerlink" title="0x01 初步查壳"></a>0x01 初步查壳</h3><p>   拖入PEID中查壳分析。<br>   <img src="https://img-blog.csdnimg.cn/20190407180109290.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_12,color_FFFFFF,t_70" alt="无壳。VC++6.0。省去脱壳的步骤。"><br>   无壳。VC++6.0。省去脱壳的步骤。</p>
<h3 id="0x02-反汇编分析"><a href="#0x02-反汇编分析" class="headerlink" title="0x02 反汇编分析"></a>0x02 反汇编分析</h3><p>   拖入OD分析。<br>   <img src="https://img-blog.csdnimg.cn/20190407180724980.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>  从最简单的字符串入手，查找“所有参考文本字符串”。<br><img src="https://img-blog.csdnimg.cn/20190407180846589.png" alt="在这里插入图片描述"><br>发现仅有一句字符串，“注册码正确！！！”。赶紧点开跟入。<br><img src="https://img-blog.csdnimg.cn/20190407181053437.png" alt="在这里插入图片描述">那么怎样才能得到这句字符串呢？往上查看。<br><img src="https://img-blog.csdnimg.cn/20190407181314531.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">)<img src="https://img-blog.csdnimg.cn/20190407181321501.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>查看后发现了一系列经典的“cmp，jnz/jz”判断语句。 </p>
<p><code>004013E2   .  E8 75020000   call &lt;jmp.&amp;MFC42.#3098&gt;</code><br>首先看开头的这段语句。经百度后发现，此语句是调用了<strong>判断长度函数</strong>。接着查看下一句。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">004013E7   .  83F8 08       cmp eax,0x8;  判断注册码长度是否等于8，若不等则跳出，相等则继续。</span><br></pre></td></tr></table></figure>
<p>注册码长度被储存在eax中，与8进行比较。<br>为了检测我们的猜想是否正确，在<strong>004013F1</strong>处下断点（F2），再按F9运行程序动态调试，随意输入长度为8的注册码（这里我输入的是“12345678”），发现果然断在了断点处。（即长度判断成功，但第二个判断条件未满足）。</p>
<p><img src="https://img-blog.csdnimg.cn/2019040718243569.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_12,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>那么第二个条件是什么呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">004013EC   .  807C24 09 2D  cmp byte ptr ss:[esp+0x9],0x2D</span><br></pre></td></tr></table></figure>
<p>查看代码，发现是将esp+0x9与0x2D（十进制45）进行比较，查询ASCII码后，45表示的是”-“。在esp中右键，点击“在数据窗口中跟随”。<br><img src="https://img-blog.csdnimg.cn/20190407182757469.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">)<img src="https://img-blog.csdnimg.cn/20190407183221835.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">发现 esp+0x9 表示的是注册码第六位，注释已写在上方图片中。<br>接下来的分析方法大致类似，这里着重分析几句。<br><img src="https://img-blog.csdnimg.cn/20190407183518577.png" alt="在这里插入图片描述"><br>movsx，表示先符号扩展,再传送。之所以要这样做，是为了将 esp+0x4 中的数据存储到ecx中。<br>shl，左移一位，可看作*2^1。<br>完整的代码分析如下。<br><img src="https://img-blog.csdnimg.cn/20190407184154136.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="0x03-总结"><a href="#0x03-总结" class="headerlink" title="0x03 总结"></a>0x03 总结</h3><p><img src="https://img-blog.csdnimg.cn/20190407184408602.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNzYyNTc0,size_12,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>至此破解完毕。本文采取的是算法分析，其实更“高效”的办法是<strong>将所有jnz改jz或直接以nop代替</strong>，即“爆破法”。但对于我这样的菜鸟而言打好基础才是最重要滴。</p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reverse/" rel="tag">Reverse</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-tensorflow2-0-Dropout抑制过拟合与超参数选择" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/02/17/tensorflow2-0-Dropout%E6%8A%91%E5%88%B6%E8%BF%87%E6%8B%9F%E5%90%88%E4%B8%8E%E8%B6%85%E5%8F%82%E6%95%B0%E9%80%89%E6%8B%A9/"
    >tensorflow2.0 Dropout抑制过拟合与超参数选择</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/02/17/tensorflow2-0-Dropout%E6%8A%91%E5%88%B6%E8%BF%87%E6%8B%9F%E5%90%88%E4%B8%8E%E8%B6%85%E5%8F%82%E6%95%B0%E9%80%89%E6%8B%A9/" class="article-date">
  <time datetime="2020-02-17T12:44:36.000Z" itemprop="datePublished">2020-02-17</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="学习资料：B站教程"><a href="#学习资料：B站教程" class="headerlink" title="学习资料：B站教程"></a>学习资料：<a href="https://www.bilibili.com/video/av62215565?p=9" target="_blank" rel="noopener">B站教程</a></h3><p>我们仍是通过之前的Fashion-Mnist数据集理解<code>Dropout</code>是如何抑制过拟合的。</p>
<p>导入模块。</p>
<pre><code>import tensorflow as tf 
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
%matplotlib inline

fashion_mnist = tf.keras.datasets.fashion_mnist.load_data()
(train_image, train_label), (test_image, test_label) = fashion_mnist

# 归一化 灰度区间是0-255
train_image = train_image/255
test_image = test_image/255

train_label_onehot = tf.keras.utils.to_categorical(train_label)
test_label_onehot = tf.keras.utils.to_categorical(test_label)</code></pre><p>注意这里相比较之前的代码，增加了Dropout层。</p>
<pre><code># train_label已经变为独热编码，所以编译时损失函数应当使用categorical_crossentropy

model = tf.keras.Sequential()
model.add(tf.keras.layers.Flatten(input_shape=(28,28)))
model.add(tf.keras.layers.Dense(128, activation=&apos;relu&apos;))
# 添加Dropout层，随机丢弃50%。
model.add(tf.keras.layers.Dropout(0.5))
model.add(tf.keras.layers.Dense(128, activation=&apos;relu&apos;))
# 添加Dropout层，随机丢弃50%。
model.add(tf.keras.layers.Dropout(0.5))
model.add(tf.keras.layers.Dense(128, activation=&apos;relu&apos;))
# 添加Dropout层，随机丢弃50%。
model.add(tf.keras.layers.Dropout(0.5))
model.add(tf.keras.layers.Dense(10, activation=&apos;softmax&apos;))

model.compile(optimizer=&apos;adam&apos;,
            loss = &apos;categorical_crossentropy&apos;,
            metrics=[&apos;acc&apos;]) 

# 加入validation参数，表示加入验证集
history = model.fit(train_image, train_label_onehot, epochs=10,
                   validation_data=(test_image, test_label_onehot)) </code></pre><p>先前的训练结果：</p>
<img src='https://s2.ax1x.com/2020/02/17/3iVEuR.png' width=60%>

<img src='https://s2.ax1x.com/2020/02/17/3iVtVP.png' width=60%>

<p>加入Dropout层抑制过拟合后的训练结果：</p>
<img src='https://s2.ax1x.com/2020/02/17/3iVdPS.png' width=60%>

<img src='https://s2.ax1x.com/2020/02/17/3iVBvj.png' width=60%>    


<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>过拟合：在训练数据上得分很高，在测试数据上得分相对比较低。<br>欠拟合：在训练数据上得分比较低，在测试数据上得分也比较低。<br>应对过拟合的方法：使用Dropout来抑制。<br>应对欠拟合的方法：增加神经网络深度。</p>
<h3 id="Drop的原理：人为丢弃一些单元"><a href="#Drop的原理：人为丢弃一些单元" class="headerlink" title="Drop的原理：人为丢弃一些单元"></a>Drop的原理：人为丢弃一些单元</h3><img src='https://s2.ax1x.com/2020/02/17/3iZTSg.png' width=60%>

<h3 id="为什么Dropout可以解决过拟合？"><a href="#为什么Dropout可以解决过拟合？" class="headerlink" title="为什么Dropout可以解决过拟合？"></a>为什么Dropout可以解决过拟合？</h3><p>1.取平均的作用：先回到标准的模型.我们用相同的训练数据去训陈5个不同的神经网络，一般会得到5个不同的结果，<strong>此时我们可以采用“5个结果取均值”或者“多数取胜的投票策略”去决定最终结果</strong>。</p>
<p>2.减少神经元之间复杂的共适应关系：因为 dropout程序导致两个神经元不一定每次都在一个 dropout网络中出现。这样<strong>权值的更新不再依赖于有固定关系的隐含节点的共同作用，阻止了某些特征仅仅在其它特定特征下才有效果的情况</strong>。</p>
<p>3.Dropout类似于<strong>性别</strong>在生物进化中的角色：物种为了生存往往会倾向于适应这种环境，环境突变则会导致物种难以做岀及时反应，性别的岀现可以繁衍岀适应新环境的变种，有效的阻止过拟合，即避免环境改变时物种可能面临的灭绝。</p>
<h3 id="参数选择原则："><a href="#参数选择原则：" class="headerlink" title="参数选择原则："></a>参数选择原则：</h3><p>理想的模型是刚好在欠拟合和过拟合的界线上，也就是正好拟合数据。</p>
<p>首先开发一个过拟合的模型。方法：添加更多的层、增加每一层、训练更多轮次。<br>然后，抑制过拟合：Dropout、正则化、图像增加。最好的办法：增加训练数据。<br>再次，调节超参数：学习速率、隐藏单元数、训练轮次。</p>
<p>超参数的选择是一个经验与不断测试的结果。经典机器学习的方法，如特征工程、增加训练数据也要做交叉验证。</p>
<h3 id="构建网络的总原则："><a href="#构建网络的总原则：" class="headerlink" title="构建网络的总原则："></a>构建网络的总原则：</h3><p>一、增大网络容量，直到过拟合<br>二、采取措施抑制过拟合<br>三、继续增大网络容量，直到过拟合</p>
<p>此外可以利用<strong>正则化</strong>控制网络规模。</p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tensorflow-2-0/" rel="tag">Tensorflow 2.0</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-tensorflow2-0-网络优化与超参数选择" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/02/17/tensorflow2-0-%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96%E4%B8%8E%E8%B6%85%E5%8F%82%E6%95%B0%E9%80%89%E6%8B%A9/"
    >tensorflow2.0 网络优化与超参数选择</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/02/17/tensorflow2-0-%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96%E4%B8%8E%E8%B6%85%E5%8F%82%E6%95%B0%E9%80%89%E6%8B%A9/" class="article-date">
  <time datetime="2020-02-17T12:31:44.000Z" itemprop="datePublished">2020-02-17</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="学习资料：B站教程"><a href="#学习资料：B站教程" class="headerlink" title="学习资料：B站教程"></a>学习资料：<a href="https://www.bilibili.com/video/av62215565?p=9" target="_blank" rel="noopener">B站教程</a></h3><h2 id="0x00-网络容量"><a href="#0x00-网络容量" class="headerlink" title="0x00 网络容量"></a>0x00 网络容量</h2><p>网络容量可以认为与网络中的可训练参数成正比。<br>网络中的神经单元数越多，层数越多，神经网络的拟合能力越强。<br>但是训练速度、难度越大，越容易产生过拟合。</p>
<h2 id="0x01-如何选择超参数"><a href="#0x01-如何选择超参数" class="headerlink" title="0x01 如何选择超参数"></a>0x01 如何选择超参数</h2><p>所谓超参数，也就是搭建神经网络中，需要我们自己如选择（不是通过梯度下降算法去优化）的那些参数。比如，中间层的神经元个数、学习速率。</p>
<h2 id="0x02-如何提高网络的拟合能力"><a href="#0x02-如何提高网络的拟合能力" class="headerlink" title="0x02 如何提高网络的拟合能力"></a>0x02 如何提高网络的拟合能力</h2><p>一种显然的想法是增大网络容量：<br>1.增加层。<br>2.增加隐藏神经元个数。  </p>
<p>这两种方法哪种更好呢？</p>
<p>单纯的增加神经元个数对于网络性能的提高并不明显，增加层则会大大提高网络的拟合能力。<br>这也是为什么现在深度学习的层越来越深的原因。<br><strong>注意：单层的神经元个数，不能太小，太小的话，会造成信息瓶颈，使得模型欠拟合。</strong></p>
<p>但是，如果我们过于追求网络的拟合能力，那么将出现过<strong>拟合现象</strong>。如何抑制过拟合现象，将在下一篇笔记中讲解。</p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tensorflow-2-0/" rel="tag">Tensorflow 2.0</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-tensorflow2-0-优化函数、学习速率、反向传播算法" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/02/17/tensorflow2-0-%E4%BC%98%E5%8C%96%E5%87%BD%E6%95%B0%E3%80%81%E5%AD%A6%E4%B9%A0%E9%80%9F%E7%8E%87%E3%80%81%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD%E7%AE%97%E6%B3%95/"
    >tensorflow2.0-优化函数、学习速率、反向传播算法</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/02/17/tensorflow2-0-%E4%BC%98%E5%8C%96%E5%87%BD%E6%95%B0%E3%80%81%E5%AD%A6%E4%B9%A0%E9%80%9F%E7%8E%87%E3%80%81%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD%E7%AE%97%E6%B3%95/" class="article-date">
  <time datetime="2020-02-17T12:06:41.000Z" itemprop="datePublished">2020-02-17</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="学习资料：B站教程"><a href="#学习资料：B站教程" class="headerlink" title="学习资料：B站教程"></a>学习资料：<a href="https://www.bilibili.com/video/av62215565?p=9" target="_blank" rel="noopener">B站教程</a></h3><h2 id="0x00-多层感知器"><a href="#0x00-多层感知器" class="headerlink" title="0x00 多层感知器"></a>0x00 多层感知器</h2><p>我们首先回顾一下多层感知器的结构。<br>多层感知器: 输入层-&gt;隐含层(可以是多层)-&gt;输出层</p>
<img src='https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1525985364,3633287073&fm=15&gp=0.jpg' width=60%>

<p>其中输出层的特点： </p>
<ol>
<li>预测连续值：不激活直接输出。   </li>
<li>预测二分类问题：<code>sigmoid</code>运算，二分类输出。    </li>
<li>预测多分类问题：<code>softmax</code>运算，输出多分类上的概率分布。</li>
</ol>
<h2 id="0x01-梯度下降算法"><a href="#0x01-梯度下降算法" class="headerlink" title="0x01 梯度下降算法"></a>0x01 梯度下降算法</h2><p>定义：<br>梯度就是表明损失函数相对参数的变化率，对梯度进行缩放的参数被称为学习速率(learning rate)</p>
<p>学习速率：它是一种超参数，即手工可配置的设置，需要为它设定正确的值。合适的学习速率，损失函数随时间下降，直到一个底部不适合的学习速率，损失函数可能会发生震荡。  </p>
<p>学习速率选取原则：在调整学习速率时，既需要使其足够小，保证不至于发生超调，也要保证它足够大，以使损失函数能够尽快下降，从而可通过较少次数的迭代更快地完成学习。</p>
<p>反向传播算法：反向传播算法是一种高效计算数据流图中梯度的技术。<strong>每一层的导数都是后一层的导数与前一层输出之积</strong>，这正是链式法则的奇妙之处，误差反向传播算法利用的正是这一特点。前馈时，从输入开始，逐一计算每个隐含层的输出，直到输出层然后开始计算导数，并从输出层经各隐含层逐一反向传播。为了减少计算量，还需对所有已完成计算的元素进行复用。这便是反向传播算法名称的由来。    </p>

      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tensorflow-2-0/" rel="tag">Tensorflow 2.0</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
    <article id="post-Tensorflow2-0-softmax多分类问题实现" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/02/15/Tensorflow2-0-softmax%E5%A4%9A%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98%E5%AE%9E%E7%8E%B0/"
    >Tensorflow2.0 softmax多分类问题实现</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2020/02/15/Tensorflow2-0-softmax%E5%A4%9A%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98%E5%AE%9E%E7%8E%B0/" class="article-date">
  <time datetime="2020-02-15T10:02:26.000Z" itemprop="datePublished">2020-02-15</time>
</a>
      
      
      
      
    </div>
    

    

    
    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h3 id="学习资料：B站教程"><a href="#学习资料：B站教程" class="headerlink" title="学习资料：B站教程"></a>学习资料：<a href="https://www.bilibili.com/video/av62215565?p=9" target="_blank" rel="noopener">B站教程</a></h3><h2 id="0x00-使用sparse-categorical-crossentropy计算的情况"><a href="#0x00-使用sparse-categorical-crossentropy计算的情况" class="headerlink" title="0x00 使用sparse_categorical_crossentropy计算的情况"></a>0x00 使用sparse_categorical_crossentropy计算的情况</h2><p>我们在处理多分类问题是，最后一层的输出值一般是概率值，因此需要使用<code>softmax</code>函数作为激活函数。我们用 <code>fashion_mnist</code> 数据集作为实例，来具体解释<code>softmax</code>的用法。</p>
<p>首先打开<code>jupyter notebook</code>，引入模块。  </p>
<pre><code>import tensorflow as tf
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
%matplotlib inline</code></pre><p>初次加载需要下载。初始化训练集，测试集。</p>
<pre><code>fashion_mnist = tf.keras.datasets.fashion_mnist.load_data()
(train_image, train_label), (test_image, test_label) = fashion_mnist</code></pre><p>我们可以查看一下<code>train_label</code></p>
<pre><code>train_label</code></pre><p>array([9, 0, 0, …, 3, 0, 5], dtype=uint8)</p>
<p>label数组中的数据全为0-9，表示十种衣服的分类。</p>
<p>接着进行归一化，除以255是因为图片灰度区间是0-255。  </p>
<pre><code>train_image = train_image/255
test_image = test_image/255</code></pre><p>查看图片形状。</p>
<pre><code>train_image.shape</code></pre><p>(60000, 28, 28)</p>
<p>接着建立模型。<br>第一层为Flatten层，因为Desne是将一维的数据映射到一维的数据，(28, 28)是二维数据，所以需要将它扁平化为一维数据,扁平成28*28的向量。注意所有“层”都是大写。  </p>
<p>使用relu激活函数，输出128个隐藏单元，不能设置太小，因为如果Dense太小会舍弃掉很多信息。但也不能太大，否则会产生过拟合问题。</p>
<p>最后要输出10个概率值，使用softmax激活，得到概率输出，10表示有十种衣服种类。</p>
<pre><code>model = tf.keras.Sequential()

model.add(tf.keras.layers.Flatten(input_shape=(28,28)))
model.add(tf.keras.layers.Dense(128, activation=&apos;relu&apos;))
model.add(tf.keras.layers.Dense(10, activation=&apos;softmax&apos;))</code></pre><p>在tf.keras里，对于多分类问题我们使用<code>categorical_crossentropy</code>和<code>sparse_categorical_crossentropy</code>来计算softmax交叉熵。<br><code>metrics</code>:衡量指标</p>
<pre><code>model.compile(optimizer=&apos;adam&apos;,
         loss = &apos;sparse_categorical_crossentropy&apos;,
         metrics=[&apos;acc&apos;])</code></pre><p>model.fit进行训练，<code>epochs</code>设置为10，表示训练10轮。<br>可以看到最后训练的正确率为0.9094。</p>
<img src='https://s2.ax1x.com/2020/02/15/1zEzcV.png' width=60%>

<p>使用测试集来测试正确率，得到正确率为0.8797。</p>
<pre><code>model.evaluate(test_image, test_label)</code></pre><h2 id="0x01-使用categorical-crossentropy计算的情况"><a href="#0x01-使用categorical-crossentropy计算的情况" class="headerlink" title="0x01 使用categorical_crossentropy计算的情况"></a>0x01 使用categorical_crossentropy计算的情况</h2><p>当label进行独热编码时，使用<code>categorical_crossentropy</code>。</p>
<p>独热编码举例：北京[1, 0, 0] 上海[0, 1, 0] 深圳[0, 0, 1]</p>
<p>独热编码详解：<a href="https://www.cnblogs.com/zongfa/p/9305657.html" target="_blank" rel="noopener">https://www.cnblogs.com/zongfa/p/9305657.html</a></p>
<p>使用<code>keras</code>带有的模块进行编码。</p>
<pre><code>train_label_onehot = tf.keras.utils.to_categorical(train_label)
test_label_onehot = tf.keras.utils.to_categorical(test_label)</code></pre><p>对编码后的数据进行查看。</p>
<img src='https://s2.ax1x.com/2020/02/15/1zZKx0.png' width=60%>

<p>构建模型的步骤与之前相同，但注意<code>train_label</code>已经变为独热编码，所以编译时损失函数应当使用<code>categorical_crossentropy</code>。</p>
<pre><code>model = tf.keras.Sequential()
model.add(tf.keras.layers.Flatten(input_shape=(28,28)))
model.add(tf.keras.layers.Dense(128, activation=&apos;relu&apos;))
model.add(tf.keras.layers.Dense(10, activation=&apos;softmax&apos;))

model.compile(optimizer=&apos;adam&apos;,
            loss = &apos;categorical_crossentropy&apos;,
            metrics=[&apos;acc&apos;])</code></pre><p>进行训练。</p>
<img src='https://s2.ax1x.com/2020/02/15/1zZbJs.png' width=50%>

<p>进行预测。predict每一项都是长度为10的数组，这个数组的每一项依次表示该图片是0-9标签的概率值。因此，该数组的最大项就是模型所预测的最后结果。调用<code>np.argmax(predict[0])</code>和<code>test_label[0]</code>发现都为9，表示预测正确。</p>
<pre><code>predict = model.predict(test_image)
np.argmax(predict[0])
test_label[0]</code></pre>
      
      <!-- reward -->
      
    </div>
    
    
      <!-- copyright -->
      
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tensorflow-2-0/" rel="tag">Tensorflow 2.0</a></li></ul>


    </footer>

  </div>

  

  
  
  

  

</article>
    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/">上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul class="list-inline">
      <li>
        &copy;
        2015-2020
        Gengar
      </li>
      <li>
        
          Powered by
        
        
        <a href="https://hexo.io" target="_blank">Hexo</a> Theme <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul class="list-inline">
      <li>
        
        
        <span>
  <i>PV:<span id="busuanzi_value_page_pv"></span></i>
  <i>UV:<span id="busuanzi_value_site_uv"></span></i>
</span>
        
      </li>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>
    <div class="to_top">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>
      </div>
    </main>
      <aside class="sidebar">
        <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="Ayer"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
      </aside>
      <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
      
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>


<script src="/js/share.js"></script>



<script src="/fancybox/jquery.fancybox.min.js"></script>




<script>
  try {
    var typed = new Typed("#subtitle", {
    strings: ['Stay hungry. Stay foolish.','',''],
    startDelay: 0,
    typeSpeed: 200,
    loop: true,
    backSpeed: 100,
    showCursor: true
    });
  } catch (err) {
  }
  
</script>




<script>
  var ayerConfig = {
    mathjax: false
  }
</script>


<script src="/js/ayer.js"></script>


<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>




<script type="text/javascript" src="https://js.users.51.la/20544303.js"></script>
  </div>
</body>

</html>